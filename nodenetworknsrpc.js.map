{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/apiConfig.json","node_modules/agnostic-router-api-builder/node_modules/agnostic-router/src/Router.js","node_modules/agnostic-router-api-builder/node_modules/url-pattern/lib/url-pattern.js","node_modules/agnostic-router-api-builder/src/ApiRouter.js","node_modules/agnostic-router-api-builder/src/Utils.js","node_modules/agnostic-router/src/Router.js","node_modules/agnostic-rpc/AgnosticRpc.js","node_modules/agnostic-rpc/Utils.js","node_modules/base64-js/lib/b64.js","node_modules/buffer/index.js","node_modules/buffer/node_modules/isarray/index.js","node_modules/fauxmongo/fauxmongo.js","node_modules/fauxmongo/lib/Aggregate.js","node_modules/fauxmongo/lib/AggregationOperators.js","node_modules/fauxmongo/lib/AggregationStages.js","node_modules/fauxmongo/lib/FauxmongoError.js","node_modules/fauxmongo/lib/GetBSONType.js","node_modules/fauxmongo/lib/GetTypeStr.js","node_modules/fauxmongo/lib/MatchLeaves.js","node_modules/fauxmongo/lib/MatchQuery.js","node_modules/fauxmongo/lib/Merge.js","node_modules/fauxmongo/lib/MoreDollars.js","node_modules/fauxmongo/lib/Project.js","node_modules/fauxmongo/lib/QueryOperators.js","node_modules/fauxmongo/lib/ResolveDollar.js","node_modules/fauxmongo/lib/Set.js","node_modules/fauxmongo/lib/Sorting.js","node_modules/fauxmongo/lib/Update.js","node_modules/fauxmongo/lib/UpdateOperators.js","node_modules/ieee754/index.js","node_modules/mongolocal/src/IndexedLinkedList.js","node_modules/mongolocal/src/MongoLocal.js","node_modules/mongolocal/src/MongoLocalCursor.js","node_modules/mongolocal/src/Utils.js","node_modules/node-network-rpc/src/NodeNetworkRpc.js","node_modules/node-network/src/AddressManager.js","node_modules/node-network/src/NodeRouter.js","node_modules/node-network/src/RouteTable.js","node_modules/node-network/src/Trie.js","node_modules/objectid/index.js","node_modules/oms/src/FunctionUtils.js","node_modules/oms/src/Oms.js","node_modules/oms/src/OmsIntercept.js","node_modules/oms/src/OmsLayers.js","node_modules/oms/src/OmsMongoConnector.js","node_modules/oms/src/OmsOplog.js","node_modules/oms/src/OmsOplogSubscriptions.js","node_modules/oms/src/OmsSubscriptions.js","node_modules/oms/src/OmsUtils.js","node_modules/oms/src/Utils.js","node_modules/process/browser.js","node_modules/queue-emitter/src/QueueEmitter.js","node_modules/util/node_modules/inherits/inherits_browser.js","node_modules/util/support/isBufferBrowser.js","node_modules/util/util.js","node_modules/wolfy87-eventemitter/EventEmitter.js","src/DnsClient.js","src/DnsDb.js","src/DnsDbRouter.js","src/DnsRpc.js","src/Utils.js"],"names":["Router","this","useRoutes","methodRoutes","index","UrlPattern","require","prototype","route","queueNext","routeMatch","routeMatches","shift","request","params","handler","respond","_isRouter","method","queueEnd","arguments","length","path","_methodPathMatches","use","_validHandler","_addRouteToArray","_normalizePath","useFirst","Array","replace","pathNormalized","matches","self","forEach","match","push","array","prepend","unshift","module","exports","slice","root","factory","define","amd","P","astNodeContainsSegmentsForProvidedParams","astNodeToNames","astNodeToRegexString","baseAstNodeToRegexString","concatMap","defaultOptions","escapeForRegex","getParam","keysAndValuesToObject","newParser","regexGroupCount","stringConcatMap","stringify","string","f","i","results","concat","result","regex","RegExp","toString","exec","keys","values","key","object","value","isArray","Result","rest","Tagged","tag","parser","input","tagged","sequence","parsers","call","pick","indexes","apply","lazy","fn","cached","baseMany","end","stringResult","atLeastOneResultRequired","parserResult","many1","concatMany1Till","firstChoice","options","U","wildcard","wildcardChar","optional","optionalSegmentStartChar","pattern","optionalSegmentEndChar","name","segmentNameCharset","named","segmentNameStartChar","escapedChar","escapeChar","token","segmentValueCharset","astNode","node","nextIndexes","sideEffects","maxIndex","Error","arg1","arg2","groupCount","parsed","isRegex","ast","names","TypeError","url","groups","Object","AgnosticRouter","Utils","_sanitizeArgumentConfig","argumentConfigDirty","argumentConfigDefault","level","argumentConfigSanitized","objectMerge","source","toObject","apiConfig","callback","router","objectForEach","functionConfig","functionName","urlPattern","argumentsConfig","argumentsArray","functionCallback","pop","parsedFunctionArguments","parseArgs","requestArguments","argumentConfig","objectSet","urlPath","toRouter","targetObject","next","parsedArgs","argumentRequestPath","objectIsset","objectGet","merged","argument","attrname","hasOwnProperty","objectFilter","filter","child","property","parent","objectFilterProperties","argsPassed","argsConfig","validArg","argConfig","arg","validate","type","types","indexOf","requiredLeftEnough","minIndex","required","matched","argConfigMin","ctr","default","AgnosticRpc","_requests","allArgs","multipleResponses","requestId","uniqueId","query","id","handleResponse","message","response","handleRequest","requestMessage","requestCallback","responseEmitter","onResponse","responseMessage","messageIsResponse","messageIsRequest","s4","Math","floor","random","substring","lookup","decode","elt","code","charCodeAt","PLUS","PLUS_URL_SAFE","SLASH","SLASH_URL_SAFE","NUMBER","UPPER","LOWER","b64ToByteArray","b64","v","arr","L","j","l","tmp","placeHolders","len","charAt","Arr","uint8ToBase64","uint8","encode","num","temp","extraBytes","output","Uint8Array","toByteArray","fromByteArray","base64js","typedArraySupport","Bar","foo","constructor","subarray","byteLength","e","kMaxLength","Buffer","TYPED_ARRAY_SUPPORT","undefined","fromNumber","fromString","fromObject","that","allocate","checked","encoding","write","isBuffer","fromBuffer","fromArray","ArrayBuffer","buffer","fromTypedArray","fromArrayBuffer","fromArrayLike","fromJsonObject","copy","_augment","data","__proto__","_isBuffer","poolSize","rootParent","RangeError","SlowBuffer","subject","buf","loweredCase","utf8ToBytes","base64ToBytes","toLowerCase","slowToString","start","Infinity","hexSlice","utf8Slice","asciiSlice","binarySlice","base64Slice","utf16leSlice","hexWrite","offset","Number","remaining","strLen","parseInt","substr","isNaN","utf8Write","blitBuffer","asciiWrite","asciiToBytes","binaryWrite","base64Write","ucs2Write","utf16leToBytes","base64","min","res","firstByte","codePoint","bytesPerSequence","secondByte","thirdByte","fourthByte","tempCodePoint","decodeCodePointsArray","codePoints","MAX_ARGUMENTS_LENGTH","String","fromCharCode","ret","out","toHex","bytes","checkOffset","ext","checkInt","max","objectWriteUInt16","littleEndian","objectWriteUInt32","checkIEEE754","writeFloat","noAssert","ieee754","writeDouble","base64clean","str","stringtrim","INVALID_BASE64_RE","trim","n","units","leadSurrogate","byteArray","c","hi","lo","src","dst","INSPECT_MAX_BYTES","global","b","compare","a","x","y","isEncoding","list","pos","item","equals","inspect","join","val","byteOffset","arrayIndexOf","foundIndex","get","console","log","readUInt8","set","writeUInt8","isFinite","swap","toJSON","_arr","newBuf","sliceLen","readUIntLE","mul","readUIntBE","readUInt16LE","readUInt16BE","readUInt32LE","readUInt32BE","readIntLE","pow","readIntBE","readInt8","readInt16LE","readInt16BE","readInt32LE","readInt32BE","readFloatLE","read","readFloatBE","readDoubleLE","readDoubleBE","writeUIntLE","writeUIntBE","writeUInt16LE","writeUInt16BE","writeUInt32LE","writeUInt32BE","writeIntLE","limit","sub","writeIntBE","writeInt8","writeInt16LE","writeInt16BE","writeInt32LE","writeInt32BE","writeFloatLE","writeFloatBE","writeDoubleLE","writeDoubleBE","target","targetStart","_set","fill","toArrayBuffer","BP","toLocaleString","getBSONType","MatchQuery","Update","Merge","Project","Aggregate","FauxmongoError","matchQuery","update","merge","project","aggregate","resolveDollar","docs","pipeline","keepStages","stages","operator","stage","err","expression","StageOperators","evaluate","getTypeStr","evaluateExpression","context","varname","pointer","CURRENT","frags","split","frag","newDoc","$literal","backup","spec","$let","tempVar","vars","retval","in","$map","as","AggregationOperators","matchLeaves","Sorting","leafSorter","getLeafsort","Set","$and","$or","$not","Boolean","$allElementsTrue","$anyElementTrue","$setDifference","able","baker","difference","export","$setEquals","sets","first","$setIntersection","walker","intersect","$setIsSubset","contains","$setUnion","union","$cmp","$eq","$gt","$gte","$lt","$lte","$ne","$add","vals","datestamp","tms","getTime","setTime","total","$divide","$mod","$multiply","accumulator","$subtract","$concat","$strcasecmp","toUpperCase","$substr","$toLower","$toUpper","$meta","$size","$dayOfMonth","Date","getDate","$dayOfWeek","getDay","$dayOfYear","getFullYear","diff","$hour","getHours","$millisecond","getMilliseconds","$minute","getMinutes","$month","getMonth","$second","getSeconds","$week","days","setDate","firstSunday","setMonth","ceil","$year","$cond","ifx","thenx","elsex","if","then","else","$ifNull","AggregationAccumulators","$addToSet","add","$avg","count","$first","$last","$max","highest","$min","lowest","$push","$sum","accumulators","clone","thing","newThing","subthing","cloneArr","thingArr","AggregationStages","$geoNear","$group","strings","nums","others","otherDocs","doc","_id","idType","done","jobs","jobDocLists","stringIDs","numIDs","jobID","jobDocs","accumulant","subexpression","sxkeys","$limit","$match","$project","currentDoc","dotsBanned","layersBanned","lastStep","isExpression","writeHead","notFound","k","specKeys","subdoc","layerProjection","projectLevel","layer","projection","didSomething","specKey","levelProjection","$redact","DESCEND","KEEP","PRUNE","action","redacted","redactLevel","readHead","newVal","$skip","$sort","sort","getDocsort","$unwind","newDocs","innerPointer","m","info","util","inherits","obj","simpleNums","round","BSON_TYPES","tstr","typeGetter","aType","rootlen","subquery","subtype","matchSubquery","pointerType","ok","earlyMatch","upperSubpath","specialSubquery","fullfilled","$exists","moreDollars","op","operators","ops","document","simpleMerge","childType","tval","simpleArrayMerge","mergeLevel","subsource","subtarget","basePath","keypath","mergeArrayLevel","newArr","directive","$elemMatch","$slice","dropped","splice","dollarPath","dollarPosition","multiproject","mainTarget","remainingPath","found","pathStep","finalStep","previousStep","previousPPointer","outputDoc","ppointer","pathFrags","broken","dollarFrags","docfrag","JSON","leafTypeStr","newCloneArr","LOOKUP_BSON_TYPE","1","2","3","4","5","6","8","9","10","11","13","16","18","fieldOps","$in","isString","$nin","$regex","$type","arrOps","$all","pathstr","pslen","dollar","didDocumentQuery","qpath","dummyQuery","other","oi","newSet","otherStrings","otherNums","map","sspec","leafsort","bType","SORT_PRIORITY","aKeys","bKeys","comp","aHighest","bHighest","aLowest","bLowest","specPaths","specFullpaths","aPointer","bPointer","direction","ARR_SORT_PRIORITY","change","oldPath","$rename","notOK","newPath","$set","$unset","dollarTarget","dollarTargetStr","job","stubborn","STUBBORN_OPS","writing","newDollar","newDollarStr","MOD_OPS","$each","$position","$inc","$mul","$currentDate","$pushAll","changeType","$bit","bitop","delta","$isolated","candidate","position","each","$pop","$pull","$pullAll","isLE","mLen","nBytes","eLen","eMax","eBias","nBits","d","s","NaN","rt","abs","LN2","IndexedLinkedList","head","tail","dequeue","_removeItem","remove","_resetIndex","prev","enqueue","error","MongoLocal","config","collection","docsLinkedList","FauxMongo","ObjectId","EventEmitter","MongoLocalCursor","find","peekResult","mongolocal","lastResultDoc","returnedOne","_docFilter","currentNode","nextResult","rewindResults","_validateQuery","cursor","findOne","insert","callbackSafe","insertDocSafe","insertDoc","_cappedInsert","emitCascade","emit","continueInsert","_cloneObject","parse","multi","upsert","updateOperations","_validateUpdate","BreakException","numUpdated","_forEachDocIndex","unmodifiedDoc","modifiedDoc","_updateDoc","insertOptions","exception","justOne","docClone","docId","_cappedRemove","isCapped","validated","attributeVal","attributeKey","updateMongoOperators","operationValue","operationKey","_peekResult","_nextResult","_rewindResults","_nextDocIndex","rewind","toArray","getNext","sendNext","properties","filtered","objectContainsObject","containerObject","_objectSet","callbackQueue","queueCompleteCallbackSafe","queueCompleted","queueCompleteCallback","callbackQueueNext","queueFunctions","queueFunctionArgs","expand","queueNoMatchCallback","NodeNetworkRpc","rpc","connected","network","NodeNetwork","_rpc","Rpc","on","_rpcMessage","address","eventType","configDefaults","rpcRequestQuery","srcAddress","rpcResponseHandler","rpcError","rpcResponse","rpcRequestMessage","destAddresses","send","rpcMessage","destAddress","requestHandler","packResponse","noRouteHandler","addConnection","connection","AddressManager","baseAddress","_baseAddress","_max","_stringBase","_incrementString","addressIsEqual","address1","address2","addressIsChild","childAddress","parentAddress","addressIsParent","stringToIncrement","stringBase","increment","NodeRouter","_routeTable","RouteTable","insertOperation","emitOperation","cost","addressParts","_connections","_connectionKeyMax","process","nextTick","setAddress","_actions","ping","packet","_route","addressrevoke","_addressManager","_setAddressParts","addressrequest","routesupdate","routeOperations","_routesApplyOperations","insertFilter","routeOperationsFiltered","_routeOperationsFilter","rpcRequest","destAddressesJoined","destAddressJoined","dest","addressJoined","addressConnectionKey","_broadcastRouteOperations","connectionConfig","connectionKey","routeOperationsClone","localOperations","modifyRoutes","routeOperation","localOperationsBroadcast","routerOperations","childRoutes","routeNode","routeKey","removeRoute","connectionRouteTableOperations","nodeData","routePath","routerTableOps","toRouteOperations","connectionOptions","sendRoutingTable","routingTableOperations","removeConnectionRoutes","filters","routeOperationsAction","routeOperationsActionKey","rpcBroadcast","status","nextConnections","nextConnectionKey","nextConnection","connectionDests","actions","table","Tree","routeOperationsInsert","traverse","routeKeys","children","closestRoute","deepest","removeRoutes","routeTable","operationsCompleted","insertRoute","Trie","trie","pathKeys","getNode","trieNode","nodes","inPathNodes","deletionNode","removeNode","childrenNodes","childrenNodesData","childNode","childNodeKey","parentNode","rootNode","rootNodePathKeys","traverseNodes","nodePathKeys","childKey","deepestTrieNodeData","deepestTrieNodePathKeys","descend","trieNodeData","trieNodePathKeys","descendNodes","matchedNodeData","matchedNodePath","matchedNode","$3_BITS","$5_BITS","MACHINE_ID_AND_PID","Index","Timestamp","pad","makeObjectId","reduce","group","objIdPattern","isValid","alleged","test","FunctionUtils","objectPublicFunctions","functionNames","attribute","objectReplicateFunctions","sourceObject","excludeFunctions","OmsIntercept","OmsLayers","OmsMongoConnector","OmsOplog","OmsOplogSubscriptions","OmsSubscriptions","OmsUtils","_maxOpId","_replicateInterceptCollectionFunctions","QueueEmitter","omsIntercept","_collectionFunction","functionArguments","preCallback","opCallback","opCompleteArgs","opId","opEmitCallback","completeCallback","completeArgs","completeCallbackSafe","_objectPublicFunctions","cacheCollection","masterCollection","updateOp","mongoCollection","operationsQueue","mongoIntercept","queue","_docs","postFind","_unmodifiedDocs","_updateOperations","validatedOperations","docCollection","opLogConfig","opTags","opLogCollection","opType","operationObject","operationDoc","_operation","srcOperationDoc","_srcId","_srcOpId","applyOp","applyCollectionOp","operation","collectionFunctionArgs","operationFunctionArguments","searchId","existingOperationDoc","_subscriptions","_collectionQueries","_opLogQueries","opLogDoc","_publish","subscribeResume","lastOpId","collectionQuery","opLogQuery","lastOp","nextOpLogItem","listItem","subscribe","opLogSubscriptionComputedDoc","docMatch","operationSubscriptionComputedDoc","_objectMerge","unmodifiedDocMatch","modifiedDocMatch","findSubscribe","subscribeCallback","collectionDocs","collectionQueryKey","_queryKey","usages","opLogQueryKey","subscriptionId","_uniqueId","collectionQueryResults","opLogQueryResults","_objectForEach","subscription","subscriptionKey","queriesHaystack","queryNeedle","_objectDeepEqual","queryKey","unsubscribe","collectionQueryConfig","opLogQueryConfig","prop","opLogSubscriptions","findSubscribeObject","subscribeObject","updateOperation","date","operationDocMin","operationObjectMin","operationType","operationArgs","objectDeepEqual","defaultSetTimout","defaultClearTimeout","runTimeout","fun","cachedSetTimeout","setTimeout","runClearTimeout","marker","cachedClearTimeout","clearTimeout","cleanUpNextTick","draining","currentQueue","queueIndex","drainQueue","timeout","run","Item","noop","args","title","browser","env","argv","version","versions","addListener","once","off","removeListener","removeAllListeners","prependListener","prependOnceListener","listeners","binding","cwd","chdir","dir","umask","emitter","eventArgs","eventName","listenersConfig","getListeners","listenersFns","listenerConfig","listener","_callbackQueue","queueComplete","queueFunctionComplete","create","ctor","superCtor","super_","enumerable","writable","configurable","TempCtor","opts","ctx","seen","stylize","stylizeNoColor","depth","colors","isBoolean","showHidden","_extend","isUndefined","customInspect","stylizeWithColor","formatValue","styleType","style","styles","arrayToHash","hash","idx","recurseTimes","isFunction","primitive","formatPrimitive","visibleKeys","getOwnPropertyNames","isError","formatError","isRegExp","isDate","base","braces","toUTCString","formatArray","formatProperty","reduceToSingleString","simple","isNumber","isNull","desc","getOwnPropertyDescriptor","line","numLinesEst","cur","ar","isNullOrUndefined","isSymbol","re","isObject","objectToString","isPrimitive","o","timestamp","time","months","formatRegExp","format","objects","_","deprecate","msg","deprecated","warned","throwDeprecation","traceDeprecation","trace","noDeprecation","debugs","debugEnviron","debuglog","NODE_DEBUG","pid","bold","italic","underline","inverse","white","grey","black","blue","cyan","green","magenta","red","yellow","special","number","boolean","null","regexp","origin","indexOfListener","alias","isValidListener","proto","originalGlobalValue","evt","events","_getEvents","flattenListeners","flatListeners","getListenersAsObject","listenerIsWrapped","addOnceListener","defineEvent","defineEvents","evts","addListeners","manipulateListeners","removeListeners","single","multiple","removeEvent","_events","emitEvent","listenersMap","_getOnceReturnValue","trigger","setOnceReturnValue","_onceReturnValue","noConflict","DnsClient","dnsDb","_dnsDb","_dnsServerAddress","dnsServer","_apiBasePath","apiPath","_remoteApiObject","ApiBuilder","requestOptions","subscribeToGroup","argsArrayPass","interceptCallback","groupsOplog","groupAddresses","groupLookup","groupSubscribe","groupName","DnsDb","removeEmptyGroups","removeEmptyAddresses","groupsOplogMax","addressesOplogMax","_options","Mongolocal","Oms","groupsOplogSubscriptions","addresses","addressesOplog","addressesOplogSubscriptions","addToGroup","updateAddress","addressQuery","addressDoc","groupQuery","groupDoc","removeFromGroup","addressUpdateOperation","writeResult","groupQueryEmpty","groupUpdateOperation","removeFromAllGroups","oplogQuery","DnsRpc","defaultConfig","public","dnsClient","_config","_prevAddress","DnsDbRouter","defaultGroup","destGroup","arrayToObject","keyAttribute","indexAttribute","arrayElement","arrayElementIndex","parentObject","childObject","searchDeep"],"mappings":"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","file":"bundle.js","sourcesContent":["(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require==\"function\"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require==\"function\"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})","module.exports={\"addToGroup\":{\"pattern\":\"/join\",\"arguments\":[{\"name\":\"address\",\"source\":\"query\"},{\"name\":\"group\",\"source\":\"query\"}],\"requestOptions\":{\"multipleResponses\":false}},\"removeFromGroup\":{\"pattern\":\"/leave\",\"arguments\":[{\"name\":\"address\",\"source\":\"query\"},{\"name\":\"group\",\"source\":\"query\"}],\"requestOptions\":{\"multipleResponses\":false}},\"removeFromAllGroups\":{\"pattern\":\"/leaveall\",\"arguments\":[{\"name\":\"address\",\"source\":\"query\"}],\"requestOptions\":{\"multipleResponses\":false}},\"groupAddresses\":{\"pattern\":\"/group/find\",\"arguments\":[{\"name\":\"group\",\"source\":\"query\"}],\"requestOptions\":{\"multipleResponses\":false}},\"subscribeToGroup\":{\"pattern\":\"/group/subscribe\",\"arguments\":[{\"name\":\"groupQuery\",\"source\":\"query\",\"level\":1,\"types\":[\"object\",\"string\"],\"default\":{}},{\"name\":\"oplogQuery\",\"source\":\"query\",\"level\":1,\"type\":\"object\",\"default\":{}}],\"requestOptions\":{\"multipleResponses\":true}},\"unsubscribe\":{\"pattern\":\"/group/unsubscribe\",\"arguments\":[{\"name\":\"subscriptionId\",\"source\":\"query\"}],\"requestOptions\":{\"multipleResponses\":false}}}","var UrlPattern = require('url-pattern');\n\nfunction Router() {\n\tthis.useRoutes = [];\n\tthis.methodRoutes = {};\n\tthis.index = 0;\n\tthis.UrlPattern = UrlPattern;\n}\n\nRouter.prototype.route = function() {\n\t// takes method, path, [request], respond\n\tif(arguments.length == 3) {\n\t\tvar request = {};\n\t\tvar respond = arguments[2];\n\t}\n\telse if(arguments.length >= 4) {\n\t\tvar request = arguments[2];\n\t\tif(typeof request !== \"object\" || !request)\n\t\t\trequest = {};\n\t\tvar respond = arguments[3];\n\t}\n\trequest.method = arguments[0];\n\n\tvar path = arguments[1];\n\tif(typeof request.path === 'undefined') // only overwrite path if doesn't already exist (carries through all routers)\n\t\trequest.path = path;\n\n\tvar queueEnd = arguments[4];\n\n\tvar routeMatches = this._methodPathMatches(request.method, path);\n\tqueueNext();\n\n\tfunction queueNext() {\n\t\tvar routeMatch = routeMatches.shift();\n\t\tif(typeof routeMatch !== \"undefined\") {\n\t\t\trequest.params = routeMatch.params; // overwrite params on each new route match\n\t\t\tif(typeof routeMatch.handler === \"function\")\n\t\t\t\trouteMatch.handler(request, respond, queueNext);\n\t\t\telse if(Router._isRouter(routeMatch.handler))\n\t\t\t\trouteMatch.handler.route(request.method, '/' + request.params['_'], request, respond, queueNext); // cycle through the router, then rejoin the queue\n\t\t\telse // route handler isn't a function or a router\n\t\t\t\tqueueNext();\n\t\t}\n\t\telse if(typeof queueEnd === 'function') // reached the end of the queue\n\t\t\tqueueEnd();\n\t}\n\n};\n\nRouter.prototype.use = function() {\n\t// [path], handler\n\tvar path = (typeof arguments[0] === 'string') ? arguments[0] : '';\n\tvar handler = Router._validHandler(arguments[0]) ? arguments[0] : arguments[1];\n\n\treturn this._addRouteToArray(this.useRoutes, Router._normalizePath(path), handler);\n};\n\nRouter.prototype.useFirst = function() {\n\t// [path], handler\n\tvar path = (typeof arguments[0] === 'string') ? arguments[0] : '';\n\tvar handler = Router._validHandler(arguments[0]) ? arguments[0] : arguments[1];\n\n\treturn this._addRouteToArray(this.useRoutes, Router._normalizePath(path), handler, true);\n};\n\nRouter.prototype.method = function(method, path, handler) {\n\tif(!(this.methodRoutes[method] instanceof Array)) // create the stack if it doesn't exist\n\t\tthis.methodRoutes[method] = [];\n\treturn this._addRouteToArray(this.methodRoutes[method], Router._normalizePath(path), handler);\n};\n\n/* Private functions */\nRouter._validHandler = function(handler) {\n\treturn (typeof handler === 'function' || Router._isRouter(handler)); // must be function or router\n};\n\nRouter._isRouter = function(handler) {\n\treturn (typeof handler === 'object' && typeof handler.route === 'function'); // must be function or router\n};\n\nRouter._normalizePath = function(path) {\n\treturn path.replace(/\\/$/, ''); // strip trailing slash\n};\n\nRouter.prototype._methodPathMatches = function(method, path) {\n\tvar pathNormalized = Router._normalizePath(path);\n\tvar matches = [];\n\tvar self = this;\n\n\tself.useRoutes.forEach(function(route) {\n\t\tvar routeMatch = (new UrlPattern(route.path + '(/*)')).match(pathNormalized);\n\t\t//console.log(\"RU\", routeMatch, route.path, pathNormalized);\n\t\tif(routeMatch !== null)\n\t\t\tmatches.push({path: route.path, handler: route.handler, params: routeMatch});\n\t});\n\n\tif(self.methodRoutes[method] instanceof Array) {\n\t\tself.methodRoutes[method].forEach(function(route) {\n\t\t\tvar routeMatch = (new UrlPattern(route.path)).match(pathNormalized);\n\t\t\t//console.log(\"RM\", route.path, pathNormalized, routeMatch);\n\t\t\tif(routeMatch !== null)\n\t\t\t\tmatches.push({path: route.path, handler: route.handler, params: routeMatch});\n\t\t});\n\t}\n\n\treturn matches;\n};\n\nRouter.prototype._addRouteToArray = function(array, path, handler, prepend) {\n\tvar route = {path: path, handler: handler};\n\tif(typeof prepend === 'boolean') //prepend\n\t\tarray.unshift(route);\n\telse //append\n\t\tarray.push(route);\n};\n\nmodule.exports = function() {\n\treturn new Router();\n};\n","// Generated by CoffeeScript 1.10.0\nvar slice = [].slice;\n\n(function(root, factory) {\n  if (('function' === typeof define) && (define.amd != null)) {\n    return define([], factory);\n  } else if (typeof exports !== \"undefined\" && exports !== null) {\n    return module.exports = factory();\n  } else {\n    return root.UrlPattern = factory();\n  }\n})(this, function() {\n  var P, UrlPattern, astNodeContainsSegmentsForProvidedParams, astNodeToNames, astNodeToRegexString, baseAstNodeToRegexString, concatMap, defaultOptions, escapeForRegex, getParam, keysAndValuesToObject, newParser, regexGroupCount, stringConcatMap, stringify;\n  escapeForRegex = function(string) {\n    return string.replace(/[-\\/\\\\^$*+?.()|[\\]{}]/g, '\\\\$&');\n  };\n  concatMap = function(array, f) {\n    var i, length, results;\n    results = [];\n    i = -1;\n    length = array.length;\n    while (++i < length) {\n      results = results.concat(f(array[i]));\n    }\n    return results;\n  };\n  stringConcatMap = function(array, f) {\n    var i, length, result;\n    result = '';\n    i = -1;\n    length = array.length;\n    while (++i < length) {\n      result += f(array[i]);\n    }\n    return result;\n  };\n  regexGroupCount = function(regex) {\n    return (new RegExp(regex.toString() + '|')).exec('').length - 1;\n  };\n  keysAndValuesToObject = function(keys, values) {\n    var i, key, length, object, value;\n    object = {};\n    i = -1;\n    length = keys.length;\n    while (++i < length) {\n      key = keys[i];\n      value = values[i];\n      if (value == null) {\n        continue;\n      }\n      if (object[key] != null) {\n        if (!Array.isArray(object[key])) {\n          object[key] = [object[key]];\n        }\n        object[key].push(value);\n      } else {\n        object[key] = value;\n      }\n    }\n    return object;\n  };\n  P = {};\n  P.Result = function(value, rest) {\n    this.value = value;\n    this.rest = rest;\n  };\n  P.Tagged = function(tag, value) {\n    this.tag = tag;\n    this.value = value;\n  };\n  P.tag = function(tag, parser) {\n    return function(input) {\n      var result, tagged;\n      result = parser(input);\n      if (result == null) {\n        return;\n      }\n      tagged = new P.Tagged(tag, result.value);\n      return new P.Result(tagged, result.rest);\n    };\n  };\n  P.regex = function(regex) {\n    return function(input) {\n      var matches, result;\n      matches = regex.exec(input);\n      if (matches == null) {\n        return;\n      }\n      result = matches[0];\n      return new P.Result(result, input.slice(result.length));\n    };\n  };\n  P.sequence = function() {\n    var parsers;\n    parsers = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n    return function(input) {\n      var i, length, parser, rest, result, values;\n      i = -1;\n      length = parsers.length;\n      values = [];\n      rest = input;\n      while (++i < length) {\n        parser = parsers[i];\n        result = parser(rest);\n        if (result == null) {\n          return;\n        }\n        values.push(result.value);\n        rest = result.rest;\n      }\n      return new P.Result(values, rest);\n    };\n  };\n  P.pick = function() {\n    var indexes, parsers;\n    indexes = arguments[0], parsers = 2 <= arguments.length ? slice.call(arguments, 1) : [];\n    return function(input) {\n      var array, result;\n      result = P.sequence.apply(P, parsers)(input);\n      if (result == null) {\n        return;\n      }\n      array = result.value;\n      result.value = array[indexes];\n      return result;\n    };\n  };\n  P.string = function(string) {\n    var length;\n    length = string.length;\n    return function(input) {\n      if (input.slice(0, length) === string) {\n        return new P.Result(string, input.slice(length));\n      }\n    };\n  };\n  P.lazy = function(fn) {\n    var cached;\n    cached = null;\n    return function(input) {\n      if (cached == null) {\n        cached = fn();\n      }\n      return cached(input);\n    };\n  };\n  P.baseMany = function(parser, end, stringResult, atLeastOneResultRequired, input) {\n    var endResult, parserResult, rest, results;\n    rest = input;\n    results = stringResult ? '' : [];\n    while (true) {\n      if (end != null) {\n        endResult = end(rest);\n        if (endResult != null) {\n          break;\n        }\n      }\n      parserResult = parser(rest);\n      if (parserResult == null) {\n        break;\n      }\n      if (stringResult) {\n        results += parserResult.value;\n      } else {\n        results.push(parserResult.value);\n      }\n      rest = parserResult.rest;\n    }\n    if (atLeastOneResultRequired && results.length === 0) {\n      return;\n    }\n    return new P.Result(results, rest);\n  };\n  P.many1 = function(parser) {\n    return function(input) {\n      return P.baseMany(parser, null, false, true, input);\n    };\n  };\n  P.concatMany1Till = function(parser, end) {\n    return function(input) {\n      return P.baseMany(parser, end, true, true, input);\n    };\n  };\n  P.firstChoice = function() {\n    var parsers;\n    parsers = 1 <= arguments.length ? slice.call(arguments, 0) : [];\n    return function(input) {\n      var i, length, parser, result;\n      i = -1;\n      length = parsers.length;\n      while (++i < length) {\n        parser = parsers[i];\n        result = parser(input);\n        if (result != null) {\n          return result;\n        }\n      }\n    };\n  };\n  newParser = function(options) {\n    var U;\n    U = {};\n    U.wildcard = P.tag('wildcard', P.string(options.wildcardChar));\n    U.optional = P.tag('optional', P.pick(1, P.string(options.optionalSegmentStartChar), P.lazy(function() {\n      return U.pattern;\n    }), P.string(options.optionalSegmentEndChar)));\n    U.name = P.regex(new RegExp(\"^[\" + options.segmentNameCharset + \"]+\"));\n    U.named = P.tag('named', P.pick(1, P.string(options.segmentNameStartChar), P.lazy(function() {\n      return U.name;\n    })));\n    U.escapedChar = P.pick(1, P.string(options.escapeChar), P.regex(/^./));\n    U[\"static\"] = P.tag('static', P.concatMany1Till(P.firstChoice(P.lazy(function() {\n      return U.escapedChar;\n    }), P.regex(/^./)), P.firstChoice(P.string(options.segmentNameStartChar), P.string(options.optionalSegmentStartChar), P.string(options.optionalSegmentEndChar), U.wildcard)));\n    U.token = P.lazy(function() {\n      return P.firstChoice(U.wildcard, U.optional, U.named, U[\"static\"]);\n    });\n    U.pattern = P.many1(P.lazy(function() {\n      return U.token;\n    }));\n    return U;\n  };\n  defaultOptions = {\n    escapeChar: '\\\\',\n    segmentNameStartChar: ':',\n    segmentValueCharset: 'a-zA-Z0-9-_~ %',\n    segmentNameCharset: 'a-zA-Z0-9',\n    optionalSegmentStartChar: '(',\n    optionalSegmentEndChar: ')',\n    wildcardChar: '*'\n  };\n  baseAstNodeToRegexString = function(astNode, segmentValueCharset) {\n    if (Array.isArray(astNode)) {\n      return stringConcatMap(astNode, function(node) {\n        return baseAstNodeToRegexString(node, segmentValueCharset);\n      });\n    }\n    switch (astNode.tag) {\n      case 'wildcard':\n        return '(.*?)';\n      case 'named':\n        return \"([\" + segmentValueCharset + \"]+)\";\n      case 'static':\n        return escapeForRegex(astNode.value);\n      case 'optional':\n        return '(?:' + baseAstNodeToRegexString(astNode.value, segmentValueCharset) + ')?';\n    }\n  };\n  astNodeToRegexString = function(astNode, segmentValueCharset) {\n    if (segmentValueCharset == null) {\n      segmentValueCharset = defaultOptions.segmentValueCharset;\n    }\n    return '^' + baseAstNodeToRegexString(astNode, segmentValueCharset) + '$';\n  };\n  astNodeToNames = function(astNode) {\n    if (Array.isArray(astNode)) {\n      return concatMap(astNode, astNodeToNames);\n    }\n    switch (astNode.tag) {\n      case 'wildcard':\n        return ['_'];\n      case 'named':\n        return [astNode.value];\n      case 'static':\n        return [];\n      case 'optional':\n        return astNodeToNames(astNode.value);\n    }\n  };\n  getParam = function(params, key, nextIndexes, sideEffects) {\n    var index, maxIndex, result, value;\n    if (sideEffects == null) {\n      sideEffects = false;\n    }\n    value = params[key];\n    if (value == null) {\n      if (sideEffects) {\n        throw new Error(\"no values provided for key `\" + key + \"`\");\n      } else {\n        return;\n      }\n    }\n    index = nextIndexes[key] || 0;\n    maxIndex = Array.isArray(value) ? value.length - 1 : 0;\n    if (index > maxIndex) {\n      if (sideEffects) {\n        throw new Error(\"too few values provided for key `\" + key + \"`\");\n      } else {\n        return;\n      }\n    }\n    result = Array.isArray(value) ? value[index] : value;\n    if (sideEffects) {\n      nextIndexes[key] = index + 1;\n    }\n    return result;\n  };\n  astNodeContainsSegmentsForProvidedParams = function(astNode, params, nextIndexes) {\n    var i, length;\n    if (Array.isArray(astNode)) {\n      i = -1;\n      length = astNode.length;\n      while (++i < length) {\n        if (astNodeContainsSegmentsForProvidedParams(astNode[i], params, nextIndexes)) {\n          return true;\n        }\n      }\n      return false;\n    }\n    switch (astNode.tag) {\n      case 'wildcard':\n        return getParam(params, '_', nextIndexes, false) != null;\n      case 'named':\n        return getParam(params, astNode.value, nextIndexes, false) != null;\n      case 'static':\n        return false;\n      case 'optional':\n        return astNodeContainsSegmentsForProvidedParams(astNode.value, params, nextIndexes);\n    }\n  };\n  stringify = function(astNode, params, nextIndexes) {\n    if (Array.isArray(astNode)) {\n      return stringConcatMap(astNode, function(node) {\n        return stringify(node, params, nextIndexes);\n      });\n    }\n    switch (astNode.tag) {\n      case 'wildcard':\n        return getParam(params, '_', nextIndexes, true);\n      case 'named':\n        return getParam(params, astNode.value, nextIndexes, true);\n      case 'static':\n        return astNode.value;\n      case 'optional':\n        if (astNodeContainsSegmentsForProvidedParams(astNode.value, params, nextIndexes)) {\n          return stringify(astNode.value, params, nextIndexes);\n        } else {\n          return '';\n        }\n    }\n  };\n  UrlPattern = function(arg1, arg2) {\n    var groupCount, options, parsed, parser, withoutWhitespace;\n    if (arg1 instanceof UrlPattern) {\n      this.isRegex = arg1.isRegex;\n      this.regex = arg1.regex;\n      this.ast = arg1.ast;\n      this.names = arg1.names;\n      return;\n    }\n    this.isRegex = arg1 instanceof RegExp;\n    if (!(('string' === typeof arg1) || this.isRegex)) {\n      throw new TypeError('argument must be a regex or a string');\n    }\n    if (this.isRegex) {\n      this.regex = arg1;\n      if (arg2 != null) {\n        if (!Array.isArray(arg2)) {\n          throw new Error('if first argument is a regex the second argument may be an array of group names but you provided something else');\n        }\n        groupCount = regexGroupCount(this.regex);\n        if (arg2.length !== groupCount) {\n          throw new Error(\"regex contains \" + groupCount + \" groups but array of group names contains \" + arg2.length);\n        }\n        this.names = arg2;\n      }\n      return;\n    }\n    if (arg1 === '') {\n      throw new Error('argument must not be the empty string');\n    }\n    withoutWhitespace = arg1.replace(/\\s+/g, '');\n    if (withoutWhitespace !== arg1) {\n      throw new Error('argument must not contain whitespace');\n    }\n    options = {\n      escapeChar: (arg2 != null ? arg2.escapeChar : void 0) || defaultOptions.escapeChar,\n      segmentNameStartChar: (arg2 != null ? arg2.segmentNameStartChar : void 0) || defaultOptions.segmentNameStartChar,\n      segmentNameCharset: (arg2 != null ? arg2.segmentNameCharset : void 0) || defaultOptions.segmentNameCharset,\n      segmentValueCharset: (arg2 != null ? arg2.segmentValueCharset : void 0) || defaultOptions.segmentValueCharset,\n      optionalSegmentStartChar: (arg2 != null ? arg2.optionalSegmentStartChar : void 0) || defaultOptions.optionalSegmentStartChar,\n      optionalSegmentEndChar: (arg2 != null ? arg2.optionalSegmentEndChar : void 0) || defaultOptions.optionalSegmentEndChar,\n      wildcardChar: (arg2 != null ? arg2.wildcardChar : void 0) || defaultOptions.wildcardChar\n    };\n    parser = newParser(options);\n    parsed = parser.pattern(arg1);\n    if (parsed == null) {\n      throw new Error(\"couldn't parse pattern\");\n    }\n    if (parsed.rest !== '') {\n      throw new Error(\"could only partially parse pattern\");\n    }\n    this.ast = parsed.value;\n    this.regex = new RegExp(astNodeToRegexString(this.ast, options.segmentValueCharset));\n    this.names = astNodeToNames(this.ast);\n  };\n  UrlPattern.prototype.match = function(url) {\n    var groups, match;\n    match = this.regex.exec(url);\n    if (match == null) {\n      return null;\n    }\n    groups = match.slice(1);\n    if (this.names) {\n      return keysAndValuesToObject(this.names, groups);\n    } else {\n      return groups;\n    }\n  };\n  UrlPattern.prototype.stringify = function(params) {\n    if (params == null) {\n      params = {};\n    }\n    if (this.isRegex) {\n      throw new Error(\"can't stringify patterns generated from a regex\");\n    }\n    if (params !== Object(params)) {\n      throw new Error(\"argument must be an object or undefined\");\n    }\n    return stringify(this.ast, params, {});\n  };\n  UrlPattern.escapeForRegex = escapeForRegex;\n  UrlPattern.concatMap = concatMap;\n  UrlPattern.stringConcatMap = stringConcatMap;\n  UrlPattern.regexGroupCount = regexGroupCount;\n  UrlPattern.keysAndValuesToObject = keysAndValuesToObject;\n  UrlPattern.P = P;\n  UrlPattern.newParser = newParser;\n  UrlPattern.defaultOptions = defaultOptions;\n  UrlPattern.astNodeToRegexString = astNodeToRegexString;\n  UrlPattern.astNodeToNames = astNodeToNames;\n  UrlPattern.getParam = getParam;\n  UrlPattern.astNodeContainsSegmentsForProvidedParams = astNodeContainsSegmentsForProvidedParams;\n  UrlPattern.stringify = stringify;\n  return UrlPattern;\n});\n","var AgnosticRouter = require('agnostic-router');\nvar Utils = require('./Utils');\nmodule.exports = {\n\t_sanitizeArgumentConfig: function(argumentConfigDirty) {\n\t\tvar argumentConfigDefault = {level: 0};\n\t\tvar argumentConfigSanitized = Utils.objectMerge(argumentConfigDefault, argumentConfigDirty);\n\t\tif(typeof argumentConfigSanitized.source == 'undefined')\n\t\t\targumentConfigSanitized.source = [];\n\t\telse if(!Array.isArray(argumentConfigSanitized.source))\n\t\t\targumentConfigSanitized.source = [argumentConfigSanitized.source];\n\t\treturn argumentConfigSanitized;\n\t},\n\t// Generate an object with functions\n\ttoObject: function(apiConfig, callback) {\n\t\tvar self = this;\n\t\tvar object = {};\n\n\t\t// Get UrlPattern\n\t\tvar router = AgnosticRouter();\n\t\tvar UrlPattern = router.UrlPattern;\n\n\t\tUtils.objectForEach(apiConfig, function(functionConfig, functionName) {\n\t\t\tif(typeof functionConfig.pattern != 'string')\n\t\t\t\tthrow new Error('pattern_undefined');\n\n\t\t\tvar urlPattern = new UrlPattern(functionConfig.pattern);\n\t\t\tvar argumentsConfig = Array.isArray(functionConfig.arguments) ? functionConfig.arguments : [];\n\n\t\t\tobject[functionName] = function() {\n\t\t\t\t// Get callback (last argument)\n\t\t\t\tvar argumentsArray = Array.prototype.slice.call(arguments);\n\t\t\t\tif(argumentsArray.length > 0 && typeof argumentsArray[argumentsArray.length - 1] == 'function')\n\t\t\t\t\tvar functionCallback = argumentsArray.pop();\n\n\t\t\t\tvar parsedFunctionArguments = Utils.parseArgs(argumentsArray, argumentsConfig);\n\t\t\t\tvar requestArguments = {};\n\n\t\t\t\targumentsConfig.forEach(function(argumentConfig) {\n\t\t\t\t\tvar argumentConfigSanitized = self._sanitizeArgumentConfig(argumentConfig);\n\t\t\t\t\tUtils.objectSet(requestArguments, argumentConfigSanitized.source.concat([argumentConfigSanitized.name]), parsedFunctionArguments[argumentConfigSanitized.name]);\n\t\t\t\t});\n\n\t\t\t\tvar urlPath = urlPattern.stringify(requestArguments.params);\n\t\t\t\tcallback(functionName, urlPath, requestArguments, functionCallback);\n\t\t\t};\n\t\t});\n\n\t\treturn object;\n\t},\n\ttoRouter: function(apiConfig, targetObject, router) {\n\t\tvar self = this;\n\t\tif(typeof router != 'object')\n\t\t\trouter = AgnosticRouter();\n\n\t\tUtils.objectForEach(apiConfig, function(functionConfig, functionName) {\n\t\t\tif(typeof functionConfig.pattern != 'string')\n\t\t\t\tthrow new Error('pattern_undefined');\n\n\t\t\trouter.use(functionConfig.pattern, function(request, respond, next) {\n\n\t\t\t\tvar parsedArgs = [];\n\t\t\t\tif(Array.isArray(functionConfig.arguments)) {\n\t\t\t\t\tfunctionConfig.arguments.forEach(function(argumentConfig) { // Loop over arguments of function\n\t\t\t\t\t\tvar argumentConfigSanitized = self._sanitizeArgumentConfig(argumentConfig);\n\t\t\t\t\t\tvar argumentRequestPath = argumentConfigSanitized.source.concat(argumentConfigSanitized.name);\n\t\t\t\t\t\tif(argumentConfigSanitized.level == 0 || Utils.objectIsset(request, argumentRequestPath)) // argument is required or exists\n\t\t\t\t\t\t\tparsedArgs.push(Utils.objectGet(request, argumentRequestPath)); // add the argument to the array to pass\n\t\t\t\t\t});\n\t\t\t\t}\n\n\t\t\t\ttargetObject[functionName].apply(targetObject, parsedArgs.concat([respond])); // Add the callback at the end\n\t\t\t});\n\t\t});\n\n\t\treturn router;\n\t}\n};","// Utils module 1.0.12 MINI\nvar Utils = {};\n\nUtils.objectMerge = function() {\n\tvar merged = {};\n\tthis.objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\n\nUtils.objectFilter = function(object, filter) {\n\t// filter object properties (children) using filter function\n\t// similar to array filter function\n\tvar result = {};\n\tthis.objectForEach(object, function(child, property, parent) {\n\t\tif(filter(child, property, parent))\n\t\t\tresult[property] = child;\n\t});\n\treturn result;\n};\n\nUtils.objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nUtils.objectGet = function(object, keys) {\n\tvar self = this;\n\tif(keys.length == 0)\n\t\treturn object;\n\telse if(typeof object === \"object\") {\n\t\tif((typeof keys[0] === \"string\" || typeof keys[0] === \"number\") && object !== null && object.hasOwnProperty(keys[0]))\n\t\t\treturn this.objectGet(object[keys[0]], keys.slice(1));\n\t\telse if(keys[0] === null) { // get all\n\t\t\tif(Array.isArray(object)) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof RegExp) { // match keys to regexp\n\t\t\tvar results = {};\n\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\tif(key.match(keys[0]))\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t});\n\t\t\treturn results;\n\t\t}\n\t\telse if(typeof keys[0] === \"function\") { // apply a filtering function\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(value, index, parent) {\n\t\t\t\t\tif(keys[0](value, index, parent)) // filter function\n\t\t\t\t\t\tresults[index] = self.objectGet(value, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilter(object, keys[0]), function(result, key) {\n\t\t\t\t\tresults[key] = self.objectGet(result, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof Array) { // all members with keys in array\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tkeys[0].forEach(function(value, index) {\n\t\t\t\t\tresults[index] = object[index];\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilterProperties(object, keys[0]), function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t}\n\telse\n\t\treturn;\n};\n\nUtils.objectSet = function(object, keys, value) {\n\tif(keys.length == 1) {\n\t\tobject[keys[0]] = value;\n\t\treturn true;\n\t}\n\telse {\n\t\tif(typeof(object[keys[0]]) === \"undefined\")\n\t\t\tobject[keys[0]] = {}; // set empty object so we can descend into it\n\t\treturn this.objectSet(object[keys[0]], keys.slice(1), value);\n\t}\n};\n\nUtils.objectIsset = function(object, keys) {\n\tif(keys.length == 1)\n\t\treturn (typeof(object[keys[0]]) !== \"undefined\");\n\telse if(typeof(object[keys[0]]) === \"undefined\") // current level doesn't exist\n\t\treturn false;\n\telse\n\t\treturn this.objectIsset(object[keys[0]], keys.slice(1));\n};\n\nUtils.parseArgs = function(argsPassed, argsConfig) {\n\tvar matched = {};\n\n\tfunction toLevels(argsConfig, level) {\n\t\tif(typeof level !== 'number')\n\t\t\tlevel = 0;\n\n\t\tvar levelsArr = [];\n\n\t\targsConfig.forEach(function(argConfig) {\n\t\t\tif(Array.isArray(argConfig))\n\t\t\t\tlevelsArr = levelsArr.concat(toLevels(argConfig, level + 1));\n\t\t\telse {\n\t\t\t\targConfig.level = level;\n\t\t\t\tlevelsArr.push(argConfig);\n\t\t\t}\n\t\t});\n\n\t\treturn levelsArr;\n\t}\n\n\tfunction validArg(argConfig, arg) {\n\t\tif(typeof argConfig.validate == 'function')\n\t\t\treturn argConfig.validate(arg);\n\t\telse if(typeof argConfig.type == 'string')\n\t\t\treturn typeof arg == argConfig.type;\n\t\telse if(Array.isArray(argConfig.types))\n\t\t\treturn argConfig.types.indexOf(typeof arg) >= 0;\n\t\telse\n\t\t\treturn true;\n\t}\n\n\tfunction requiredLeftEnough(argsConfig, minIndex) {\n\t\tfor(var index = minIndex; index < argsConfig.length; index++) {\n\t\t\tif(typeof(argsConfig[index]) === 'undefined' || !argsConfig[index].required)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar argConfigMin = 0;\n\n\tif(!Array.isArray(argsPassed))\n\t\targsPassed = Array.prototype.slice.call(argsPassed);\n\n\targsPassed.forEach(function(arg, index) {\n\t\tfor(var ctr = argConfigMin; ctr < argsConfig.length; ctr++) {\n\t\t\tif(argsConfig[ctr].required) {\n\t\t\t\tif(validArg(argsConfig[ctr], arg)) {\n\t\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\t\targConfigMin++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthrow \"missing_required\";\n\t\t\t}\n\t\t\telse if((!argsConfig[ctr].required && (requiredLeftEnough(argsConfig, ctr) || (argsConfig[ctr].level > argsConfig[ctr - 1].level && argsConfig[ctr - 1].matched))) && validArg(argsConfig[ctr], arg)) {\n\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\targConfigMin++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targsConfig[ctr].matched = false;\n\t\t\t\targConfigMin++;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Add default options, if set\n\targsConfig.forEach(function(argConfig) {\n\t\tif(typeof matched[argConfig.name] == 'undefined' && typeof argConfig.default != 'undefined')\n\t\t\tmatched[argConfig.name] = argConfig.default;\n\t});\n\n\treturn matched;\n};\n\nmodule.exports = Utils;","var UrlPattern = require('url-pattern');\n\nfunction Router() {\n\tthis.useRoutes = [];\n\tthis.methodRoutes = {};\n\tthis.index = 0;\n}\n\nRouter.prototype.route = function() {\n\t// takes method, path, [request], respond\n\tif(arguments.length == 3) {\n\t\tvar request = {};\n\t\tvar respond = arguments[2];\n\t}\n\telse if(arguments.length >= 4) {\n\t\tvar request = arguments[2];\n\t\tif(typeof request !== \"object\" || !request)\n\t\t\trequest = {};\n\t\tvar respond = arguments[3];\n\t}\n\trequest.method = arguments[0];\n\n\tvar path = arguments[1];\n\tif(typeof request.path === 'undefined') // only overwrite path if doesn't already exist (carries through all routers)\n\t\trequest.path = path;\n\n\tvar queueEnd = arguments[4];\n\n\tvar routeMatches = this._methodPathMatches(request.method, path);\n\tqueueNext();\n\n\tfunction queueNext() {\n\t\tvar routeMatch = routeMatches.shift();\n\t\tif(typeof routeMatch !== \"undefined\") {\n\t\t\trequest.params = routeMatch.params; // overwrite params on each new route match\n\t\t\tif(typeof routeMatch.handler === \"function\")\n\t\t\t\trouteMatch.handler(request, respond, queueNext);\n\t\t\telse if(Router._isRouter(routeMatch.handler))\n\t\t\t\trouteMatch.handler.route(request.method, '/' + request.params['_'], request, respond, queueNext); // cycle through the router, then rejoin the queue\n\t\t\telse // route handler isn't a function or a router\n\t\t\t\tqueueNext();\n\t\t}\n\t\telse if(typeof queueEnd === 'function') // reached the end of the queue\n\t\t\tqueueEnd();\n\t}\n\n};\n\nRouter.prototype.use = function() {\n\t// [path], handler\n\tvar path = (typeof arguments[0] === 'string') ? arguments[0] : '';\n\tvar handler = Router._validHandler(arguments[0]) ? arguments[0] : arguments[1];\n\n\treturn this._addRouteToArray(this.useRoutes, Router._normalizePath(path), handler);\n};\n\nRouter.prototype.useFirst = function() {\n\t// [path], handler\n\tvar path = (typeof arguments[0] === 'string') ? arguments[0] : '';\n\tvar handler = Router._validHandler(arguments[0]) ? arguments[0] : arguments[1];\n\n\treturn this._addRouteToArray(this.useRoutes, Router._normalizePath(path), handler, true);\n};\n\nRouter.prototype.method = function(method, path, handler) {\n\tif(!(this.methodRoutes[method] instanceof Array)) // create the stack if it doesn't exist\n\t\tthis.methodRoutes[method] = [];\n\treturn this._addRouteToArray(this.methodRoutes[method], Router._normalizePath(path), handler);\n};\n\n/* Private functions */\nRouter._validHandler = function(handler) {\n\treturn (typeof handler === 'function' || Router._isRouter(handler)); // must be function or router\n};\n\nRouter._isRouter = function(handler) {\n\treturn (typeof handler === 'object' && typeof handler.route === 'function'); // must be function or router\n};\n\nRouter._normalizePath = function(path) {\n\treturn path.replace(/\\/$/, ''); // strip trailing slash\n};\n\nRouter.prototype._methodPathMatches = function(method, path) {\n\tvar pathNormalized = Router._normalizePath(path);\n\tvar matches = [];\n\tvar self = this;\n\n\tself.useRoutes.forEach(function(route) {\n\t\tvar routeMatch = (new UrlPattern(route.path + '(/*)')).match(pathNormalized);\n\t\t//console.log(\"RU\", routeMatch, route.path, pathNormalized);\n\t\tif(routeMatch !== null)\n\t\t\tmatches.push({path: route.path, handler: route.handler, params: routeMatch});\n\t});\n\n\tif(self.methodRoutes[method] instanceof Array) {\n\t\tself.methodRoutes[method].forEach(function(route) {\n\t\t\tvar routeMatch = (new UrlPattern(route.path)).match(pathNormalized);\n\t\t\t//console.log(\"RM\", route.path, pathNormalized, routeMatch);\n\t\t\tif(routeMatch !== null)\n\t\t\t\tmatches.push({path: route.path, handler: route.handler, params: routeMatch});\n\t\t});\n\t}\n\n\treturn matches;\n};\n\nRouter.prototype._addRouteToArray = function(array, path, handler, prepend) {\n\tvar route = {path: path, handler: handler};\n\tif(typeof prepend === 'boolean') //prepend\n\t\tarray.unshift(route);\n\telse //append\n\t\tarray.push(route);\n};\n\nmodule.exports = function() {\n\treturn new Router();\n};\n","var Utils = require('./Utils');\n\nfunction AgnosticRpc() {\n\tthis._requests = {};\n}\n\nAgnosticRpc.prototype.request = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'query', level: 0,  validate: function(arg, allArgs) { return typeof arg != 'undefined'; }},\n\t\t\t{name: 'options', level: 1,  validate: function(arg, allArgs) { return typeof arg == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\tvar defaultOptions = {\n\t\tmultipleResponses: false\n\t};\n\n\t// TODO add timeout option\n\tvar options = Utils.objectMerge(defaultOptions, parsedArgs.options); // merge options with defaults\n\n\tif(typeof parsedArgs.callback == 'function') {\n\t\tvar requestId = Utils.uniqueId();\n\t\tthis._requests[requestId] = {callback: parsedArgs.callback, options: options};\n\t}\n\n\tvar request = {\n\t\tquery: parsedArgs.query\n\t};\n\n\tif(typeof requestId != 'undefined')\n\t\trequest.id = requestId;\n\n\treturn request;\n};\n\nAgnosticRpc.prototype.handleResponse = function(message) {\n\tif(typeof message.id == 'string') { // responding to a logged request\n\t\tif(typeof this._requests[message.id] == 'object') { // request is logged\n\t\t\tvar request = this._requests[message.id];\n\t\t\tif(typeof request.callback == 'function') // valid callback is logged\n\t\t\t\trequest.callback(null, message.response); // callback with no error\n\t\t\tif(!request.options['multipleResponses'])\n\t\t\t\tdelete this._requests[message.id];\n\t\t}\n\t}\n\t// TODO trigger errors\n};\n\nAgnosticRpc.prototype.handleRequest = function(requestMessage, requestCallback, responseEmitter) {\n\tvar onResponse = function(response) {\n\t\tvar responseMessage = {\n\t\t\tresponse: response\n\t\t};\n\n\t\tif(typeof requestMessage.id == 'string')\n\t\t\tresponseMessage.id = requestMessage.id;\n\n\t\tresponseEmitter(responseMessage);\n\t};\n\n\trequestCallback(requestMessage.query, onResponse);\n\n\t// TODO trigger errors\n};\n\nAgnosticRpc.prototype.messageIsResponse = function(message) {\n\t// response to request from this node\n\treturn (typeof message.response != 'undefined');\n};\n\nAgnosticRpc.prototype.messageIsRequest = function(message) {\n\t// response to request from this node\n\treturn !this.messageIsResponse(message);\n};\n\nmodule.exports = function() {\n\treturn new AgnosticRpc();\n};","var Utils = {};\n\nUtils.objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nUtils.objectMerge = function() {\n\tvar merged = {};\n\tthis.objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\nUtils.uniqueId = function() {\n\tfunction s4() {\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\n\t\t\t.toString(16)\n\t\t\t.substring(1);\n\t}\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n\t\ts4() + '-' + s4() + s4() + s4();\n};\n\nUtils.parseArgs = function(argsPassed, argsConfig) {\n\tvar matched = {};\n\n\tfunction toLevels(argsConfig, level) {\n\t\tif(typeof level !== 'number')\n\t\t\tlevel = 0;\n\n\t\tvar levelsArr = [];\n\n\t\targsConfig.forEach(function(argConfig) {\n\t\t\tif(Array.isArray(argConfig))\n\t\t\t\tlevelsArr = levelsArr.concat(toLevels(argConfig, level + 1));\n\t\t\telse {\n\t\t\t\targConfig.level = level;\n\t\t\t\tlevelsArr.push(argConfig);\n\t\t\t}\n\t\t});\n\n\t\treturn levelsArr;\n\t}\n\n\tfunction validArg(argConfig, arg) {\n\t\treturn typeof argConfig.validate != 'function' || argConfig.validate(arg)\n\t}\n\n\tfunction requiredLeftEnough(argsConfig, minIndex) {\n\t\tfor(var index = minIndex; index < argsConfig.length; index++) {\n\t\t\tif(typeof(argsConfig[index]) === 'undefined' || !argsConfig[index].required)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar argConfigMin = 0;\n\n\tif(!Array.isArray(argsPassed))\n\t\targsPassed = Array.prototype.slice.call(argsPassed);\n\n\targsPassed.forEach(function(arg, index) {\n\t\tfor(var ctr = argConfigMin; ctr < argsConfig.length; ctr++) {\n\t\t\tif(argsConfig[ctr].required) {\n\t\t\t\tif(validArg(argsConfig[ctr], arg)) {\n\t\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\t\targConfigMin++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthrow \"missing_required\";\n\t\t\t}\n\t\t\telse if((!argsConfig[ctr].required && (requiredLeftEnough(argsConfig, ctr) || (argsConfig[ctr].level > argsConfig[ctr - 1].level && argsConfig[ctr - 1].matched))) && validArg(argsConfig[ctr], arg)) {\n\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\targConfigMin++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targsConfig[ctr].matched = false;\n\t\t\t\targConfigMin++;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Add default options, if set\n\targsConfig.forEach(function(argConfig) {\n\t\tif(typeof matched[argConfig.name] == 'undefined' && typeof argConfig.default != 'undefined')\n\t\t\tmatched[argConfig.name] = argConfig.default;\n\t});\n\n\treturn matched;\n};\n\nmodule.exports = Utils;","var lookup = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';\n\n;(function (exports) {\n\t'use strict';\n\n  var Arr = (typeof Uint8Array !== 'undefined')\n    ? Uint8Array\n    : Array\n\n\tvar PLUS   = '+'.charCodeAt(0)\n\tvar SLASH  = '/'.charCodeAt(0)\n\tvar NUMBER = '0'.charCodeAt(0)\n\tvar LOWER  = 'a'.charCodeAt(0)\n\tvar UPPER  = 'A'.charCodeAt(0)\n\tvar PLUS_URL_SAFE = '-'.charCodeAt(0)\n\tvar SLASH_URL_SAFE = '_'.charCodeAt(0)\n\n\tfunction decode (elt) {\n\t\tvar code = elt.charCodeAt(0)\n\t\tif (code === PLUS ||\n\t\t    code === PLUS_URL_SAFE)\n\t\t\treturn 62 // '+'\n\t\tif (code === SLASH ||\n\t\t    code === SLASH_URL_SAFE)\n\t\t\treturn 63 // '/'\n\t\tif (code < NUMBER)\n\t\t\treturn -1 //no match\n\t\tif (code < NUMBER + 10)\n\t\t\treturn code - NUMBER + 26 + 26\n\t\tif (code < UPPER + 26)\n\t\t\treturn code - UPPER\n\t\tif (code < LOWER + 26)\n\t\t\treturn code - LOWER + 26\n\t}\n\n\tfunction b64ToByteArray (b64) {\n\t\tvar i, j, l, tmp, placeHolders, arr\n\n\t\tif (b64.length % 4 > 0) {\n\t\t\tthrow new Error('Invalid string. Length must be a multiple of 4')\n\t\t}\n\n\t\t// the number of equal signs (place holders)\n\t\t// if there are two placeholders, than the two characters before it\n\t\t// represent one byte\n\t\t// if there is only one, then the three characters before it represent 2 bytes\n\t\t// this is just a cheap hack to not do indexOf twice\n\t\tvar len = b64.length\n\t\tplaceHolders = '=' === b64.charAt(len - 2) ? 2 : '=' === b64.charAt(len - 1) ? 1 : 0\n\n\t\t// base64 is 4/3 + up to two characters of the original data\n\t\tarr = new Arr(b64.length * 3 / 4 - placeHolders)\n\n\t\t// if there are placeholders, only get up to the last complete 4 chars\n\t\tl = placeHolders > 0 ? b64.length - 4 : b64.length\n\n\t\tvar L = 0\n\n\t\tfunction push (v) {\n\t\t\tarr[L++] = v\n\t\t}\n\n\t\tfor (i = 0, j = 0; i < l; i += 4, j += 3) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 18) | (decode(b64.charAt(i + 1)) << 12) | (decode(b64.charAt(i + 2)) << 6) | decode(b64.charAt(i + 3))\n\t\t\tpush((tmp & 0xFF0000) >> 16)\n\t\t\tpush((tmp & 0xFF00) >> 8)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\tif (placeHolders === 2) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 2) | (decode(b64.charAt(i + 1)) >> 4)\n\t\t\tpush(tmp & 0xFF)\n\t\t} else if (placeHolders === 1) {\n\t\t\ttmp = (decode(b64.charAt(i)) << 10) | (decode(b64.charAt(i + 1)) << 4) | (decode(b64.charAt(i + 2)) >> 2)\n\t\t\tpush((tmp >> 8) & 0xFF)\n\t\t\tpush(tmp & 0xFF)\n\t\t}\n\n\t\treturn arr\n\t}\n\n\tfunction uint8ToBase64 (uint8) {\n\t\tvar i,\n\t\t\textraBytes = uint8.length % 3, // if we have 1 byte left, pad 2 bytes\n\t\t\toutput = \"\",\n\t\t\ttemp, length\n\n\t\tfunction encode (num) {\n\t\t\treturn lookup.charAt(num)\n\t\t}\n\n\t\tfunction tripletToBase64 (num) {\n\t\t\treturn encode(num >> 18 & 0x3F) + encode(num >> 12 & 0x3F) + encode(num >> 6 & 0x3F) + encode(num & 0x3F)\n\t\t}\n\n\t\t// go through the array every three bytes, we'll deal with trailing stuff later\n\t\tfor (i = 0, length = uint8.length - extraBytes; i < length; i += 3) {\n\t\t\ttemp = (uint8[i] << 16) + (uint8[i + 1] << 8) + (uint8[i + 2])\n\t\t\toutput += tripletToBase64(temp)\n\t\t}\n\n\t\t// pad the end with zeros, but make sure to not forget the extra bytes\n\t\tswitch (extraBytes) {\n\t\t\tcase 1:\n\t\t\t\ttemp = uint8[uint8.length - 1]\n\t\t\t\toutput += encode(temp >> 2)\n\t\t\t\toutput += encode((temp << 4) & 0x3F)\n\t\t\t\toutput += '=='\n\t\t\t\tbreak\n\t\t\tcase 2:\n\t\t\t\ttemp = (uint8[uint8.length - 2] << 8) + (uint8[uint8.length - 1])\n\t\t\t\toutput += encode(temp >> 10)\n\t\t\t\toutput += encode((temp >> 4) & 0x3F)\n\t\t\t\toutput += encode((temp << 2) & 0x3F)\n\t\t\t\toutput += '='\n\t\t\t\tbreak\n\t\t}\n\n\t\treturn output\n\t}\n\n\texports.toByteArray = b64ToByteArray\n\texports.fromByteArray = uint8ToBase64\n}(typeof exports === 'undefined' ? (this.base64js = {}) : exports))\n","/*!\n * The buffer module from node.js, for the browser.\n *\n * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n * @license  MIT\n */\n/* eslint-disable no-proto */\n\n'use strict'\n\nvar base64 = require('base64-js')\nvar ieee754 = require('ieee754')\nvar isArray = require('isarray')\n\nexports.Buffer = Buffer\nexports.SlowBuffer = SlowBuffer\nexports.INSPECT_MAX_BYTES = 50\nBuffer.poolSize = 8192 // not used by this implementation\n\nvar rootParent = {}\n\n/**\n * If `Buffer.TYPED_ARRAY_SUPPORT`:\n *   === true    Use Uint8Array implementation (fastest)\n *   === false   Use Object implementation (most compatible, even IE6)\n *\n * Browsers that support typed arrays are IE 10+, Firefox 4+, Chrome 7+, Safari 5.1+,\n * Opera 11.6+, iOS 4.2+.\n *\n * Due to various browser bugs, sometimes the Object implementation will be used even\n * when the browser supports typed arrays.\n *\n * Note:\n *\n *   - Firefox 4-29 lacks support for adding new properties to `Uint8Array` instances,\n *     See: https://bugzilla.mozilla.org/show_bug.cgi?id=695438.\n *\n *   - Safari 5-7 lacks support for changing the `Object.prototype.constructor` property\n *     on objects.\n *\n *   - Chrome 9-10 is missing the `TypedArray.prototype.subarray` function.\n *\n *   - IE10 has a broken `TypedArray.prototype.subarray` function which returns arrays of\n *     incorrect length in some situations.\n\n * We detect these buggy browsers and set `Buffer.TYPED_ARRAY_SUPPORT` to `false` so they\n * get the Object implementation, which is slower but behaves correctly.\n */\nBuffer.TYPED_ARRAY_SUPPORT = global.TYPED_ARRAY_SUPPORT !== undefined\n  ? global.TYPED_ARRAY_SUPPORT\n  : typedArraySupport()\n\nfunction typedArraySupport () {\n  function Bar () {}\n  try {\n    var arr = new Uint8Array(1)\n    arr.foo = function () { return 42 }\n    arr.constructor = Bar\n    return arr.foo() === 42 && // typed array instances can be augmented\n        arr.constructor === Bar && // constructor can be set\n        typeof arr.subarray === 'function' && // chrome 9-10 lack `subarray`\n        arr.subarray(1, 1).byteLength === 0 // ie10 has broken `subarray`\n  } catch (e) {\n    return false\n  }\n}\n\nfunction kMaxLength () {\n  return Buffer.TYPED_ARRAY_SUPPORT\n    ? 0x7fffffff\n    : 0x3fffffff\n}\n\n/**\n * Class: Buffer\n * =============\n *\n * The Buffer constructor returns instances of `Uint8Array` that are augmented\n * with function properties for all the node `Buffer` API functions. We use\n * `Uint8Array` so that square bracket notation works as expected -- it returns\n * a single octet.\n *\n * By augmenting the instances, we can avoid modifying the `Uint8Array`\n * prototype.\n */\nfunction Buffer (arg) {\n  if (!(this instanceof Buffer)) {\n    // Avoid going through an ArgumentsAdaptorTrampoline in the common case.\n    if (arguments.length > 1) return new Buffer(arg, arguments[1])\n    return new Buffer(arg)\n  }\n\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    this.length = 0\n    this.parent = undefined\n  }\n\n  // Common case.\n  if (typeof arg === 'number') {\n    return fromNumber(this, arg)\n  }\n\n  // Slightly less common case.\n  if (typeof arg === 'string') {\n    return fromString(this, arg, arguments.length > 1 ? arguments[1] : 'utf8')\n  }\n\n  // Unusual.\n  return fromObject(this, arg)\n}\n\nfunction fromNumber (that, length) {\n  that = allocate(that, length < 0 ? 0 : checked(length) | 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) {\n    for (var i = 0; i < length; i++) {\n      that[i] = 0\n    }\n  }\n  return that\n}\n\nfunction fromString (that, string, encoding) {\n  if (typeof encoding !== 'string' || encoding === '') encoding = 'utf8'\n\n  // Assumption: byteLength() return value is always < kMaxLength.\n  var length = byteLength(string, encoding) | 0\n  that = allocate(that, length)\n\n  that.write(string, encoding)\n  return that\n}\n\nfunction fromObject (that, object) {\n  if (Buffer.isBuffer(object)) return fromBuffer(that, object)\n\n  if (isArray(object)) return fromArray(that, object)\n\n  if (object == null) {\n    throw new TypeError('must start with number, buffer, array or string')\n  }\n\n  if (typeof ArrayBuffer !== 'undefined') {\n    if (object.buffer instanceof ArrayBuffer) {\n      return fromTypedArray(that, object)\n    }\n    if (object instanceof ArrayBuffer) {\n      return fromArrayBuffer(that, object)\n    }\n  }\n\n  if (object.length) return fromArrayLike(that, object)\n\n  return fromJsonObject(that, object)\n}\n\nfunction fromBuffer (that, buffer) {\n  var length = checked(buffer.length) | 0\n  that = allocate(that, length)\n  buffer.copy(that, 0, 0, length)\n  return that\n}\n\nfunction fromArray (that, array) {\n  var length = checked(array.length) | 0\n  that = allocate(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\n// Duplicate of fromArray() to keep fromArray() monomorphic.\nfunction fromTypedArray (that, array) {\n  var length = checked(array.length) | 0\n  that = allocate(that, length)\n  // Truncating the elements is probably not what people expect from typed\n  // arrays with BYTES_PER_ELEMENT > 1 but it's compatible with the behavior\n  // of the old Buffer constructor.\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nfunction fromArrayBuffer (that, array) {\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    array.byteLength\n    that = Buffer._augment(new Uint8Array(array))\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that = fromTypedArray(that, new Uint8Array(array))\n  }\n  return that\n}\n\nfunction fromArrayLike (that, array) {\n  var length = checked(array.length) | 0\n  that = allocate(that, length)\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\n// Deserialize { type: 'Buffer', data: [1,2,3,...] } into a Buffer object.\n// Returns a zero-length buffer for inputs that don't conform to the spec.\nfunction fromJsonObject (that, object) {\n  var array\n  var length = 0\n\n  if (object.type === 'Buffer' && isArray(object.data)) {\n    array = object.data\n    length = checked(array.length) | 0\n  }\n  that = allocate(that, length)\n\n  for (var i = 0; i < length; i += 1) {\n    that[i] = array[i] & 255\n  }\n  return that\n}\n\nif (Buffer.TYPED_ARRAY_SUPPORT) {\n  Buffer.prototype.__proto__ = Uint8Array.prototype\n  Buffer.__proto__ = Uint8Array\n} else {\n  // pre-set for values that may exist in the future\n  Buffer.prototype.length = undefined\n  Buffer.prototype.parent = undefined\n}\n\nfunction allocate (that, length) {\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    // Return an augmented `Uint8Array` instance, for best performance\n    that = Buffer._augment(new Uint8Array(length))\n    that.__proto__ = Buffer.prototype\n  } else {\n    // Fallback: Return an object instance of the Buffer class\n    that.length = length\n    that._isBuffer = true\n  }\n\n  var fromPool = length !== 0 && length <= Buffer.poolSize >>> 1\n  if (fromPool) that.parent = rootParent\n\n  return that\n}\n\nfunction checked (length) {\n  // Note: cannot use `length < kMaxLength` here because that fails when\n  // length is NaN (which is otherwise coerced to zero.)\n  if (length >= kMaxLength()) {\n    throw new RangeError('Attempt to allocate Buffer larger than maximum ' +\n                         'size: 0x' + kMaxLength().toString(16) + ' bytes')\n  }\n  return length | 0\n}\n\nfunction SlowBuffer (subject, encoding) {\n  if (!(this instanceof SlowBuffer)) return new SlowBuffer(subject, encoding)\n\n  var buf = new Buffer(subject, encoding)\n  delete buf.parent\n  return buf\n}\n\nBuffer.isBuffer = function isBuffer (b) {\n  return !!(b != null && b._isBuffer)\n}\n\nBuffer.compare = function compare (a, b) {\n  if (!Buffer.isBuffer(a) || !Buffer.isBuffer(b)) {\n    throw new TypeError('Arguments must be Buffers')\n  }\n\n  if (a === b) return 0\n\n  var x = a.length\n  var y = b.length\n\n  var i = 0\n  var len = Math.min(x, y)\n  while (i < len) {\n    if (a[i] !== b[i]) break\n\n    ++i\n  }\n\n  if (i !== len) {\n    x = a[i]\n    y = b[i]\n  }\n\n  if (x < y) return -1\n  if (y < x) return 1\n  return 0\n}\n\nBuffer.isEncoding = function isEncoding (encoding) {\n  switch (String(encoding).toLowerCase()) {\n    case 'hex':\n    case 'utf8':\n    case 'utf-8':\n    case 'ascii':\n    case 'binary':\n    case 'base64':\n    case 'raw':\n    case 'ucs2':\n    case 'ucs-2':\n    case 'utf16le':\n    case 'utf-16le':\n      return true\n    default:\n      return false\n  }\n}\n\nBuffer.concat = function concat (list, length) {\n  if (!isArray(list)) throw new TypeError('list argument must be an Array of Buffers.')\n\n  if (list.length === 0) {\n    return new Buffer(0)\n  }\n\n  var i\n  if (length === undefined) {\n    length = 0\n    for (i = 0; i < list.length; i++) {\n      length += list[i].length\n    }\n  }\n\n  var buf = new Buffer(length)\n  var pos = 0\n  for (i = 0; i < list.length; i++) {\n    var item = list[i]\n    item.copy(buf, pos)\n    pos += item.length\n  }\n  return buf\n}\n\nfunction byteLength (string, encoding) {\n  if (typeof string !== 'string') string = '' + string\n\n  var len = string.length\n  if (len === 0) return 0\n\n  // Use a for loop to avoid recursion\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'ascii':\n      case 'binary':\n      // Deprecated\n      case 'raw':\n      case 'raws':\n        return len\n      case 'utf8':\n      case 'utf-8':\n        return utf8ToBytes(string).length\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return len * 2\n      case 'hex':\n        return len >>> 1\n      case 'base64':\n        return base64ToBytes(string).length\n      default:\n        if (loweredCase) return utf8ToBytes(string).length // assume utf8\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\nBuffer.byteLength = byteLength\n\nfunction slowToString (encoding, start, end) {\n  var loweredCase = false\n\n  start = start | 0\n  end = end === undefined || end === Infinity ? this.length : end | 0\n\n  if (!encoding) encoding = 'utf8'\n  if (start < 0) start = 0\n  if (end > this.length) end = this.length\n  if (end <= start) return ''\n\n  while (true) {\n    switch (encoding) {\n      case 'hex':\n        return hexSlice(this, start, end)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Slice(this, start, end)\n\n      case 'ascii':\n        return asciiSlice(this, start, end)\n\n      case 'binary':\n        return binarySlice(this, start, end)\n\n      case 'base64':\n        return base64Slice(this, start, end)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return utf16leSlice(this, start, end)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = (encoding + '').toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toString = function toString () {\n  var length = this.length | 0\n  if (length === 0) return ''\n  if (arguments.length === 0) return utf8Slice(this, 0, length)\n  return slowToString.apply(this, arguments)\n}\n\nBuffer.prototype.equals = function equals (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return true\n  return Buffer.compare(this, b) === 0\n}\n\nBuffer.prototype.inspect = function inspect () {\n  var str = ''\n  var max = exports.INSPECT_MAX_BYTES\n  if (this.length > 0) {\n    str = this.toString('hex', 0, max).match(/.{2}/g).join(' ')\n    if (this.length > max) str += ' ... '\n  }\n  return '<Buffer ' + str + '>'\n}\n\nBuffer.prototype.compare = function compare (b) {\n  if (!Buffer.isBuffer(b)) throw new TypeError('Argument must be a Buffer')\n  if (this === b) return 0\n  return Buffer.compare(this, b)\n}\n\nBuffer.prototype.indexOf = function indexOf (val, byteOffset) {\n  if (byteOffset > 0x7fffffff) byteOffset = 0x7fffffff\n  else if (byteOffset < -0x80000000) byteOffset = -0x80000000\n  byteOffset >>= 0\n\n  if (this.length === 0) return -1\n  if (byteOffset >= this.length) return -1\n\n  // Negative offsets start from the end of the buffer\n  if (byteOffset < 0) byteOffset = Math.max(this.length + byteOffset, 0)\n\n  if (typeof val === 'string') {\n    if (val.length === 0) return -1 // special case: looking for empty string always fails\n    return String.prototype.indexOf.call(this, val, byteOffset)\n  }\n  if (Buffer.isBuffer(val)) {\n    return arrayIndexOf(this, val, byteOffset)\n  }\n  if (typeof val === 'number') {\n    if (Buffer.TYPED_ARRAY_SUPPORT && Uint8Array.prototype.indexOf === 'function') {\n      return Uint8Array.prototype.indexOf.call(this, val, byteOffset)\n    }\n    return arrayIndexOf(this, [ val ], byteOffset)\n  }\n\n  function arrayIndexOf (arr, val, byteOffset) {\n    var foundIndex = -1\n    for (var i = 0; byteOffset + i < arr.length; i++) {\n      if (arr[byteOffset + i] === val[foundIndex === -1 ? 0 : i - foundIndex]) {\n        if (foundIndex === -1) foundIndex = i\n        if (i - foundIndex + 1 === val.length) return byteOffset + foundIndex\n      } else {\n        foundIndex = -1\n      }\n    }\n    return -1\n  }\n\n  throw new TypeError('val must be string, number or Buffer')\n}\n\n// `get` is deprecated\nBuffer.prototype.get = function get (offset) {\n  console.log('.get() is deprecated. Access using array indexes instead.')\n  return this.readUInt8(offset)\n}\n\n// `set` is deprecated\nBuffer.prototype.set = function set (v, offset) {\n  console.log('.set() is deprecated. Access using array indexes instead.')\n  return this.writeUInt8(v, offset)\n}\n\nfunction hexWrite (buf, string, offset, length) {\n  offset = Number(offset) || 0\n  var remaining = buf.length - offset\n  if (!length) {\n    length = remaining\n  } else {\n    length = Number(length)\n    if (length > remaining) {\n      length = remaining\n    }\n  }\n\n  // must be an even number of digits\n  var strLen = string.length\n  if (strLen % 2 !== 0) throw new Error('Invalid hex string')\n\n  if (length > strLen / 2) {\n    length = strLen / 2\n  }\n  for (var i = 0; i < length; i++) {\n    var parsed = parseInt(string.substr(i * 2, 2), 16)\n    if (isNaN(parsed)) throw new Error('Invalid hex string')\n    buf[offset + i] = parsed\n  }\n  return i\n}\n\nfunction utf8Write (buf, string, offset, length) {\n  return blitBuffer(utf8ToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nfunction asciiWrite (buf, string, offset, length) {\n  return blitBuffer(asciiToBytes(string), buf, offset, length)\n}\n\nfunction binaryWrite (buf, string, offset, length) {\n  return asciiWrite(buf, string, offset, length)\n}\n\nfunction base64Write (buf, string, offset, length) {\n  return blitBuffer(base64ToBytes(string), buf, offset, length)\n}\n\nfunction ucs2Write (buf, string, offset, length) {\n  return blitBuffer(utf16leToBytes(string, buf.length - offset), buf, offset, length)\n}\n\nBuffer.prototype.write = function write (string, offset, length, encoding) {\n  // Buffer#write(string)\n  if (offset === undefined) {\n    encoding = 'utf8'\n    length = this.length\n    offset = 0\n  // Buffer#write(string, encoding)\n  } else if (length === undefined && typeof offset === 'string') {\n    encoding = offset\n    length = this.length\n    offset = 0\n  // Buffer#write(string, offset[, length][, encoding])\n  } else if (isFinite(offset)) {\n    offset = offset | 0\n    if (isFinite(length)) {\n      length = length | 0\n      if (encoding === undefined) encoding = 'utf8'\n    } else {\n      encoding = length\n      length = undefined\n    }\n  // legacy write(string, encoding, offset, length) - remove in v0.13\n  } else {\n    var swap = encoding\n    encoding = offset\n    offset = length | 0\n    length = swap\n  }\n\n  var remaining = this.length - offset\n  if (length === undefined || length > remaining) length = remaining\n\n  if ((string.length > 0 && (length < 0 || offset < 0)) || offset > this.length) {\n    throw new RangeError('attempt to write outside buffer bounds')\n  }\n\n  if (!encoding) encoding = 'utf8'\n\n  var loweredCase = false\n  for (;;) {\n    switch (encoding) {\n      case 'hex':\n        return hexWrite(this, string, offset, length)\n\n      case 'utf8':\n      case 'utf-8':\n        return utf8Write(this, string, offset, length)\n\n      case 'ascii':\n        return asciiWrite(this, string, offset, length)\n\n      case 'binary':\n        return binaryWrite(this, string, offset, length)\n\n      case 'base64':\n        // Warning: maxLength not taken into account in base64Write\n        return base64Write(this, string, offset, length)\n\n      case 'ucs2':\n      case 'ucs-2':\n      case 'utf16le':\n      case 'utf-16le':\n        return ucs2Write(this, string, offset, length)\n\n      default:\n        if (loweredCase) throw new TypeError('Unknown encoding: ' + encoding)\n        encoding = ('' + encoding).toLowerCase()\n        loweredCase = true\n    }\n  }\n}\n\nBuffer.prototype.toJSON = function toJSON () {\n  return {\n    type: 'Buffer',\n    data: Array.prototype.slice.call(this._arr || this, 0)\n  }\n}\n\nfunction base64Slice (buf, start, end) {\n  if (start === 0 && end === buf.length) {\n    return base64.fromByteArray(buf)\n  } else {\n    return base64.fromByteArray(buf.slice(start, end))\n  }\n}\n\nfunction utf8Slice (buf, start, end) {\n  end = Math.min(buf.length, end)\n  var res = []\n\n  var i = start\n  while (i < end) {\n    var firstByte = buf[i]\n    var codePoint = null\n    var bytesPerSequence = (firstByte > 0xEF) ? 4\n      : (firstByte > 0xDF) ? 3\n      : (firstByte > 0xBF) ? 2\n      : 1\n\n    if (i + bytesPerSequence <= end) {\n      var secondByte, thirdByte, fourthByte, tempCodePoint\n\n      switch (bytesPerSequence) {\n        case 1:\n          if (firstByte < 0x80) {\n            codePoint = firstByte\n          }\n          break\n        case 2:\n          secondByte = buf[i + 1]\n          if ((secondByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0x1F) << 0x6 | (secondByte & 0x3F)\n            if (tempCodePoint > 0x7F) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 3:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0xC | (secondByte & 0x3F) << 0x6 | (thirdByte & 0x3F)\n            if (tempCodePoint > 0x7FF && (tempCodePoint < 0xD800 || tempCodePoint > 0xDFFF)) {\n              codePoint = tempCodePoint\n            }\n          }\n          break\n        case 4:\n          secondByte = buf[i + 1]\n          thirdByte = buf[i + 2]\n          fourthByte = buf[i + 3]\n          if ((secondByte & 0xC0) === 0x80 && (thirdByte & 0xC0) === 0x80 && (fourthByte & 0xC0) === 0x80) {\n            tempCodePoint = (firstByte & 0xF) << 0x12 | (secondByte & 0x3F) << 0xC | (thirdByte & 0x3F) << 0x6 | (fourthByte & 0x3F)\n            if (tempCodePoint > 0xFFFF && tempCodePoint < 0x110000) {\n              codePoint = tempCodePoint\n            }\n          }\n      }\n    }\n\n    if (codePoint === null) {\n      // we did not generate a valid codePoint so insert a\n      // replacement char (U+FFFD) and advance only 1 byte\n      codePoint = 0xFFFD\n      bytesPerSequence = 1\n    } else if (codePoint > 0xFFFF) {\n      // encode to utf16 (surrogate pair dance)\n      codePoint -= 0x10000\n      res.push(codePoint >>> 10 & 0x3FF | 0xD800)\n      codePoint = 0xDC00 | codePoint & 0x3FF\n    }\n\n    res.push(codePoint)\n    i += bytesPerSequence\n  }\n\n  return decodeCodePointsArray(res)\n}\n\n// Based on http://stackoverflow.com/a/22747272/680742, the browser with\n// the lowest limit is Chrome, with 0x10000 args.\n// We go 1 magnitude less, for safety\nvar MAX_ARGUMENTS_LENGTH = 0x1000\n\nfunction decodeCodePointsArray (codePoints) {\n  var len = codePoints.length\n  if (len <= MAX_ARGUMENTS_LENGTH) {\n    return String.fromCharCode.apply(String, codePoints) // avoid extra slice()\n  }\n\n  // Decode in chunks to avoid \"call stack size exceeded\".\n  var res = ''\n  var i = 0\n  while (i < len) {\n    res += String.fromCharCode.apply(\n      String,\n      codePoints.slice(i, i += MAX_ARGUMENTS_LENGTH)\n    )\n  }\n  return res\n}\n\nfunction asciiSlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i] & 0x7F)\n  }\n  return ret\n}\n\nfunction binarySlice (buf, start, end) {\n  var ret = ''\n  end = Math.min(buf.length, end)\n\n  for (var i = start; i < end; i++) {\n    ret += String.fromCharCode(buf[i])\n  }\n  return ret\n}\n\nfunction hexSlice (buf, start, end) {\n  var len = buf.length\n\n  if (!start || start < 0) start = 0\n  if (!end || end < 0 || end > len) end = len\n\n  var out = ''\n  for (var i = start; i < end; i++) {\n    out += toHex(buf[i])\n  }\n  return out\n}\n\nfunction utf16leSlice (buf, start, end) {\n  var bytes = buf.slice(start, end)\n  var res = ''\n  for (var i = 0; i < bytes.length; i += 2) {\n    res += String.fromCharCode(bytes[i] + bytes[i + 1] * 256)\n  }\n  return res\n}\n\nBuffer.prototype.slice = function slice (start, end) {\n  var len = this.length\n  start = ~~start\n  end = end === undefined ? len : ~~end\n\n  if (start < 0) {\n    start += len\n    if (start < 0) start = 0\n  } else if (start > len) {\n    start = len\n  }\n\n  if (end < 0) {\n    end += len\n    if (end < 0) end = 0\n  } else if (end > len) {\n    end = len\n  }\n\n  if (end < start) end = start\n\n  var newBuf\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    newBuf = Buffer._augment(this.subarray(start, end))\n  } else {\n    var sliceLen = end - start\n    newBuf = new Buffer(sliceLen, undefined)\n    for (var i = 0; i < sliceLen; i++) {\n      newBuf[i] = this[i + start]\n    }\n  }\n\n  if (newBuf.length) newBuf.parent = this.parent || this\n\n  return newBuf\n}\n\n/*\n * Need to make sure that buffer isn't trying to write out of bounds.\n */\nfunction checkOffset (offset, ext, length) {\n  if ((offset % 1) !== 0 || offset < 0) throw new RangeError('offset is not uint')\n  if (offset + ext > length) throw new RangeError('Trying to access beyond buffer length')\n}\n\nBuffer.prototype.readUIntLE = function readUIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUIntBE = function readUIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) {\n    checkOffset(offset, byteLength, this.length)\n  }\n\n  var val = this[offset + --byteLength]\n  var mul = 1\n  while (byteLength > 0 && (mul *= 0x100)) {\n    val += this[offset + --byteLength] * mul\n  }\n\n  return val\n}\n\nBuffer.prototype.readUInt8 = function readUInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  return this[offset]\n}\n\nBuffer.prototype.readUInt16LE = function readUInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return this[offset] | (this[offset + 1] << 8)\n}\n\nBuffer.prototype.readUInt16BE = function readUInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  return (this[offset] << 8) | this[offset + 1]\n}\n\nBuffer.prototype.readUInt32LE = function readUInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return ((this[offset]) |\n      (this[offset + 1] << 8) |\n      (this[offset + 2] << 16)) +\n      (this[offset + 3] * 0x1000000)\n}\n\nBuffer.prototype.readUInt32BE = function readUInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] * 0x1000000) +\n    ((this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    this[offset + 3])\n}\n\nBuffer.prototype.readIntLE = function readIntLE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var val = this[offset]\n  var mul = 1\n  var i = 0\n  while (++i < byteLength && (mul *= 0x100)) {\n    val += this[offset + i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readIntBE = function readIntBE (offset, byteLength, noAssert) {\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkOffset(offset, byteLength, this.length)\n\n  var i = byteLength\n  var mul = 1\n  var val = this[offset + --i]\n  while (i > 0 && (mul *= 0x100)) {\n    val += this[offset + --i] * mul\n  }\n  mul *= 0x80\n\n  if (val >= mul) val -= Math.pow(2, 8 * byteLength)\n\n  return val\n}\n\nBuffer.prototype.readInt8 = function readInt8 (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 1, this.length)\n  if (!(this[offset] & 0x80)) return (this[offset])\n  return ((0xff - this[offset] + 1) * -1)\n}\n\nBuffer.prototype.readInt16LE = function readInt16LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset] | (this[offset + 1] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt16BE = function readInt16BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 2, this.length)\n  var val = this[offset + 1] | (this[offset] << 8)\n  return (val & 0x8000) ? val | 0xFFFF0000 : val\n}\n\nBuffer.prototype.readInt32LE = function readInt32LE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset]) |\n    (this[offset + 1] << 8) |\n    (this[offset + 2] << 16) |\n    (this[offset + 3] << 24)\n}\n\nBuffer.prototype.readInt32BE = function readInt32BE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n\n  return (this[offset] << 24) |\n    (this[offset + 1] << 16) |\n    (this[offset + 2] << 8) |\n    (this[offset + 3])\n}\n\nBuffer.prototype.readFloatLE = function readFloatLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, true, 23, 4)\n}\n\nBuffer.prototype.readFloatBE = function readFloatBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 4, this.length)\n  return ieee754.read(this, offset, false, 23, 4)\n}\n\nBuffer.prototype.readDoubleLE = function readDoubleLE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, true, 52, 8)\n}\n\nBuffer.prototype.readDoubleBE = function readDoubleBE (offset, noAssert) {\n  if (!noAssert) checkOffset(offset, 8, this.length)\n  return ieee754.read(this, offset, false, 52, 8)\n}\n\nfunction checkInt (buf, value, offset, ext, max, min) {\n  if (!Buffer.isBuffer(buf)) throw new TypeError('buffer must be a Buffer instance')\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n}\n\nBuffer.prototype.writeUIntLE = function writeUIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var mul = 1\n  var i = 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUIntBE = function writeUIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  byteLength = byteLength | 0\n  if (!noAssert) checkInt(this, value, offset, byteLength, Math.pow(2, 8 * byteLength), 0)\n\n  var i = byteLength - 1\n  var mul = 1\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = (value / mul) & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeUInt8 = function writeUInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0xff, 0)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nfunction objectWriteUInt16 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 2); i < j; i++) {\n    buf[offset + i] = (value & (0xff << (8 * (littleEndian ? i : 1 - i)))) >>>\n      (littleEndian ? i : 1 - i) * 8\n  }\n}\n\nBuffer.prototype.writeUInt16LE = function writeUInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeUInt16BE = function writeUInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0xffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nfunction objectWriteUInt32 (buf, value, offset, littleEndian) {\n  if (value < 0) value = 0xffffffff + value + 1\n  for (var i = 0, j = Math.min(buf.length - offset, 4); i < j; i++) {\n    buf[offset + i] = (value >>> (littleEndian ? i : 3 - i) * 8) & 0xff\n  }\n}\n\nBuffer.prototype.writeUInt32LE = function writeUInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset + 3] = (value >>> 24)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 1] = (value >>> 8)\n    this[offset] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeUInt32BE = function writeUInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0xffffffff, 0)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeIntLE = function writeIntLE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = 0\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset] = value & 0xFF\n  while (++i < byteLength && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeIntBE = function writeIntBE (value, offset, byteLength, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) {\n    var limit = Math.pow(2, 8 * byteLength - 1)\n\n    checkInt(this, value, offset, byteLength, limit - 1, -limit)\n  }\n\n  var i = byteLength - 1\n  var mul = 1\n  var sub = value < 0 ? 1 : 0\n  this[offset + i] = value & 0xFF\n  while (--i >= 0 && (mul *= 0x100)) {\n    this[offset + i] = ((value / mul) >> 0) - sub & 0xFF\n  }\n\n  return offset + byteLength\n}\n\nBuffer.prototype.writeInt8 = function writeInt8 (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 1, 0x7f, -0x80)\n  if (!Buffer.TYPED_ARRAY_SUPPORT) value = Math.floor(value)\n  if (value < 0) value = 0xff + value + 1\n  this[offset] = (value & 0xff)\n  return offset + 1\n}\n\nBuffer.prototype.writeInt16LE = function writeInt16LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n  } else {\n    objectWriteUInt16(this, value, offset, true)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt16BE = function writeInt16BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 2, 0x7fff, -0x8000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 8)\n    this[offset + 1] = (value & 0xff)\n  } else {\n    objectWriteUInt16(this, value, offset, false)\n  }\n  return offset + 2\n}\n\nBuffer.prototype.writeInt32LE = function writeInt32LE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value & 0xff)\n    this[offset + 1] = (value >>> 8)\n    this[offset + 2] = (value >>> 16)\n    this[offset + 3] = (value >>> 24)\n  } else {\n    objectWriteUInt32(this, value, offset, true)\n  }\n  return offset + 4\n}\n\nBuffer.prototype.writeInt32BE = function writeInt32BE (value, offset, noAssert) {\n  value = +value\n  offset = offset | 0\n  if (!noAssert) checkInt(this, value, offset, 4, 0x7fffffff, -0x80000000)\n  if (value < 0) value = 0xffffffff + value + 1\n  if (Buffer.TYPED_ARRAY_SUPPORT) {\n    this[offset] = (value >>> 24)\n    this[offset + 1] = (value >>> 16)\n    this[offset + 2] = (value >>> 8)\n    this[offset + 3] = (value & 0xff)\n  } else {\n    objectWriteUInt32(this, value, offset, false)\n  }\n  return offset + 4\n}\n\nfunction checkIEEE754 (buf, value, offset, ext, max, min) {\n  if (value > max || value < min) throw new RangeError('value is out of bounds')\n  if (offset + ext > buf.length) throw new RangeError('index out of range')\n  if (offset < 0) throw new RangeError('index out of range')\n}\n\nfunction writeFloat (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 4, 3.4028234663852886e+38, -3.4028234663852886e+38)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 23, 4)\n  return offset + 4\n}\n\nBuffer.prototype.writeFloatLE = function writeFloatLE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeFloatBE = function writeFloatBE (value, offset, noAssert) {\n  return writeFloat(this, value, offset, false, noAssert)\n}\n\nfunction writeDouble (buf, value, offset, littleEndian, noAssert) {\n  if (!noAssert) {\n    checkIEEE754(buf, value, offset, 8, 1.7976931348623157E+308, -1.7976931348623157E+308)\n  }\n  ieee754.write(buf, value, offset, littleEndian, 52, 8)\n  return offset + 8\n}\n\nBuffer.prototype.writeDoubleLE = function writeDoubleLE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, true, noAssert)\n}\n\nBuffer.prototype.writeDoubleBE = function writeDoubleBE (value, offset, noAssert) {\n  return writeDouble(this, value, offset, false, noAssert)\n}\n\n// copy(targetBuffer, targetStart=0, sourceStart=0, sourceEnd=buffer.length)\nBuffer.prototype.copy = function copy (target, targetStart, start, end) {\n  if (!start) start = 0\n  if (!end && end !== 0) end = this.length\n  if (targetStart >= target.length) targetStart = target.length\n  if (!targetStart) targetStart = 0\n  if (end > 0 && end < start) end = start\n\n  // Copy 0 bytes; we're done\n  if (end === start) return 0\n  if (target.length === 0 || this.length === 0) return 0\n\n  // Fatal error conditions\n  if (targetStart < 0) {\n    throw new RangeError('targetStart out of bounds')\n  }\n  if (start < 0 || start >= this.length) throw new RangeError('sourceStart out of bounds')\n  if (end < 0) throw new RangeError('sourceEnd out of bounds')\n\n  // Are we oob?\n  if (end > this.length) end = this.length\n  if (target.length - targetStart < end - start) {\n    end = target.length - targetStart + start\n  }\n\n  var len = end - start\n  var i\n\n  if (this === target && start < targetStart && targetStart < end) {\n    // descending copy from end\n    for (i = len - 1; i >= 0; i--) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else if (len < 1000 || !Buffer.TYPED_ARRAY_SUPPORT) {\n    // ascending copy from start\n    for (i = 0; i < len; i++) {\n      target[i + targetStart] = this[i + start]\n    }\n  } else {\n    target._set(this.subarray(start, start + len), targetStart)\n  }\n\n  return len\n}\n\n// fill(value, start=0, end=buffer.length)\nBuffer.prototype.fill = function fill (value, start, end) {\n  if (!value) value = 0\n  if (!start) start = 0\n  if (!end) end = this.length\n\n  if (end < start) throw new RangeError('end < start')\n\n  // Fill 0 bytes; we're done\n  if (end === start) return\n  if (this.length === 0) return\n\n  if (start < 0 || start >= this.length) throw new RangeError('start out of bounds')\n  if (end < 0 || end > this.length) throw new RangeError('end out of bounds')\n\n  var i\n  if (typeof value === 'number') {\n    for (i = start; i < end; i++) {\n      this[i] = value\n    }\n  } else {\n    var bytes = utf8ToBytes(value.toString())\n    var len = bytes.length\n    for (i = start; i < end; i++) {\n      this[i] = bytes[i % len]\n    }\n  }\n\n  return this\n}\n\n/**\n * Creates a new `ArrayBuffer` with the *copied* memory of the buffer instance.\n * Added in Node 0.12. Only available in browsers that support ArrayBuffer.\n */\nBuffer.prototype.toArrayBuffer = function toArrayBuffer () {\n  if (typeof Uint8Array !== 'undefined') {\n    if (Buffer.TYPED_ARRAY_SUPPORT) {\n      return (new Buffer(this)).buffer\n    } else {\n      var buf = new Uint8Array(this.length)\n      for (var i = 0, len = buf.length; i < len; i += 1) {\n        buf[i] = this[i]\n      }\n      return buf.buffer\n    }\n  } else {\n    throw new TypeError('Buffer.toArrayBuffer not supported in this browser')\n  }\n}\n\n// HELPER FUNCTIONS\n// ================\n\nvar BP = Buffer.prototype\n\n/**\n * Augment a Uint8Array *instance* (not the Uint8Array class!) with Buffer methods\n */\nBuffer._augment = function _augment (arr) {\n  arr.constructor = Buffer\n  arr._isBuffer = true\n\n  // save reference to original Uint8Array set method before overwriting\n  arr._set = arr.set\n\n  // deprecated\n  arr.get = BP.get\n  arr.set = BP.set\n\n  arr.write = BP.write\n  arr.toString = BP.toString\n  arr.toLocaleString = BP.toString\n  arr.toJSON = BP.toJSON\n  arr.equals = BP.equals\n  arr.compare = BP.compare\n  arr.indexOf = BP.indexOf\n  arr.copy = BP.copy\n  arr.slice = BP.slice\n  arr.readUIntLE = BP.readUIntLE\n  arr.readUIntBE = BP.readUIntBE\n  arr.readUInt8 = BP.readUInt8\n  arr.readUInt16LE = BP.readUInt16LE\n  arr.readUInt16BE = BP.readUInt16BE\n  arr.readUInt32LE = BP.readUInt32LE\n  arr.readUInt32BE = BP.readUInt32BE\n  arr.readIntLE = BP.readIntLE\n  arr.readIntBE = BP.readIntBE\n  arr.readInt8 = BP.readInt8\n  arr.readInt16LE = BP.readInt16LE\n  arr.readInt16BE = BP.readInt16BE\n  arr.readInt32LE = BP.readInt32LE\n  arr.readInt32BE = BP.readInt32BE\n  arr.readFloatLE = BP.readFloatLE\n  arr.readFloatBE = BP.readFloatBE\n  arr.readDoubleLE = BP.readDoubleLE\n  arr.readDoubleBE = BP.readDoubleBE\n  arr.writeUInt8 = BP.writeUInt8\n  arr.writeUIntLE = BP.writeUIntLE\n  arr.writeUIntBE = BP.writeUIntBE\n  arr.writeUInt16LE = BP.writeUInt16LE\n  arr.writeUInt16BE = BP.writeUInt16BE\n  arr.writeUInt32LE = BP.writeUInt32LE\n  arr.writeUInt32BE = BP.writeUInt32BE\n  arr.writeIntLE = BP.writeIntLE\n  arr.writeIntBE = BP.writeIntBE\n  arr.writeInt8 = BP.writeInt8\n  arr.writeInt16LE = BP.writeInt16LE\n  arr.writeInt16BE = BP.writeInt16BE\n  arr.writeInt32LE = BP.writeInt32LE\n  arr.writeInt32BE = BP.writeInt32BE\n  arr.writeFloatLE = BP.writeFloatLE\n  arr.writeFloatBE = BP.writeFloatBE\n  arr.writeDoubleLE = BP.writeDoubleLE\n  arr.writeDoubleBE = BP.writeDoubleBE\n  arr.fill = BP.fill\n  arr.inspect = BP.inspect\n  arr.toArrayBuffer = BP.toArrayBuffer\n\n  return arr\n}\n\nvar INVALID_BASE64_RE = /[^+\\/0-9A-Za-z-_]/g\n\nfunction base64clean (str) {\n  // Node strips out invalid characters like \\n and \\t from the string, base64-js does not\n  str = stringtrim(str).replace(INVALID_BASE64_RE, '')\n  // Node converts strings with length < 2 to ''\n  if (str.length < 2) return ''\n  // Node allows for non-padded base64 strings (missing trailing ===), base64-js does not\n  while (str.length % 4 !== 0) {\n    str = str + '='\n  }\n  return str\n}\n\nfunction stringtrim (str) {\n  if (str.trim) return str.trim()\n  return str.replace(/^\\s+|\\s+$/g, '')\n}\n\nfunction toHex (n) {\n  if (n < 16) return '0' + n.toString(16)\n  return n.toString(16)\n}\n\nfunction utf8ToBytes (string, units) {\n  units = units || Infinity\n  var codePoint\n  var length = string.length\n  var leadSurrogate = null\n  var bytes = []\n\n  for (var i = 0; i < length; i++) {\n    codePoint = string.charCodeAt(i)\n\n    // is surrogate component\n    if (codePoint > 0xD7FF && codePoint < 0xE000) {\n      // last char was a lead\n      if (!leadSurrogate) {\n        // no lead yet\n        if (codePoint > 0xDBFF) {\n          // unexpected trail\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        } else if (i + 1 === length) {\n          // unpaired lead\n          if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n          continue\n        }\n\n        // valid lead\n        leadSurrogate = codePoint\n\n        continue\n      }\n\n      // 2 leads in a row\n      if (codePoint < 0xDC00) {\n        if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n        leadSurrogate = codePoint\n        continue\n      }\n\n      // valid surrogate pair\n      codePoint = (leadSurrogate - 0xD800 << 10 | codePoint - 0xDC00) + 0x10000\n    } else if (leadSurrogate) {\n      // valid bmp char, but last char was a lead\n      if ((units -= 3) > -1) bytes.push(0xEF, 0xBF, 0xBD)\n    }\n\n    leadSurrogate = null\n\n    // encode utf8\n    if (codePoint < 0x80) {\n      if ((units -= 1) < 0) break\n      bytes.push(codePoint)\n    } else if (codePoint < 0x800) {\n      if ((units -= 2) < 0) break\n      bytes.push(\n        codePoint >> 0x6 | 0xC0,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x10000) {\n      if ((units -= 3) < 0) break\n      bytes.push(\n        codePoint >> 0xC | 0xE0,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else if (codePoint < 0x110000) {\n      if ((units -= 4) < 0) break\n      bytes.push(\n        codePoint >> 0x12 | 0xF0,\n        codePoint >> 0xC & 0x3F | 0x80,\n        codePoint >> 0x6 & 0x3F | 0x80,\n        codePoint & 0x3F | 0x80\n      )\n    } else {\n      throw new Error('Invalid code point')\n    }\n  }\n\n  return bytes\n}\n\nfunction asciiToBytes (str) {\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    // Node's code seems to be doing this and not & 0x7F..\n    byteArray.push(str.charCodeAt(i) & 0xFF)\n  }\n  return byteArray\n}\n\nfunction utf16leToBytes (str, units) {\n  var c, hi, lo\n  var byteArray = []\n  for (var i = 0; i < str.length; i++) {\n    if ((units -= 2) < 0) break\n\n    c = str.charCodeAt(i)\n    hi = c >> 8\n    lo = c % 256\n    byteArray.push(lo)\n    byteArray.push(hi)\n  }\n\n  return byteArray\n}\n\nfunction base64ToBytes (str) {\n  return base64.toByteArray(base64clean(str))\n}\n\nfunction blitBuffer (src, dst, offset, length) {\n  for (var i = 0; i < length; i++) {\n    if ((i + offset >= dst.length) || (i >= src.length)) break\n    dst[i + offset] = src[i]\n  }\n  return i\n}\n","var toString = {}.toString;\n\nmodule.exports = Array.isArray || function (arr) {\n  return toString.call(arr) == '[object Array]';\n};\n","\r\n/**     @module fauxmongo\r\n    Match MongoDB queries, apply updates and test aggregation pipelines on local documents.\r\n@spare README\r\n    This is the rendered output of the `fauxmongo` source documentation.\r\n    *View the [source](https://github.com/shenanigans/node-fauxmongo) on GitHub!*\r\n    @load\r\n        ./README.md\r\n*/\r\n\r\nvar getBSONType     = require ('./lib/GetBSONType');\r\nvar MatchQuery      = require ('./lib/MatchQuery');\r\nvar Update          = require ('./lib/Update');\r\nvar Merge           = require ('./lib/Merge');\r\nvar Project         = require ('./lib/Project');\r\nvar Aggregate       = require ('./lib/Aggregate');\r\nvar FauxmongoError  = require ('./lib/FauxmongoError');\r\n\r\nmodule.exports.matchQuery = MatchQuery;\r\nmodule.exports.update = Update;\r\nmodule.exports.merge = Merge;\r\nmodule.exports.project = Project;\r\nmodule.exports.aggregate = Aggregate;\r\nmodule.exports.FauxmongoError = FauxmongoError;\r\nmodule.exports.getBSONType = getBSONType;\r\nmodule.exports.resolveDollar = Update.resolveDollar;\r\n","\r\nvar StageOperators = require ('./AggregationStages');\r\nvar evaluate = require ('./AggregationOperators').evaluate;\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar FauxmongoError = require ('./FauxmongoError');\r\n\r\n/**     @property/Function fauxmongo.aggregate\r\n    @root\r\n    @api\r\n    Locally apply a MongoDB aggregation pipeline. Does not affect the input documents. Optionally\r\n    returns the results of each individual stage as well as the final result.\r\n@argument/Array[Object] docs\r\n    An Array of documents to process.\r\n@argument/Array[Object] pipeline\r\n    An Array of stage operator specifications used to select/modify the source documents.\r\n@argument/Boolean keepStages\r\n    @optional\r\n    If true, the return value is an Array containing each Array of results produced by each stage.\r\n    Otherwise the return value is the final result Array.\r\n@returns/Array|Array[Array]\r\n    Either the final result set or an Array containing the result set of each stage.\r\n*/\r\n\r\nfunction aggregate (docs, pipeline, keepStages) {\r\n    var stages;\r\n    if (keepStages)\r\n        stages = [];\r\n\r\n    for (var i in pipeline) {\r\n        var stage = pipeline[i];\r\n        var operator;\r\n        try {\r\n            operator = Object.keys (stage)[0];\r\n        } catch (err) {\r\n            // ignore empty stages\r\n            continue;\r\n        }\r\n        if (operator == '$out') {\r\n            if (i != pipeline.length - 1)\r\n                throw new FauxmongoError (\r\n                    'INVALID',\r\n                    'found an $out stage that was not the final stage'\r\n                );\r\n            break;\r\n        }\r\n\r\n        var expression = stage[operator];\r\n\r\n        if (!Object.hasOwnProperty.call (StageOperators, operator))\r\n            throw new FauxmongoError ('INVALID', 'unknown operator', { operator:operator });\r\n        docs = StageOperators[operator] (docs, expression);\r\n        if (keepStages)\r\n            stages.push (docs);\r\n    }\r\n\r\n    if (keepStages)\r\n        return stages;\r\n    return docs;\r\n}\r\n\r\nmodule.exports = aggregate;\r\naggregate.evaluateExpression = evaluate;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar getBSONType = require ('./GetBSONType');\r\nvar matchLeaves = require ('./MatchQuery').matchLeaves;\r\nvar Sorting = require ('./Sorting');\r\nvar leafSorter = Sorting.getLeafsort (1);\r\nvar Set = require ('./Set');\r\nvar FauxmongoError = require ('./FauxmongoError');\r\n\r\nfunction evaluate (expression, context) {\r\n    var type = getTypeStr (expression);\r\n    if (type == 'string') {\r\n        if (expression[0] == '$')\r\n            if (expression[1] == '$') {\r\n                // variable\r\n                var varname = expression.slice (2);\r\n                if (Object.hasOwnProperty.call (context, varname))\r\n                    return context[varname];\r\n                throw new FauxmongoError ('INVALID', 'variable '+expression+' not found');\r\n            } else {\r\n                // path\r\n                var pointer = context.CURRENT;\r\n                var frags = expression.slice(1).split ('.');\r\n                for (var i in frags) {\r\n                    var frag = frags[i];\r\n                    if (!Object.hasOwnProperty.call (pointer, frag))\r\n                        return undefined;\r\n                    pointer = pointer[frag];\r\n                }\r\n                return pointer;\r\n            }\r\n        return expression;\r\n    }\r\n\r\n    if (type == 'object') {\r\n        var key = Object.keys (expression)[0];\r\n        if (key[0] != '$') {\r\n            var newDoc = {};\r\n            for (var key in expression)\r\n                newDoc[key] = evaluate (expression[key], context);\r\n            return newDoc;\r\n        }\r\n\r\n        if (key == '$literal')\r\n            return expression.$literal;\r\n\r\n        if (key == '$let') {\r\n            var backup = {};\r\n            var spec = expression.$let;\r\n\r\n            // prime context\r\n            for (var tempVar in spec.vars) {\r\n                if (Object.hasOwnProperty.call (context, tempVar))\r\n                    backup[tempVar] = context[tempVar];\r\n                context[tempVar] = evaluate (spec.vars[tempVar], context);\r\n            }\r\n\r\n            // evaluate with primed context\r\n            var retval = evaluate (spec.in, context);\r\n\r\n            // restore context\r\n            for (var tempVar in spec.vars) {\r\n                if (Object.hasOwnProperty.call (backup, tempVar))\r\n                    context[tempVar] = backup[tempVar];\r\n                else\r\n                    delete context[tempVar];\r\n            }\r\n\r\n            return retval;\r\n        }\r\n\r\n        if (key == '$map') {\r\n            var spec = expression.$map;\r\n            var backup = Object.hasOwnProperty.call (context, spec.as) ?\r\n                context[spec.as]\r\n              : undefined\r\n              ;\r\n\r\n            var docs = evaluate (spec.input, context);\r\n            if (!(docs instanceof Array))\r\n                throw new Error ('$map requires an Array input');\r\n\r\n            var results = [];\r\n            for (var i in docs) {\r\n                context[spec.as] = docs[i];\r\n                results.push (evaluate (spec.in, context));\r\n            }\r\n\r\n            if (backup !== undefined)\r\n                context[spec.as] = backup;\r\n            else\r\n                delete context[spec.as];\r\n            return results;\r\n        }\r\n\r\n        if (!Object.hasOwnProperty.call (AggregationOperators, key))\r\n            throw new Error ('unknown aggregation operator '+key);\r\n        return AggregationOperators[key] (expression[key], context);\r\n    }\r\n\r\n    return expression;\r\n}\r\n\r\n\r\nvar AggregationOperators = {\r\n    '$and':             function (expression, context) {\r\n        for (var i in expression)\r\n            if (!evaluate (expression[i], context))\r\n                return false;\r\n        return true;\r\n    },\r\n    '$or':              function (expression, context) {\r\n        for (var i in expression)\r\n            if (!evaluate (expression[i], context))\r\n                return true;\r\n        return false;\r\n    },\r\n    '$not':             function (expression, context) {\r\n        return ! Boolean (evaluate (expression[0], context));\r\n    },\r\n    '$allElementsTrue': function (expression, context) {\r\n        expression = expression[0];\r\n        var set = evaluate (expression, context);\r\n        if (!(set instanceof Array))\r\n            throw new Error ('$allElementsTrue requires an Array');\r\n        for (var i in set)\r\n            if (!set[i])\r\n                return false;\r\n        return true;\r\n    },\r\n    '$anyElementTrue':  function (expression, context) {\r\n        expression = expression[0];\r\n        var set = evaluate (expression, context);\r\n        if (!(set instanceof Array))\r\n            throw new Error ('$anyElementTrue requires an Array');\r\n        for (var i in set)\r\n            if (set[i])\r\n                return true;\r\n        return false;\r\n    },\r\n    '$setDifference':   function (expression, context) {\r\n        var able = new Set (evaluate (expression[0], context));\r\n        var baker = new Set (evaluate (expression[1], context));\r\n        able.difference (baker);\r\n        return able.export();\r\n    },\r\n    '$setEquals':       function (expression, context) {\r\n        var sets = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (!(val instanceof Array))\r\n                throw new Error ('$setEquals only accepts Arrays');\r\n            sets.push (new Set (val));\r\n        }\r\n\r\n        if (sets.length < 2)\r\n            throw new Error ('$setEquals requires at least 2 sets');\r\n\r\n        var first = sets[1];\r\n        for (var i=1,j=sets.length; i<j; i++)\r\n            if (!first.equals (sets[i]))\r\n                return false;\r\n\r\n        return true;\r\n    },\r\n    '$setIntersection': function (expression, context) {\r\n        var sets = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (!(val instanceof Array))\r\n                throw new Error ('$setIntersection only accepts Arrays');\r\n            sets.push (new Set (val));\r\n        }\r\n\r\n        if (sets.length < 2)\r\n            throw new Error ('$setIntersection requires at least 2 sets');\r\n\r\n        var walker = sets[0];\r\n        for (var i=1,j=sets.length; i<j; i++)\r\n            walker = walker.intersect (sets[i]);\r\n\r\n        return walker.export();\r\n    },\r\n    '$setIsSubset':     function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (!(able instanceof Array) || !(baker instanceof Array))\r\n            throw new FauxmongoError ('FORMAT', '$setIsSubset only accepts Arrays');\r\n        able = new Set (able);\r\n        baker = new Set (baker);\r\n        return baker.contains (able);\r\n    },\r\n    '$setUnion':        function (expression, context) {\r\n        var sets = [];\r\n        for (var i in expression)\r\n            sets.push (new Set (evaluate (expression[i], context)));\r\n\r\n        if (sets.length < 2)\r\n            throw new Error ('$setIntersection requires at least 2 sets');\r\n\r\n        var first = sets[0];\r\n        for (var i=1,j=sets.length; i<j; i++)\r\n            first.union (sets[i]);\r\n\r\n        return first.export();\r\n    },\r\n    '$cmp':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker);\r\n    },\r\n    '$eq':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return matchLeaves (able, baker);\r\n    },\r\n    '$gt':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) > 0 ? true : false;\r\n    },\r\n    '$gte':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) >= 0 ? true : false;\r\n    },\r\n    '$lt':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) < 0 ? true : false;\r\n    },\r\n    '$lte':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return leafSorter (able, baker) <= 0 ? true : false;\r\n    },\r\n    '$ne':              function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        return !matchLeaves (able, baker);\r\n    },\r\n    '$add':             function (expression, context) {\r\n        var vals = [];\r\n        var datestamp = false;\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            var type = typeof val;\r\n            if (type == 'date')\r\n                if (datestamp)\r\n                    throw new Error ('$add accepts at most 1 Date');\r\n                else datestamp = val;\r\n            else if (type != 'number')\r\n                throw new Error ('$add only accepts Numbers and Dates');\r\n            else\r\n                vals.push (val);\r\n        }\r\n\r\n        if (datestamp) {\r\n            var tms = datestamp.getTime();\r\n            for (var i in vals)\r\n                tms += vals[i];\r\n            datestamp.setTime (tms);\r\n            return datestamp;\r\n        }\r\n\r\n        var total = 0;\r\n        for (var i in vals)\r\n            total += vals[i];\r\n        return total;\r\n    },\r\n    '$divide':          function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'number' || typeof baker != 'number')\r\n            throw new Error ('$divide only accepts Numbers');\r\n\r\n        return able / baker;\r\n    },\r\n    '$mod':             function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'number' || typeof baker != 'number')\r\n            throw new Error ('$divide only accepts Numbers');\r\n\r\n        return able % baker;\r\n    },\r\n    '$multiply':        function (expression, context) {\r\n        var vals = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (typeof val != 'number')\r\n                throw new Error ('$multiply only accepts Numbers');\r\n            vals.push (val);\r\n        }\r\n\r\n        var accumulator = 1;\r\n        for (var i in vals)\r\n            accumulator *= vals[i];\r\n        return accumulator;\r\n    },\r\n    '$subtract':        function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'number' || typeof baker != 'number')\r\n            throw new Error ('$divide only accepts Numbers');\r\n\r\n        return able - baker;\r\n    },\r\n    '$concat':          function (expression, context) {\r\n        var vals = [];\r\n        for (var i in expression) {\r\n            var val = evaluate (expression[i], context);\r\n            if (typeof val != 'string')\r\n                if (val === null || val === undefined)\r\n                    return null;\r\n                else\r\n                    throw new Error ('$multiply only accepts Numbers');\r\n            vals.push (val);\r\n        }\r\n\r\n        if (vals.length < 2)\r\n            throw new Error ('$concat requires at least 2 arguments');\r\n\r\n        return String.prototype.concat.apply ('', vals);\r\n    },\r\n    '$strcasecmp':      function (expression, context) {\r\n        var able = evaluate (expression[0], context);\r\n        var baker = evaluate (expression[1], context);\r\n        if (typeof able != 'string' || typeof baker != 'string')\r\n            throw new Error ('$strcasecmp only accepts Strings');\r\n\r\n        able = able.toUpperCase();\r\n        baker = baker.toUpperCase();\r\n        if (able == baker)\r\n            return 0;\r\n        if (able < baker)\r\n            return -1;\r\n        return 1;\r\n    },\r\n    '$substr':          function (expression, context) {\r\n        var str = evaluate (expression[0], context);\r\n        var start = evaluate (expression[1], context);\r\n        var length = evaluate (expression[2], context);\r\n\r\n        if (typeof str != 'string' || typeof start != 'number' || typeof length != 'number')\r\n            throw new Error ('invalid arguments to $substr');\r\n\r\n        if (start < 0)\r\n            return '';\r\n        if (length < 0)\r\n            return str.slice (start);\r\n        return str.slice (start, start + length);\r\n    },\r\n    '$toLower':         function (expression, context) {\r\n        var str = evaluate (expression, context);\r\n        if (str === null)\r\n            return '';\r\n        if (typeof str != 'string')\r\n            throw new Error ('$toLower only accepts Strings');\r\n        return str.toLowerCase();\r\n    },\r\n    '$toUpper':         function (expression, context) {\r\n        var str = evaluate (expression, context);\r\n        if (str === null)\r\n            return '';\r\n        if (typeof str != 'string')\r\n            throw new Error ('$toUpper only accepts Strings');\r\n        return str.toUpperCase();\r\n    },\r\n    '$meta':            function (expression, context) {\r\n        throw new Error ('$meta not supported');\r\n    },\r\n    '$size':            function (expression, context) {\r\n        var arr = evaluate (expression, context);\r\n        if (!(arr instanceof Array))\r\n            throw new Error ('$size only accepts Arrays');\r\n        return arr.length;\r\n    },\r\n    '$dayOfMonth':      function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$dayOfMonth only accepts Dates');\r\n        return expression.getDate();\r\n    },\r\n    '$dayOfWeek':       function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$dayOfWeek only accepts Dates');\r\n        return (expression.getDay() % 7) + 1;\r\n    },\r\n    '$dayOfYear':       function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$dayOfYear only accepts Dates');\r\n\r\n        // all the oldest javascript apis are puketastic\r\n        var start = new Date(expression.getFullYear(), 0, 0);\r\n        var diff = expression - start;\r\n        return Math.floor (diff / ( 1000 * 60 * 60 * 24 ));\r\n    },\r\n    '$hour':            function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$hour only accepts Dates');\r\n        return expression.getHours();\r\n    },\r\n    '$millisecond':     function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$millisecond only accepts Dates');\r\n        return expression.getMilliseconds();\r\n    },\r\n    '$minute':          function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$minute only accepts Dates');\r\n        return expression.getMinutes();\r\n    },\r\n    '$month':           function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$month only accepts Dates');\r\n        return expression.getMonth() + 1;\r\n    },\r\n    '$second':          function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$second only accepts Dates');\r\n        return expression.getSeconds();\r\n    },\r\n    '$week':            function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$week only accepts Dates');\r\n\r\n        // create a target date set to Sunday of the same week as the expression\r\n        var target = new Date (expression.getTime());\r\n        var days = (expression.getDay() + 6) % 7;\r\n        target.setDate (target.getDate() - days - 1);\r\n        // store the time of the week's Sunday\r\n        var firstSunday = target.getTime();\r\n\r\n        // switch to January 1st and advance to Sunday\r\n        target.setMonth (0, 1);\r\n        days = target.getDay();\r\n        if (days != 7)\r\n            target.setMonth (0, 7 - days);\r\n\r\n        return 1 + Math.ceil ((target.getTime() - firstSunday) / (1000 * 60 * 60 * 24 * 7));\r\n    },\r\n    '$year':            function (expression, context) {\r\n        expression = evaluate (expression, context);\r\n        if (!(expression instanceof Date))\r\n            throw new Error ('$year only accepts Dates');\r\n        return expression.getFullYear();\r\n    },\r\n    '$cond':            function (expression, context) {\r\n        var ifx, thenx, elsex;\r\n        if (expression instanceof Array) {\r\n            ifx = expression[0];\r\n            thenx = expression[1];\r\n            elsex = expression[2];\r\n        } else {\r\n            if (typeof expression != 'object')\r\n                throw new Error ('$cond requires either an Object or Array of arguments');\r\n            ifx = expression.if;\r\n            thenx = expression.then;\r\n            elsex = expression.else;\r\n        }\r\n\r\n        if (evaluate (ifx, context) === true)\r\n            return evaluate (thenx, context);\r\n        return evaluate (elsex, context);\r\n    },\r\n    '$ifNull':          function (expression, context) {\r\n        var val = evaluate (expression[0], context);\r\n        if (val === null)\r\n            return evaluate (expression[1], context);\r\n        return val;\r\n    }\r\n};\r\n\r\n\r\nvar AggregationAccumulators = {\r\n    '$addToSet':    function (expression, docs) {\r\n        var set = new Set();\r\n        for (var i in docs)\r\n            set.add (evaluate (expression, { CURRENT:docs[i] }));\r\n        return set.export();\r\n    },\r\n    '$avg':         function (expression, docs) {\r\n        var count = 0;\r\n        var total = 0;\r\n        for (var i in docs) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (typeof val != 'number')\r\n                throw new FauxmongoError ('FORMAT', '$sum only accepts numbers');\r\n            total += val;\r\n            count++;\r\n        }\r\n        return total / count;\r\n    },\r\n    '$first':       function (expression, docs) {\r\n        return evaluate (expression, { CURRENT:docs[0] });\r\n    },\r\n    '$last':        function (expression, docs) {\r\n        return evaluate (expression, { CURRENT:docs[docs.length-1] });\r\n    },\r\n    '$max':         function (expression, docs) {\r\n        var highest = evaluate (expression, { CURRENT:docs[0] });\r\n        for (var i=1,j=docs.length; i<j; i++) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (leafSorter (val, highest) > 0)\r\n                highest = val;\r\n        }\r\n        return highest;\r\n    },\r\n    '$min':         function (expression, docs) {\r\n        var lowest = evaluate (expression, { CURRENT:docs[0] });\r\n        for (var i=1,j=docs.length; i<j; i++) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (leafSorter (val, lowest) < 0)\r\n                lowest = val;\r\n        }\r\n        return lowest;\r\n    },\r\n    '$push':        function (expression, docs) {\r\n        var output = [];\r\n        for (var i in docs)\r\n            output.push (evaluate (expression, { CURRENT:docs[i] }));\r\n        return output;\r\n    },\r\n    '$sum':         function (expression, docs) {\r\n        var total = 0;\r\n        for (var i in docs) {\r\n            var val = evaluate (expression, { CURRENT:docs[i] });\r\n            if (typeof val != 'number')\r\n                throw new FauxmongoError ('FORMAT', '$sum only accepts numbers');\r\n            total += val;\r\n        }\r\n        return total;\r\n    }\r\n};\r\n\r\n\r\nmodule.exports.evaluate = evaluate;\r\nmodule.exports.accumulators = AggregationAccumulators;\r\n","\r\nvar AggregationOperators    = require ('./AggregationOperators');\r\nvar matchQuery              = require ('./MatchQuery');\r\nvar project                 = require ('./Project');\r\nvar Sorting                 = require ('./Sorting');\r\nvar getTypeStr              = require ('./GetTypeStr');\r\nvar FauxmongoError          = require ('./FauxmongoError');\r\n\r\nfunction clone (thing) {\r\n    var newThing = {};\r\n    for (var key in thing) {\r\n        var subthing = thing[key];\r\n        if (typeof subthing == 'object')\r\n            if (subthing instanceof Array)\r\n                newThing[key] = cloneArr (subthing);\r\n            else\r\n                newThing[key] = clone (subthing);\r\n        else\r\n            newThing[key] = thing[key];\r\n    }\r\n    return newThing;\r\n}\r\n\r\nfunction cloneArr (thingArr) {\r\n    var newThing = [];\r\n    for (var i in thingArr) {\r\n        var subthing = thingArr[i];\r\n        if (typeof subthing == 'object')\r\n            if (thingArr instanceof Array)\r\n                newThing[i] = clone (subthing);\r\n            else\r\n                newThing[i] = cloneArr (subthing);\r\n        else\r\n            newThing[i] = thingArr[i];\r\n    }\r\n    return newThing;\r\n}\r\n\r\n\r\nvar AggregationStages = {\r\n    '$geoNear':     function (docs, expression) {\r\n        throw new FauxmongoError ('SUPPORT', '$geoNear is not supported');\r\n    },\r\n    '$group':       function (docs, expression) {\r\n        var strings = {};\r\n        var nums = {};\r\n        var others = [];\r\n        var otherDocs = [];\r\n\r\n        // establish the groups\r\n        for (var i in docs) {\r\n            var doc = docs[i];\r\n            var context = { CURRENT:doc };\r\n            var id = AggregationOperators.evaluate (expression._id, context);\r\n            var idType = getTypeStr (id);\r\n\r\n            if (idType == 'string')\r\n                if (Object.hasOwnProperty.call (strings, id))\r\n                    strings[id].push (doc);\r\n                else\r\n                    strings[id] = [ doc ];\r\n            else if (idType == 'number')\r\n                if (Object.hasOwnProperty.call (nums, id))\r\n                    nums[id].push (doc);\r\n                else\r\n                    nums[id] = [ doc ];\r\n            else {\r\n                var done = false;\r\n                for (var i in others)\r\n                    if (matchQuery.matchLeaves (id, others[i])) {\r\n                        done = true;\r\n                        otherDocs[i].push (doc);\r\n                        break;\r\n                    }\r\n                if (!done) {\r\n                    others.push (id);\r\n                    otherDocs.push ([ doc ]);\r\n                }\r\n            }\r\n        }\r\n\r\n        // assemble the groups into a single manageable task\r\n        var jobs = others;\r\n        var jobDocLists = otherDocs;\r\n        var stringIDs = Object.keys (strings);\r\n        var numIDs = Object.keys (nums);\r\n        jobs.push.apply (jobs, stringIDs);\r\n        jobs.push.apply (jobs, numIDs);\r\n        for (var i in stringIDs)\r\n            jobDocLists.push (strings[stringIDs[i]]);\r\n        for (var i in numIDs)\r\n            jobDocLists.push (nums[numIDs[i]]);\r\n\r\n        // accumulate each group\r\n        var output = [];\r\n        for (var i in jobs) {\r\n            var jobID = jobs[i];\r\n            var jobDocs = jobDocLists[i];\r\n            var accumulant = { _id:jobID };\r\n\r\n            for (var key in expression) {\r\n                if (key == '_id')\r\n                    continue;\r\n\r\n                var subexpression = expression[key];\r\n                var sxkeys = Object.keys (subexpression);\r\n                if (\r\n                    !sxkeys.length\r\n                 || !Object.hasOwnProperty.call (AggregationOperators.accumulators, sxkeys[0])\r\n                )\r\n                    throw new FauxmongoError (\r\n                        'INVALID',\r\n                        '$group found an invalid aggregation spec'\r\n                    );\r\n\r\n                var currentVal = Object.hasOwnProperty.call (accumulant, key) ?\r\n                    accumulant[key]\r\n                  : undefined\r\n                  ;\r\n\r\n                accumulant[key] = AggregationOperators.accumulators[sxkeys[0]] (\r\n                    subexpression[sxkeys[0]],\r\n                    jobDocs\r\n                );\r\n            }\r\n\r\n            output.push (accumulant);\r\n        }\r\n\r\n        return output;\r\n    },\r\n    '$limit':       function (docs, expression) {\r\n        return docs.slice (0, expression);\r\n    },\r\n    '$match':       function (docs, expression) {\r\n        var output = [];\r\n        for (var i=0,j=docs.length; i<j; i++)\r\n            if (matchQuery (docs[i], expression))\r\n                output.push (docs[i]);\r\n        return output;\r\n    },\r\n    '$project':     function (docs, expression) {\r\n        var output = [];\r\n        for (var i in docs) {\r\n            var currentDoc = docs[i];\r\n            var context = { CURRENT:currentDoc };\r\n            var dotsBanned = false;\r\n            var layersBanned = false;\r\n            var newDoc = {};\r\n            for (var key in expression) {\r\n                if (key == '_id') {\r\n                    var val = expression[key]\r\n                    if (val === 0 || val === false)\r\n                        continue;\r\n                }\r\n\r\n                var spec = expression[key];\r\n                if (typeof spec == 'object' && !(spec instanceof Array)) {\r\n                    var specKeys = Object.keys (spec);\r\n                    if (specKeys[0] && specKeys[0][0] == '$') {\r\n                        newDoc[key] = evaluate (spec, context);\r\n                        continue;\r\n                    }\r\n\r\n                    // layer!\r\n                    if (layersBanned)\r\n                        throw new FauxmongoError (\r\n                            'INVALID',\r\n                            '$project cannot combine dot-notation and layered spec'\r\n                        );\r\n                    dotsBanned = true;\r\n\r\n                    var subdoc = Object.hasOwnProperty.call (currentDoc, key) ?\r\n                        currentDoc[key]\r\n                      : undefined\r\n                      ;\r\n                    var layerProjection = (function projectLevel (doc, layer) {\r\n                        var projection = {};\r\n                        var didSomething = false;\r\n                        for (var key in layer) {\r\n                            var spec = layer[key];\r\n                            if (typeof spec == 'object' && !(spec instanceof Array)) {\r\n                                var specKeys = Object.keys (spec);\r\n                                if (specKeys[0] && specKeys[0][0] == '$') {\r\n                                    projection[key] = AggregationOperators.evaluate (\r\n                                        spec,\r\n                                        context\r\n                                    );\r\n                                    didSomething = true;\r\n                                } else\r\n                                    for (var j in specKeys) {\r\n                                        var specKey = specKeys[j];\r\n                                        var subdoc =\r\n                                                doc\r\n                                             && Object.hasOwnProperty.call (doc, specKey) ?\r\n                                            doc[specKey]\r\n                                          : undefined\r\n                                          ;\r\n                                        var levelProjection = projectLevel (\r\n                                            subdoc,\r\n                                            spec[specKey],\r\n                                            projection[specKey] = {}\r\n                                        );\r\n                                        if (levelProjection !== undefined) {\r\n                                            didSomething = true;\r\n                                            projection[specKey] = levelProjection;\r\n                                        }\r\n                                    }\r\n                                continue;\r\n                            }\r\n\r\n                            if (spec === 1 || spec === true) {\r\n                                if (doc && Object.hasOwnProperty.call (doc, key)) {\r\n                                    projection[key] = doc[key];\r\n                                    didSomething = true;\r\n                                }\r\n                            } else {\r\n                                projection[key] = AggregationOperators.evaluate (\r\n                                    spec,\r\n                                    context\r\n                                );\r\n                                didSomething = true;\r\n                            }\r\n                        }\r\n\r\n                        if (didSomething)\r\n                            return projection;\r\n                    }) (subdoc, spec);\r\n                    if (layerProjection !== undefined)\r\n                        newDoc[key] = layerProjection;\r\n                    continue;\r\n                }\r\n\r\n                var isExpression = spec === 1 || spec === true ? false : true;\r\n\r\n                var pointer = docs[i];\r\n                var writeHead = newDoc;\r\n                var lastStep;\r\n                var frags = key.split ('.');\r\n                if (frags.length > 1 && dotsBanned)\r\n                    throw new FauxmongoError (\r\n                        '$project cannot combine dot-notation and layered spec',\r\n                        'INVALID'\r\n                    );\r\n                layersBanned = true;\r\n                var notFound = false;\r\n                for (var k=0,l=frags.length-1; k<l; k++) {\r\n                    var frag = frags[k];\r\n                    if (!Object.hasOwnProperty.call (pointer, frag)) {\r\n                        if (!isExpression) {\r\n                            notFound = true;\r\n                            break;\r\n                        }\r\n                    } else\r\n                        pointer = pointer[frag];\r\n                    if (!Object.hasOwnProperty.call (writeHead, frag))\r\n                        if (pointer[frag] instanceof Array)\r\n                            writeHead[frag] = [];\r\n                        else\r\n                            writeHead[frag] = {};\r\n                    writeHead = writeHead[frag];\r\n                }\r\n                if (notFound) // skip this key in the projection\r\n                    continue;\r\n                lastStep = frags[frags.length-1];\r\n\r\n                if (isExpression)\r\n                    writeHead[lastStep] = AggregationOperators.evaluate (spec, context);\r\n                else if (Object.hasOwnProperty.call (pointer, lastStep))\r\n                    writeHead[lastStep] = pointer[lastStep];\r\n            }\r\n\r\n            output.push (newDoc);\r\n        }\r\n\r\n        return output;\r\n    },\r\n    '$redact':      function (docs, expression) {\r\n        var output = [];\r\n\r\n        for (var i in docs) {\r\n            var doc = docs[i];\r\n            var context = { CURRENT:doc, DESCEND:{}, KEEP:{}, PRUNE:{} };\r\n            var action = AggregationOperators.evaluate (expression, context);\r\n            if (action === context.PRUNE)\r\n                continue;\r\n            if (action === context.KEEP) {\r\n                output.push (doc);\r\n                continue;\r\n            }\r\n            if (action !== context.DESCEND)\r\n                throw new FauxmongoError (\r\n                    'INVALID',\r\n                    '$redact expects one of $$PRUNE, $$KEEP, $$DESCEND'\r\n                );\r\n\r\n            // DESCEND\r\n            newDoc = {};\r\n            for (var key in doc) {\r\n                var val = doc[key];\r\n                if (typeof val != 'object') {\r\n                    newDoc[key] = doc[key];\r\n                    continue;\r\n                }\r\n\r\n                var redacted = (function redactLevel (readHead) {\r\n                    if (readHead instanceof Array) {\r\n                        var newDoc = [];\r\n                        for (var i in readHead) {\r\n                            var val = readHead[i];\r\n                            if (typeof val != 'object')\r\n                                newDoc.push (val);\r\n                            else {\r\n                                var newVal = redactLevel (val);\r\n                                if (newVal !== undefined)\r\n                                    newDoc.push (newVal);\r\n                            }\r\n                        }\r\n                        if (newDoc.length)\r\n                            return newDoc;\r\n                        return;\r\n                    }\r\n\r\n                    context.CURRENT = readHead;\r\n                    var action = AggregationOperators.evaluate (expression, context);\r\n                    if (action === context.PRUNE)\r\n                        return;\r\n                    if (action === context.KEEP)\r\n                        return readHead;\r\n                    if (action !== context.DESCEND)\r\n                        throw new FauxmongoError (\r\n                            'INVALID',\r\n                            '$redact expects one of $$PRUNE, $$KEEP, $$DESCEND'\r\n                        );\r\n\r\n                    var newDoc = {}\r\n                    var keys = Object.keys (readHead);\r\n                    for (var i in keys) {\r\n                        var key = keys[i];\r\n                        var val = readHead[key];\r\n                        if (typeof val != 'object')\r\n                            newDoc[key] = val;\r\n                        else {\r\n                            var newVal = redactLevel (val);\r\n                            if (newVal !== undefined)\r\n                                newDoc[key] = newVal;\r\n                        }\r\n                    }\r\n                    if (Object.keys (newDoc).length)\r\n                        return newDoc;\r\n                }) (val, newDoc, key);\r\n\r\n                if (redacted !== undefined)\r\n                    newDoc[key] = redacted;\r\n            }\r\n\r\n            output.push (newDoc);\r\n        }\r\n\r\n        return output;\r\n    },\r\n    '$skip':        function (docs, expression) {\r\n        return docs.slice (expression);\r\n    },\r\n    '$sort':        function (docs, expression) {\r\n        var output = [];\r\n        output.push.apply (output, docs);\r\n        output.sort (Sorting.getDocsort (expression));\r\n        return output;\r\n    },\r\n    '$unwind':      function (docs, path) {\r\n        var output = [];\r\n\r\n        var frags = path.slice (1).split ('.');\r\n        for (var i=0,j=docs.length; i<j; i++) {\r\n            var doc = docs[i];\r\n\r\n            // walk to the target array\r\n            var pointer = docs[i];\r\n            var notFound = false;\r\n            for (var k in frags) {\r\n                var frag = frags[k];\r\n                if (!Object.hasOwnProperty.call (pointer, frag)) {\r\n                    notFound = true;\r\n                    break;\r\n                }\r\n                pointer = pointer[frag];\r\n                if (typeof pointer != 'object')\r\n                    throw new FauxmongoError (\r\n                        'FORMAT',\r\n                        '$unwind found something other than an Array'\r\n                    );\r\n            }\r\n            if (notFound)\r\n                continue;\r\n            if (!(pointer instanceof Array))\r\n                throw new FauxmongoError (\r\n                    'FORMAT',\r\n                    '$unwind found something other than an Array'\r\n                );\r\n\r\n            // unwind\r\n            var newDocs = [];\r\n            for (var k in pointer) {\r\n                newDoc = clone (doc);\r\n                // walk to the unwound path and set an individual value there\r\n                var innerPointer = newDoc;\r\n                for (var l=0,m=frags.length-1; l<m; l++)\r\n                    innerPointer = innerPointer[frags[l]];\r\n                innerPointer[frags[frags.length-1]] = pointer[k];\r\n                newDocs.push (newDoc);\r\n            }\r\n            output.push.apply (output, newDocs);\r\n        }\r\n\r\n        return output;\r\n    }\r\n};\r\n\r\n\r\nmodule.exports = AggregationStages;\r\n","\r\n/**     @module/class fauxmongo/lib/FauxmongoError\r\n    @super Error\r\n    An Error generated intentionally by fauxmongo to describe a known error condition.\r\n@String #code\r\n    A reliable string value describing the general type of error being reported.\r\n     * **SUPPORT** the update, query or pipeline specification requests\r\n     * **INVALID** the update, query or pipeline specification was invalid\r\n     * **FORMAT** a record in the input set could not be processed by the aggregation pipeline\r\n        because a field was either missing or incorrectly typed.\r\n@String #message\r\n    Additional human-readable information about the error.\r\n*/\r\n\r\nvar util = require ('util');\r\n\r\nfunction FauxmongoError (code, message, info) {\r\n    Error.call (this);\r\n    this.code = code;\r\n    this.message = message;\r\n    if (info) for (var key in info) this[key] = info[key];\r\n}\r\nutil.inherits (FauxmongoError, Error);\r\n\r\nmodule.exports = FauxmongoError;\r\n","\r\nvar BSON_TYPES = {};\r\nBSON_TYPES['DOUBLE']        = 1;\r\nBSON_TYPES['STRING']        = 2;\r\nBSON_TYPES['OBJECT']        = 3;\r\nBSON_TYPES['ARRAY']         = 4;\r\nBSON_TYPES['BUFFER']        = 5;\r\nBSON_TYPES['UNDEFINED']     = 6;\r\nBSON_TYPES['OBJECT_ID']     = 7;\r\nBSON_TYPES['BOOLEAN']       = 8;\r\nBSON_TYPES['DATE']          = 9;\r\nBSON_TYPES['NULL']          = 10;\r\nBSON_TYPES['REGEXP']        = 11;\r\nBSON_TYPES['FUNCTION']      = 13;\r\nBSON_TYPES['INTEGER']       = 16;\r\nBSON_TYPES['LONG']          = 18;\r\nmodule.exports.BSON_TYPES   = BSON_TYPES;\r\n\r\n/**     @property/Function fauxmongo.getBSONType\r\n    @root\r\n    Return a numeric BSON type for a javascript object.\r\n@argument/Object subject\r\n    The object to test for type.\r\n@argument/Boolean simpleNums\r\n    @optional\r\n    In simpleNums mode, a Number is always of `DOUBLE` type. Otherwise it will be evaluated as\r\n    potentially an integer.\r\n@returns/Number\r\n    Returns one of the following values:\r\n     * 0 - unknown type\r\n     * 1 - double\r\n     * 2 - string\r\n     * 3 - object\r\n     * 4 - array\r\n     * 5 - buffer\r\n     * 6 - undefined\r\n     * 7 - ObjectID\r\n     * 8 - boolean\r\n     * 9 - date\r\n     * 10 - null\r\n     * 11 - regexp\r\n     * 13 - function\r\n     * 16 - integer\r\n     * 18 - long\r\n*/\r\nfunction getBSONType (obj, simpleNums) {\r\n    var type = getTypeStr (obj);\r\n    if (type == 'number') {\r\n        if (simpleNums) return 1;\r\n        if (Math.round (obj) == obj)\r\n            return 16;\r\n        return 1;\r\n    }\r\n    if (!BSON_TYPES.hasOwnProperty (type))\r\n        return 0;\r\n    return BSON_TYPES[type];\r\n}\r\n\r\nmodule.exports = getBSONType;\r\n","\r\nvar typeGetter = ({}).toString;\r\ntry { Buffer; } catch (err) { Buffer = function(){}; }\r\nfunction getTypeStr (obj) {\r\n    var tstr = typeGetter.apply(obj).slice(8,-1).toLowerCase();\r\n    if (tstr == 'object')\r\n        if (obj instanceof Buffer) return 'buffer';\r\n        else return tstr;\r\n    if (tstr == 'text') return 'textnode';\r\n    if (tstr == 'comment') return 'commentnode';\r\n    if (tstr.slice(0,4) == 'html') return 'element';\r\n    return tstr;\r\n}\r\n\r\nmodule.exports = getTypeStr;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\n/**     @property/Function fauxmongo.matchQuery.matchLeaves\r\n    @development\r\n    Compare two MongoDB documents, lists or leaves for deep equality.\r\n@argument able\r\n@argument baker\r\n@returns/Boolean\r\n*/\r\nfunction matchLeaves (able, baker) {\r\n    if (able === baker) return true;\r\n\r\n    var aType = getTypeStr (able);\r\n    var bType = getTypeStr (baker);\r\n    if (aType != bType) return false;\r\n    if (aType == 'array') {\r\n        if (able.length != baker.length) return false;\r\n        for (var i in able)\r\n            if (!matchLeaves (able[i], baker[i]))\r\n                return false;\r\n        return true;\r\n    } else if (aType == 'object') {\r\n        var keys = Object.keys (able);\r\n        if (keys.length != Object.keys (baker).length) return false;\r\n        for (var i in keys) {\r\n            var key = keys[i];\r\n            if (!Object.hasOwnProperty.call (baker, key) || !matchLeaves (able[key], baker[key]))\r\n                return false;\r\n        }\r\n        return true;\r\n    } else return false;\r\n}\r\n\r\nmodule.exports = matchLeaves;\r\n","\r\n/**     @property/Function fauxmongo.matchQuery\r\n    @root\r\n    @api\r\n    Determine whether a query selects a given document.\r\n@argument/Object doc\r\n    The document to be examined.\r\n@argument/Object query\r\n    The query to test against the document.\r\n@argument/String root\r\n    @optional\r\n    Indicates an offset document position. Permits testing a full query against a subdocument.\r\n@returns/Boolean\r\n*/\r\nfunction matchQuery (doc, query, root) {\r\n    var rootlen = root ? root.length : 0;\r\n    for (var path in query) {\r\n        var subquery = query[path];\r\n        if (root) {\r\n            if (path.slice (0, rootlen) != root)\r\n                continue;\r\n            path = path.slice (rootlen + 1);\r\n        }\r\n\r\n        if (path == '$where')\r\n            throw new Error ('$where is not supported');\r\n\r\n        var subtype = getTypeStr (subquery);\r\n\r\n        if (path == '$and') {\r\n            if (subtype != 'array')\r\n                throw new Error ('$and requires an Array of query documents');\r\n            for (var i=0,j=subquery.length; i<j; i++)\r\n                if (!matchQuery (doc, subquery[i]))\r\n                    return false;\r\n            continue;\r\n        }\r\n\r\n        if (path == '$or') {\r\n            if (subtype != 'array')\r\n                throw new Error ('$or requires an Array of query documents');\r\n            var fullfilled = false;\r\n            for (var i=0,j=subquery.length; i<j; i++)\r\n                if (matchQuery (doc, subquery[i])) {\r\n                    fullfilled = true;\r\n                    break;\r\n                }\r\n            if (!fullfilled) return false;\r\n            continue;\r\n        }\r\n\r\n        if (path == '$nor') {\r\n            if (subtype != 'array')\r\n                throw new Error ('$nor requires an Array of query documents');\r\n            for (var i=0,j=subquery.length; i<j; i++)\r\n                if (matchQuery (doc, subquery[i]))\r\n                    return false;\r\n            continue;\r\n        }\r\n\r\n        if (path[0] == '$')\r\n            return matchSubquery (doc, query);\r\n\r\n        var frags = path.split ('.');\r\n        var pointer = doc;\r\n        var pointerType = 'object';\r\n\r\n        // iterate all but the last frag\r\n        var ok = true;\r\n        var earlyMatch = false; // for child-of-Array queries\r\n        for (var i=0,j=frags.length-1; i<j; i++) {\r\n            var frag = frags[i];\r\n            if (frag[0] == '$') // operator in middle of path\r\n                throw new Error ('invalid path '+path);\r\n\r\n            if (pointerType == 'array') {\r\n                var index = parseInt (frag);\r\n                var upperSubpath = frags.slice (i+1).join ('.');\r\n                if (!isNaN (index) && frag.match (/^\\d+$/) && index < pointer.length) {\r\n                    // possible numeric index match\r\n                    var specialSubquery = {};\r\n                    specialSubquery[upperSubpath] = subquery;\r\n                    if (matchQuery (pointer[frag], specialSubquery)) {\r\n                        earlyMatch = true;\r\n                        break;\r\n                    }\r\n                }\r\n\r\n                var fullfilled = false;\r\n                upperSubpath = frag + '.' + upperSubpath;\r\n                var specialSubquery = {};\r\n                specialSubquery[upperSubpath] = subquery;\r\n                for (var i in pointer)\r\n                    if (matchQuery (pointer[i], specialSubquery)) {\r\n                        fullfilled = true;\r\n                        break;\r\n                    }\r\n                if (!fullfilled)\r\n                    return false;\r\n                earlyMatch = true;\r\n                break;\r\n            }\r\n\r\n            if (pointerType != 'object')\r\n                throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n            if (frag[0] == '$') // operator in middle of path\r\n                throw new Error ('invalid path '+path);\r\n\r\n            if (!Object.hasOwnProperty.call (pointer, frag)) {\r\n                ok = false;\r\n                break;\r\n            }\r\n            pointer = pointer[frag];\r\n            pointerType = getTypeStr (pointer); // the business end of pointerType logic\r\n        }\r\n        if (earlyMatch) continue;\r\n\r\n        // we have navigated to the parent of the last fragment in the path\r\n        var frag = frags[frags.length-1];\r\n        if (frag[0] == '$')\r\n            throw new Error ('invalid path '+path);\r\n\r\n        if (pointerType == 'array') {\r\n            var index = parseInt (frag);\r\n            var upperSubpath = frags.slice (i+1).join ('.');\r\n            if (!isNaN (index) && frag.match (/^\\d+$/) && index < pointer.length) {\r\n                // possible numeric index match\r\n                if (matchLeaves (pointer[frag], subquery)) {\r\n                    earlyMatch = true;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            var fullfilled = false;\r\n            var specialSubquery = {};\r\n            specialSubquery[frag] = subquery;\r\n            for (var i in pointer)\r\n                if (matchQuery (pointer[i], specialSubquery)) {\r\n                    fullfilled = true;\r\n                    break;\r\n                }\r\n            if (!fullfilled)\r\n                return false;\r\n            earlyMatch = true;\r\n            break;\r\n        }\r\n\r\n        if (pointerType != 'object')\r\n            throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n\r\n        // missing key?\r\n        if (!ok || !Object.hasOwnProperty.call (pointer, frag))\r\n            // still one thin ray of hope - $exists:false\r\n            if (\r\n                subtype == 'object'\r\n             && Object.hasOwnProperty.call (subquery, '$exists')\r\n             && !subquery.$exists\r\n            )\r\n                continue; // successfully matched { $exists:false }\r\n            else\r\n                return false; // missing key\r\n\r\n        if (subtype != 'object' || !moreDollars (subquery))\r\n            if (matchLeaves (pointer[frag], subquery))\r\n                continue;\r\n            else\r\n                return false;\r\n\r\n        // $operator-laden subquery\r\n        for (var op in subquery) {\r\n            // apply the operator\r\n            if (op == '$exists') // we know it does\r\n                continue;\r\n            if (!operators.ops[op] (\r\n                pointer[frag],\r\n                subquery[op]\r\n            ))\r\n                return false;\r\n        }\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\n\r\n/**     @property/Function matchSubquery\r\n    Test a partial query against a subdocument. Expects the query specification for a single key,\r\n    e.g. from `{ 'able.baker':{ $gt:4 } }` the subquery is `{ $gt:4 }`.\r\n@argument/Object document\r\n    Subdocument or leaf to test.\r\n@argument/Object subquery\r\n    Query specification for a single key.\r\n@returns/Boolean\r\n*/\r\nfunction matchSubquery (document, subquery) {\r\n    // $operator-laden subquery\r\n    for (var op in subquery) {\r\n        // apply the operator\r\n        if (op == '$exists') // we know it does\r\n            continue;\r\n        if (!operators.ops[op] (\r\n            document,\r\n            subquery[op]\r\n        ))\r\n            return false;\r\n    }\r\n    return true;\r\n}\r\n\r\n\r\nmodule.exports = matchQuery;\r\nmatchQuery.matchSubquery = matchSubquery;\r\n\r\nvar operators = require ('./QueryOperators');\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar moreDollars = require ('./MoreDollars');\r\nvar matchLeaves = require ('./MatchLeaves');\r\nmatchQuery.matchLeaves = matchLeaves;\r\n","\r\n/**     @property/Function fauxmongo.merge\r\n    @root\r\n    @api\r\n    Recursively merge the result of a query into a local document, overwriting the document with\r\n    fresh query results. A projection specification may be provided to intelligently merge\r\n    projected fields.\r\n@argument/Object source\r\n    Freshly queried state information.\r\n@argument/Object target\r\n    The target document to recursively merge into.\r\n@argument/Object query\r\n    @optional\r\n    If the projection uses the positional operator, the query may be included to define its\r\n    position.\r\n@argument/Object projection\r\n    @optional\r\n    If a projection is provided, the merge will honor any special projection options.\r\n*/\r\n\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar resolveDollar = require ('./ResolveDollar');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\nfunction simpleMerge (source, target) {\r\n    for (var key in source) {\r\n        var val = source[key];\r\n        if (!Object.hasOwnProperty.call (target, key)) {\r\n            target[key] = val;\r\n            continue;\r\n        }\r\n\r\n        var childType = getTypeStr (val);\r\n        var tval = target[key];\r\n        var tvalType = getTypeStr (tval);\r\n        if (childType != tvalType) {\r\n            target[key] = val;\r\n            continue;\r\n        }\r\n        if (childType == 'object')\r\n            simpleMerge (val, tval);\r\n        else if (childType == 'array')\r\n            simpleArrayMerge (val, tval);\r\n        else\r\n            target[key] = val;\r\n    }\r\n}\r\n\r\nfunction simpleArrayMerge (source, target) {\r\n    for (var i in source) {\r\n        var val = source[i];\r\n        if (i >= target.length) {\r\n            target.push (val);\r\n            continue;\r\n        }\r\n\r\n        var childType = getTypeStr (val);\r\n        var tval = target[i];\r\n        var tvalType = getTypeStr (tval);\r\n        if (childType != tvalType) {\r\n            target[i] = val;\r\n            continue;\r\n        }\r\n        if (childType == 'object')\r\n            simpleMerge (val, tval);\r\n        else if (childType == 'array')\r\n            simpleArrayMerge (val, tval);\r\n        else\r\n            target[i] = val;\r\n    }\r\n}\r\n\r\nfunction merge (source, target, query, projection) {\r\n    if (!projection) {\r\n        projection = query;\r\n        query = undefined;\r\n    }\r\n\r\n    if (!projection) // merging with no projection is MUCH simpler\r\n        return simpleMerge (source, target);\r\n\r\n    // projected merge\r\n    var dollarPath;\r\n    function mergeLevel (subsource, subtarget, basePath) {\r\n        for (var key in subsource) {\r\n            var val = subsource[key];\r\n            var childType = getTypeStr (val);\r\n            var keypath = basePath ? basePath + '.' + key : key;\r\n\r\n            if (!Object.hasOwnProperty.call (subtarget, key)) {\r\n                if (childType != 'array')\r\n                    subtarget[key] = val;\r\n                else {\r\n                    var newArr = subtarget[key] = [];\r\n                    mergeArrayLevel (val, newArr, keypath);\r\n                }\r\n                continue;\r\n            }\r\n\r\n            var tval = subtarget[key];\r\n            var tvalType = getTypeStr (tval);\r\n            if (childType != tvalType) {\r\n                subtarget[key] = val;\r\n                continue;\r\n            }\r\n            if (childType == 'object')\r\n                mergeLevel (val, tval, keypath);\r\n            else if (childType == 'array')\r\n                mergeArrayLevel (val, tval, keypath);\r\n            else\r\n                subtarget[key] = val;\r\n        }\r\n    }\r\n\r\n    function mergeArrayLevel (subsource, subtarget, basePath) {\r\n        if (!subsource.length)\r\n            return;\r\n        if (Object.hasOwnProperty.call (projection, basePath)) {\r\n            // special projection?\r\n            var directive = projection[basePath];\r\n            if (typeof directive == 'object')\r\n                if (directive.$elemMatch) {\r\n                    for (var i in subtarget)\r\n                        if (matchQuery (subtarget[i], directive.$elemMatch)) {\r\n                            subtarget[i] = subsource[0];\r\n                            return;\r\n                        }\r\n                    return;\r\n                } else if (directive.$slice) {\r\n                    // slice projection\r\n                    var start, end, dropped;\r\n                    if (typeof directive.$slice == 'number') {\r\n                        if (directive.$slice < 0)\r\n                            return; // cannot acquire a hard index for trailing elements\r\n                        start = 0;\r\n                        end = Math.min (subsource.length, directive.$slice);\r\n                    } else {\r\n                        // array of two indices\r\n                        if (directive.$slice[0] < 0)\r\n                            return;\r\n                        start = directive.$slice[0];\r\n                        end = start + directive.$slice[1];\r\n                        dropped = (end - start) - subsource.length;\r\n                    }\r\n\r\n                    for (var i=0,j=start; j < end; j++, i++)\r\n                        subtarget[j] = subsource[i];\r\n\r\n                    if (dropped)\r\n                        subtarget.splice (start + subsource.length, subtarget.length);\r\n\r\n                    return;\r\n                }\r\n        } else if (Object.hasOwnProperty.call (projection, basePath+'.$')) {\r\n            // positional operator projection\r\n            if (dollarPath)\r\n                throw new Error ('projection contains more than one positional operator');\r\n            dollarPath = basePath;\r\n            var dollarPosition = resolveDollar (target, query, basePath.split ('.'), basePath);\r\n            if (dollarPosition >= 0)\r\n                subtarget[dollarPosition] = subsource[0];\r\n            return;\r\n        }\r\n\r\n        for (var i in subsource) {\r\n            var val = subsource[i];\r\n            if (i >= subtarget.length) {\r\n                subtarget.push (val);\r\n                continue;\r\n            }\r\n\r\n            var childType = getTypeStr (val);\r\n            var tval = subtarget[i];\r\n            var tvalType = getTypeStr (tval);\r\n            if (childType != tvalType) {\r\n                subtarget[i] = val;\r\n                continue;\r\n            }\r\n            if (childType == 'object')\r\n                mergeLevel (val, tval, basePath);\r\n            else if (childType == 'array')\r\n                mergeArrayLevel (val, tval, basePath);\r\n            else\r\n                subtarget[i] = val;\r\n        }\r\n    }\r\n\r\n    mergeLevel (source, target);\r\n}\r\n\r\nmodule.exports = merge;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\nfunction moreDollars (level, isArray) {\r\n    if (isArray) {\r\n        for (var i in level) if (moreDollars (level[i])) return true;\r\n        return false;\r\n    }\r\n    for (var key in level) {\r\n        if (key[0] == '$')\r\n            return true;\r\n        var item = level[key];\r\n        var type = getTypeStr (item);\r\n        if (type == 'object')\r\n            if (moreDollars (item)) return true;\r\n            else continue;\r\n        if (type == 'array')\r\n            if (moreDollars (item, true)) return true;\r\n    }\r\n    return false;\r\n}\r\n\r\nmodule.exports = moreDollars;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar resolveDollar = require ('./ResolveDollar');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\n/**     @property/Function fauxmongo.project\r\n    @root\r\n    Generate a document with another document using a MongoDB projection specification.\r\n@argument/Object document\r\n    The source document to project.\r\n@argument/Object query\r\n    @optional\r\n    If the projection uses the positional operator, provide a query to define it.\r\n@argument/Object projection\r\n    The projection specification used to generate a new document.\r\n*/\r\n\r\nfunction project (document, query, projection) {\r\n    if (!projection) {\r\n        projection = query;\r\n        query = undefined;\r\n    }\r\n\r\n    var outputDoc = {};\r\n    var dollarPath;\r\n    var previousStep, previousPPointer;\r\n    for (var path in projection) {\r\n        // in case we traverse any Arrays during this projection\r\n        function multiproject (pointer, target, path) {\r\n            var pointerType = getTypeStr (pointer);\r\n            var mainTarget;\r\n            if (target)\r\n                mainTarget = target;\r\n            else\r\n                if (pointerType == 'object')\r\n                    target = {};\r\n                else if (pointerType == 'array') {\r\n                    target = [];\r\n                    var remainingPath = path.slice (i);\r\n                    for (var i in pointer) {\r\n                        var found = multiproject (pointer[i], target[i], remainingPath);\r\n                        if (found !== undefined)\r\n                            target[i] = found;\r\n                    }\r\n                    return target;\r\n                } else\r\n                    return;\r\n\r\n            for (var i=0,j=path.length-1; i<j; i++) {\r\n                var pathStep = path[i];\r\n                if (pathStep == '$')\r\n                    throw new Error (\r\n                        'cannot use the positional operator inside another Array'\r\n                    );\r\n\r\n                if (pointerType == 'array') {\r\n                    if (!mainTarget) mainTarget = target;\r\n                    var remainingPath = path.slice (i);\r\n                    for (var k in pointer) {\r\n                        var found = multiproject (pointer[k], target[k], remainingPath);\r\n                        if (found !== undefined)\r\n                            target[k] = found;\r\n                    }\r\n                    return mainTarget;\r\n                } else if (pointerType != 'object')\r\n                    return mainTarget; // if there's path left, we must be a container type\r\n\r\n                if (!Object.hasOwnProperty.call (pointer, pathStep))\r\n                    return mainTarget; // not found\r\n                if (!mainTarget) mainTarget = target;\r\n                pointer = pointer[pathStep];\r\n                pointerType = getTypeStr (pointer);\r\n\r\n                if (Object.hasOwnProperty.call (target, pathStep))\r\n                    target = target[pathStep];\r\n                else\r\n                    if (pointerType == 'object')\r\n                        target = target[pathStep] = {};\r\n                    else\r\n                        target = target[pathStep] = [];\r\n            }\r\n\r\n            var finalStep = path[path.length-1];\r\n            if (!mainTarget) mainTarget = target;\r\n\r\n            if (pointerType == 'array') {\r\n                for (var k in pointer) {\r\n                    var found = multiproject (pointer[k], target[k], [ finalStep ]);\r\n                    if (found !== undefined)\r\n                        target[k] = found;\r\n                }\r\n                return mainTarget;\r\n            } else if (pointerType != 'object')\r\n                return mainTarget;\r\n\r\n            if (Object.hasOwnProperty.call (pointer, finalStep)) {\r\n                target[finalStep] = pointer[finalStep];\r\n                if (!mainTarget) mainTarget = target;\r\n            }\r\n            return mainTarget;\r\n        }\r\n\r\n        var directive = projection[path];\r\n\r\n        // walk the document to the projected leaves, if able\r\n        var pointer = document;\r\n        var ppointer = outputDoc;\r\n        var pathFrags = path.split ('.');\r\n        var broken = false;\r\n        var pointerType = 'object';\r\n        for (var i=0,j=pathFrags.length-1; i<j; i++) {\r\n            if (pointer === undefined) {\r\n                broken = true; // projected key not available because it is missing\r\n                break;\r\n            }\r\n            if (dollarPath && pathFrags.slice (0, i+1).join ('.') == dollarPath) {\r\n                // clobbered by dollarPath\r\n                // KEYWORD we could speed this up\r\n                broken = true;\r\n                break;\r\n            }\r\n\r\n            var pathStep = pathFrags[i];\r\n\r\n            // positional operator\r\n            if (pathStep == '$') {\r\n                if (pointerType != 'array')\r\n                    throw new Error ('positional operator requires an Array');\r\n                if (!query)\r\n                    throw new Error ('positional operator requires an query');\r\n                if (dollarPath)\r\n                    throw new Error ('cannot use the positional operator on more than one Array');\r\n\r\n                var dollarFrags = pathFrags.slice (0, i);\r\n                dollarPath = dollarFrags.join ('.');\r\n                var dollarPosition = resolveDollar (document, query, dollarFrags, dollarPath);\r\n                if (dollarPosition < 0) { // could not resolve - not found\r\n                    broken = true;\r\n                    break;\r\n                }\r\n                previousPPointer[previousStep] = [ pointer[dollarPosition] ];\r\n                broken = true;\r\n                break;\r\n            }\r\n\r\n            // array multiprojection\r\n            if (pointerType == 'array') {\r\n                var remainingPath = pathFrags.slice (i);\r\n                for (var i in pointer) {\r\n                    var docfrag = multiproject (pointer[i], ppointer[i], remainingPath);\r\n                    if (docfrag !== undefined)\r\n                        ppointer[i] = docfrag;\r\n                }\r\n                broken = true;\r\n                break;\r\n            }\r\n\r\n            // walk the pointer\r\n            previousPPointer = ppointer;\r\n            previousStep = pathStep;\r\n            pointer = pointer[pathStep];\r\n            pointerType = getTypeStr (pointer);\r\n\r\n            // walk ppointer, or infill\r\n            if (Object.hasOwnProperty.call (ppointer, pathStep))\r\n                ppointer = ppointer[pathStep];\r\n            else\r\n                if (pointerType == 'object')\r\n                    ppointer = ppointer[pathStep] = {};\r\n                else if (pointerType == 'array')\r\n                    ppointer = ppointer[pathStep] = [];\r\n                else { // this is an intermediate frag so, a.$.b but the elem $ isn't a container\r\n                    broken = true;\r\n                    break;\r\n                }\r\n        }\r\n        if (broken) // projected key was unavailable, we already processed it, whatever\r\n            continue;\r\n\r\n        var finalStep = pathFrags[pathFrags.length-1];\r\n\r\n        // array multiprojection\r\n\r\n        if (finalStep != '$')\r\n            if (pointerType != 'array')\r\n                pointer = pointer[finalStep];\r\n            else {\r\n                for (var i in pointer) {\r\n                    var docfrag = multiproject (pointer[i], ppointer[i], [ finalStep ]);\r\n                    if (docfrag !== undefined)\r\n                        ppointer[i] = docfrag;\r\n                }\r\n                continue\r\n            }\r\n        else {\r\n            if (pointerType != 'array')\r\n                throw new Error ('positional operator requires an Array');\r\n            if (!query)\r\n                throw new Error ('positional operator requires an query');\r\n            if (dollarPath)\r\n                throw new Error ('cannot use the positional operator on more than one Array');\r\n\r\n            var dollarFrags = pathFrags.slice (0, i);\r\n            dollarPath = dollarFrags.join ('.');\r\n            var dollarPosition = resolveDollar (document, query, dollarFrags, dollarPath);\r\n            if (dollarPosition < 0) // could not resolve - not found\r\n                continue\r\n            previousPPointer[previousStep] = [ pointer[dollarPosition] ];\r\n            continue;\r\n        }\r\n\r\n        // simple projection? { a.b.c:1 }\r\n        if (\r\n            !Object.hasOwnProperty.call (directive, '$elemMatch')\r\n         && !Object.hasOwnProperty.call (directive, '$slice')\r\n        ) {\r\n            if (pointer !== undefined) {\r\n                var leafTypeStr = getTypeStr (pointer);\r\n                if (leafTypeStr != 'array')\r\n                    ppointer[finalStep] = pointer;\r\n                else {\r\n                    var newCloneArr = ppointer[finalStep] = [];\r\n                    newCloneArr.push.apply (newCloneArr, pointer);\r\n                }\r\n            }\r\n\r\n            continue;\r\n        }\r\n\r\n        // complex projection\r\n        if (!(pointer instanceof Array))\r\n            continue;\r\n\r\n        // $elemMatch\r\n        if (directive.$elemMatch) {\r\n            ppointer = ppointer[finalStep] = [];\r\n            for (var k in pointer)\r\n                if (matchQuery (pointer[k], directive.$elemMatch)) {\r\n                    ppointer.push (pointer[k]);\r\n                    break;\r\n                }\r\n            continue;\r\n        }\r\n\r\n        // $slice\r\n        if (directive.$slice) {\r\n            if (directive.$slice instanceof Number)\r\n                if (directive.$slice >= 0)\r\n                    ppointer[finalStep] = pointer.slice (0, directive.$slice);\r\n                else\r\n                    ppointer[finalStep] = pointer.slice (directive.$slice);\r\n            else if (!(directive.$slice instanceof Array))\r\n                throw new Error ('$slice requires an Array of boundary indices');\r\n            ppointer[finalStep] = pointer.slice (\r\n                directive.$slice[0],\r\n                directive.$slice[0] + directive.$slice[1]\r\n            );\r\n\r\n            continue;\r\n        }\r\n\r\n        throw new Error ('unsupported query option '+JSON.stringify (directive));\r\n    }\r\n\r\n    return outputDoc;\r\n}\r\n\r\nmodule.exports = project;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar matchLeaves = require ('./MatchLeaves');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\nvar LOOKUP_BSON_TYPE = {\r\n    1:  'number',\r\n    2:  'string',\r\n    3:  'object',\r\n    4:  'array',\r\n    5:  'buffer',\r\n    6:  'undefined',\r\n    8:  'boolean',\r\n    9:  'date',\r\n    10: 'null',\r\n    11: 'regexp',\r\n    13: 'function',\r\n    16: 'number',\r\n    18: 'number'\r\n};\r\n\r\nvar fieldOps = {\r\n    '$not':         function $not (val, query) {\r\n        if (getTypeStr (val) != 'object')\r\n            throw new Error ('$not requires a query document');\r\n        if (matchQuery (val, query))\r\n            return false;\r\n        return true;\r\n    },\r\n    '$gt':          function $gt (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val <= query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$gte':         function $gte (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val < query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$in':          function $in (val, query) {\r\n        if (getTypeStr (query) != 'array')\r\n            throw new Error ('$in requires an Array');\r\n\r\n        var isString = typeof val == 'string';\r\n        for (var i in query) {\r\n            var subquery = query[i];\r\n            if (getTypeStr (subquery) == 'regexp') {\r\n                if (!isString) continue;\r\n                else if (val.match (subquery))\r\n                    return true;\r\n            } else if (matchLeaves (subquery, val))\r\n                return true;\r\n        }\r\n        return false;\r\n    },\r\n    '$lt':          function $lt (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val >= query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$lte':         function $lte (val, query) {\r\n        if (typeof val != 'number' || typeof query != 'number' || val > query)\r\n            return false;\r\n        return true;\r\n    },\r\n    '$ne':          function $ne (val, query) {\r\n        if (matchLeaves (val, query))\r\n            return false;\r\n        return true;\r\n    },\r\n    '$nin':         function $nin (val, query) {\r\n        if (getTypeStr (query) != 'array')\r\n            throw new Error ('$nin requires an Array');\r\n\r\n        var isString = typeof val == 'string';\r\n        for (var i in query) {\r\n            var subquery = query[i];\r\n            if (getTypeStr (subquery) == 'regexp') {\r\n                if (!isString) continue;\r\n                else if (val.match (subquery))\r\n                    return false;\r\n            } else if (matchLeaves (query[i], val))\r\n                return false;\r\n        }\r\n        return true;\r\n    },\r\n    '$mod':         function $mod (val, query) {\r\n        if (getTypeStr (query) != 'array' || query.length != 2)\r\n            throw new Error ('$in requires an Array of [ divisor, remainder ]');\r\n\r\n        if (typeof val != 'number') return false;\r\n\r\n        if (val % query[0] == query[1])\r\n            return true;\r\n        return false;\r\n    },\r\n    '$regex':       function $regex (val, query) {\r\n        if (getTypeStr (query) != 'regexp')\r\n            throw new Error ('$regex requires a RegExp');\r\n\r\n        if (typeof val != 'string')\r\n            return false;\r\n        return val.match (query) ? true : false;\r\n    },\r\n    '$type':        function $type (val, query) {\r\n        if (getTypeStr (query) != 'number')\r\n            throw new Error ('$type requires a BSON type integer');\r\n        if (!LOOKUP_BSON_TYPE.hasOwnProperty (query))\r\n            return false;\r\n        return getTypeStr (val) == LOOKUP_BSON_TYPE[query];\r\n    }\r\n};\r\n\r\n\r\nvar arrOps = {\r\n    '$all':         function $all (arr, query) {\r\n        if (getTypeStr (query) != 'array')\r\n            throw new Error ('$all requires an Array of values');\r\n        if (!arr.length) return true;\r\n\r\n        var clone = [];\r\n        clone.push.apply (clone, query);\r\n        for (var i in arr)\r\n            for (var j=0,k=clone.length; j<k; j++)\r\n                if (matchLeaves (arr[i], clone[j])) {\r\n                    clone.splice (j, 1);\r\n                    j--; k--;\r\n                    if (!k) return true;\r\n                }\r\n        return false;\r\n    },\r\n    '$elemMatch':   function $elemMatch (arr, query) {\r\n        if (getTypeStr (query) != 'object')\r\n            throw new Error ('$elemMatch requires a query document');\r\n        for (var i in arr)\r\n            if (matchQuery (arr[i], query))\r\n                return true;\r\n        return false;\r\n    },\r\n    '$size':        function $size (arr, query) {\r\n        if (getTypeStr (query) != 'number')\r\n            throw new Error ('$size requires an integer');\r\n        if (arr.length == query)\r\n            return true;\r\n        return false;\r\n    }\r\n};\r\n\r\n\r\nvar ops = {};\r\nfor (var key in fieldOps) ops[key] = fieldOps[key];\r\nfor (var key in arrOps) ops[key] = arrOps[key];\r\n\r\nmodule.exports.ops = ops;\r\nmodule.exports.fieldOps = fieldOps;\r\nmodule.exports.arrOps = arrOps;\r\n","\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\n/**     @property/Function fauxmongo.resolveDollar\r\n    @root\r\n    @development\r\n    Determine the numeric index, if any, of a value matching the positional operator. The prefix\r\n    path where the positional operator was found is required, e.g. `comments.$.author` uses the path\r\n    `comments`.\r\n\r\n    Both `path` and `pathstr` are required (not generated) because if you are calling\r\n    `resolveDollar` you probably have or need both of these anyway.\r\n@argument/Object target\r\n    The outer document to search. Must have the same root as the `path` and `pathstr` arguments.\r\n@argument/Object query\r\n    The query object used to generate the positional operator.\r\n@argument/Array path\r\n    The prefix path where the positional operator was found, as an Array of keys.\r\n@argument/String pathstr\r\n    The prefix path where the positional operator was found, as a dot-delimited String.\r\n*/\r\nfunction resolveDollar (target, query, path, pathstr) {\r\n    // scan the target for paths that begin with the supplied path.\r\n    // there can be more than one - the last path that matches an element sets the dollarsign op\r\n    // first, walk the target to the array in question\r\n    var pointer = target;\r\n    for (var i in path)\r\n        pointer = pointer[path[i]];\r\n    if (!pointer.length) return -1;\r\n\r\n    var pslen = pathstr.length;\r\n    var dollar = -1;\r\n\r\n    var didDocumentQuery = false;\r\n    for (var qpath in query) {\r\n        if (qpath.slice (0, pslen) != pathstr)\r\n            continue;\r\n        var subquery = query[qpath];\r\n        if (subquery instanceof Object) {\r\n            if (Object.hasOwnProperty.call (subquery, '$elemMatch')) {\r\n                // elemMatch query\r\n                for (var i in pointer)\r\n                    if (matchQuery (pointer[i], subquery.$elemMatch)) {\r\n                        dollar = i;\r\n                        break;\r\n                    }\r\n                if (dollar >= 0)\r\n                    return dollar;\r\n                continue;\r\n            }\r\n        }\r\n\r\n        if (didDocumentQuery)\r\n            continue; // whatever, nerd!\r\n\r\n        var dummyQuery = {};\r\n        dummyQuery[qpath.slice (pslen+1)] = subquery;\r\n        for (var i in pointer)\r\n            if (matchQuery (pointer[i], dummyQuery)) {\r\n                try {\r\n                    var keys = Object.keys (subquery);\r\n                    if (keys.length && keys[0][0] == '$')\r\n                        didDocumentQuery = true;\r\n                } catch (err) { /* subquery isn't an Object */ }\r\n                dollar = i;\r\n                break;\r\n            }\r\n    }\r\n\r\n    return dollar;\r\n}\r\n\r\nmodule.exports = resolveDollar;\r\n","\r\n/**     @module/class fauxmongo.Set\r\n    @development\r\n    Collects a set of unique MongoDB documents.\r\n@argument/Array values\r\n*/\r\n\r\nvar matchLeaves = require ('./MatchQuery').matchLeaves;\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\nfunction Set (values) {\r\n    this.strings = {};\r\n    this.nums = {};\r\n    this.others = [];\r\n\r\n    if (values) for (var i in values) {\r\n        var val = values[i];\r\n        var type = getTypeStr (val);\r\n        if (type == 'string')\r\n            this.strings[val] = true;\r\n        else if (type == 'number')\r\n            this.nums[val] = true;\r\n        else {\r\n            var found = false;\r\n            for (var j in this.others)\r\n                if (matchLeaves (val, this.others[j])) {\r\n                    found = true;\r\n                    break;\r\n                }\r\n            if (!found)\r\n                this.others.push (val);\r\n        }\r\n    }\r\n}\r\n\r\n\r\n/**     @member/Function union\r\n    @development\r\n    Add another Set's values to this Set.\r\n@argument/.Set other\r\n*/\r\nSet.prototype.union = function (other) {\r\n    for (var key in other.strings)\r\n        this.strings[key] = true;\r\n    for (var key in other.nums)\r\n        this.nums[key] = true;\r\n    for (var i in other.others) {\r\n        var found = false;\r\n        for (var j in this.others)\r\n            if (matchLeaves (other.others[i], this.others[j])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found)\r\n            this.others.push (other.others[i]);\r\n    }\r\n};\r\n\r\n\r\n/**     @member/Function difference\r\n    @development\r\n    Remove another Set's values from this Set.\r\n@argument/.Set other\r\n*/\r\nSet.prototype.difference = function (other) {\r\n    for (var key in other.strings)\r\n        delete this.strings[key];\r\n    for (var key in other.nums)\r\n        delete this.nums[key];\r\n    for (var oi in other.others)\r\n        for (var i=0,j=this.others.length; i<j; i++)\r\n            if (matchLeaves (this.others[i], other.others[oi])) {\r\n                this.others.splice (i, 1);\r\n                i--; j--;\r\n                break;\r\n            }\r\n};\r\n\r\n\r\n/**     @member/Function intersect\r\n    @development\r\n    Create a new Set containing only values which appear in both this Set and another Set.\r\n@argument/.Set other\r\n@returns/.Set newSet\r\n*/\r\nSet.prototype.intersect = function (other) {\r\n    var newSet = new Set ([]);\r\n    for (var key in other.strings)\r\n        if (Object.hasOwnProperty.call (this.strings, key))\r\n            newSet.strings[key] = true;\r\n    for (var key in other.nums)\r\n        if (Object.hasOwnProperty.call (this.nums, key))\r\n            newSet.nums[key] = true;\r\n    for (var oi in other.others)\r\n        for (var i=0,j=this.others.length; i<j; i++)\r\n            if (matchLeaves (this.others[i], other.others[oi])) {\r\n                newSet.others.push (this.others[i]);\r\n                break;\r\n            }\r\n\r\n    return newSet;\r\n};\r\n\r\n\r\n/**     @member/Function equals\r\n    @development\r\n    Determine whether this Set contains the exact same collection of values as another Set.\r\n@argument/.Set other\r\n@returns/Boolean\r\n*/\r\nSet.prototype.equals = function (other) {\r\n    if (this.others.length != other.others.length)\r\n        return false;\r\n\r\n    var strings = Object.keys (this.strings);\r\n    var nums = Object.keys (this.nums);\r\n    var otherStrings = Object.keys (other.strings);\r\n    var otherNums = Object.keys (other.nums);\r\n\r\n    if (strings.length != otherStrings.length || nums.length != otherNums.length)\r\n        return false;\r\n\r\n    for (var i in strings)\r\n        if (!Object.hasOwnProperty.call (other.strings, strings[i]))\r\n            return false;\r\n\r\n    for (var i in nums)\r\n        if (!Object.hasOwnProperty.call (other.nums, nums[i]))\r\n            return false;\r\n\r\n    for (var i in this.others) {\r\n        var found = false;\r\n        for (var j in other.others)\r\n            if (matchLeaves (other.others[j], this.others[i])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found)\r\n            return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n\r\n/**     @member/Function contains\r\n    @development\r\n    Determine whether every value in another Set is also contained in this Set.\r\n@argument/.Set other\r\n@returns/Boolean\r\n*/\r\nSet.prototype.contains = function (other) {\r\n    for (var key in other.strings)\r\n        if (!Object.hasOwnProperty.call (this.strings, key))\r\n            return false;\r\n\r\n    for (var key in other.nums)\r\n        if (!Object.hasOwnProperty.call (this.nums, key))\r\n            return false;\r\n\r\n    for (var i in other.others) {\r\n        var found = false;\r\n        for (var j in this.others)\r\n            if (matchLeaves (this.others[j], other.others[i])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found) return false;\r\n    }\r\n\r\n    return true;\r\n};\r\n\r\n\r\n/**     @member/Function add\r\n    @development\r\n    Add a value to this Set and return whether or not the value was previously unknown.\r\n@argument value\r\n@returns/Boolean `true` if the item was added, `false` if it was already there.\r\n*/\r\nSet.prototype.add = function (val) {\r\n    var type = getTypeStr (val);\r\n    if (type == 'string' && !Object.hasOwnProperty.call (this.nums, val))\r\n        this.strings[val] = true;\r\n    else if (type == 'number' && !Object.hasOwnProperty.call (this.nums, String (val)))\r\n        this.nums[val] = true;\r\n    else {\r\n        var found = false;\r\n        for (var j in this.others)\r\n            if (matchLeaves (val, this.others[j])) {\r\n                found = true;\r\n                break;\r\n            }\r\n        if (!found) {\r\n            this.others.push (val);\r\n            return true;\r\n        }\r\n    }\r\n};\r\n\r\n\r\n/**     @member/Function export\r\n    Create an Array of every value stored in this Set.\r\n@returns/Array\r\n    An Array of unique elements in this Set.\r\n*/\r\nSet.prototype.export = function(){\r\n    var vals = Object.keys (this.strings);\r\n    vals.push.apply (vals, Object.keys (this.nums).map (Number));\r\n    vals.push.apply (vals, this.others);\r\n    return vals;\r\n};\r\n\r\n\r\nmodule.exports = Set;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\n\r\nvar ARR_SORT_PRIORITY = [\r\n    'null', 'number', 'string', 'object', 'array', 'buffer', 'boolean', 'date', 'regexp'\r\n];\r\nvar SORT_PRIORITY = {};\r\nfor (var i in ARR_SORT_PRIORITY) SORT_PRIORITY[ARR_SORT_PRIORITY[i]] = i;\r\n\r\n/**     @module fauxmongo.Sorting\r\n    Generate sorter Functions for ordering documents and leaves.\r\n*/\r\n\r\n/**     @property/Function getLeafSort\r\n    @development\r\n    @private\r\n    Creates a simple sort function closing on the desired sort polarity. MongoDB documents are\r\n    compared as leaf data, with data type being the highest priority.\r\n@argument/Number sspec\r\n@returns/Function\r\n*/\r\nfunction getLeafsort (sspec) {\r\n    sspec *= -1;\r\n    function leafsort (able, baker) {\r\n        if (able === baker) return 0;\r\n        var aType = getTypeStr (able);\r\n        var bType = getTypeStr (baker);\r\n        if (aType != bType)\r\n            return Math.max (-1, Math.min (1,\r\n                sspec * (SORT_PRIORITY[bType] - SORT_PRIORITY[aType])\r\n            ));\r\n        if (aType == 'number')\r\n            return Math.max (-1, Math.min (1, sspec * (baker - able)));\r\n        if (aType == 'string')\r\n            if (baker > able)\r\n                return sspec;\r\n            else\r\n                return -1 * sspec;\r\n        if (aType == 'object') {\r\n            var aKeys = Object.keys (able)[0];\r\n            var bKeys = Object.keys (baker)[0];\r\n            for (var i in bKeys) {\r\n                if (aKeys[i] == bKeys[i]) { // recurse\r\n                    var comp = leafsort (able[aKeys[i]], baker[aKeys[i]]);\r\n                    if (comp) return comp;\r\n                } else if (bKeys[i] > aKeys[i])\r\n                    return sspec;\r\n                else\r\n                    return -1 * sspec;\r\n            }\r\n        }\r\n        if (aType == 'array') {\r\n            if (!aType.length)\r\n                if (bType.length) return 1;\r\n                else return 0;\r\n            if (!bType.length)\r\n                if (aType.length) return -1;\r\n                else return 0;\r\n            if (sspec > 0) { // find highest\r\n                var aHighest = able[0];\r\n                var bHighest = baker[0];\r\n                for (var i=1,j=able.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (aHighest, able[i]) > 0)\r\n                        aHighest = able[i];\r\n                for (var i=1,j=baker.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (bHighest, able[i]) > 0)\r\n                        bHighest = baker[i];\r\n                // recurse\r\n                return leafsort (aHighest, bHighest);\r\n            } else { // find lowest\r\n                var aLowest = able[0];\r\n                var bLowest = baker[0];\r\n                for (var i=1,j=able.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (aLowest, able[i]) < 0)\r\n                        aLowest = able[i];\r\n                for (var i=1,j=baker.length; i<j; i++) // recurse\r\n                    if (sspec * leafsort (bLowest, able[i]) < 0)\r\n                        bLowest = baker[i];\r\n                // recurse\r\n                return leafsort (aLowest, bLowest);\r\n            }\r\n        }\r\n        if (aType == 'buffer')\r\n            if (able.length != baker.length)\r\n                return Math.max (-1, Math.min (1, sspec * (baker.length - able.length)));\r\n            else {\r\n                for (var i=0,j=able.length; i<j; i++)\r\n                    if (able[i] != baker[i])\r\n                        return Math.max (-1, Math.min (1,\r\n                            sspec * (Number(baker[i]) - Number(able[i]))\r\n                        ));\r\n                return 0;\r\n            }\r\n        if (aType == 'boolean')\r\n            if (bType) return sspec;\r\n            else return -1 * sspec;\r\n        if (aType == 'date')\r\n            if (baker > able)\r\n                return sspec;\r\n            else\r\n                return -1 * sspec;\r\n\r\n        // all other types are considered indistinguishable to sort\r\n        return 0;\r\n    }\r\n\r\n    return leafsort;\r\n}\r\n\r\n\r\n/**     @property/Function getDocSort\r\n    @development\r\n    @private\r\n    Creates a complex sort function closing on the provided specification document. Documents are\r\n    compared according to the specification.\r\n@argument/Object sspec\r\n@returns/Function\r\n    A Function suitable for use with [standard sorting](Array#sort).\r\n*/\r\nfunction getDocsort (sspec) {\r\n    var leafsort = getLeafsort (1);\r\n    var specPaths = [];\r\n    var specFullpaths = Object.keys (sspec);\r\n    for (var key in sspec)\r\n        if (key.match (/\\$/))\r\n            throw new Error ('invalid sort path '+key);\r\n        else\r\n            specPaths.push (key.split ('.'));\r\n\r\n    return function (able, baker) {\r\n        for (var i in specPaths) {\r\n            var path = specPaths[i];\r\n            var aPointer = able;\r\n            var bPointer = baker;\r\n            var direction = sspec[specFullpaths[i]] > 0 ? 1 : -1;\r\n            for (var j in path) {\r\n                var frag = path[j];\r\n                if (!Object.hasOwnProperty.call (able, frag))\r\n                    if (Object.hasOwnProperty.call (baker, frag))\r\n                        return direction;\r\n                    else continue;\r\n                if (!Object.hasOwnProperty.call (baker, frag))\r\n                    if (Object.hasOwnProperty.call (able, frag))\r\n                        return -1 * direction;\r\n                    else continue;\r\n                aPointer = aPointer[frag];\r\n                bPointer = bPointer[frag];\r\n            }\r\n            var comp = direction * leafsort (aPointer, bPointer);\r\n            if (comp) return comp;\r\n        }\r\n        return 0;\r\n    };\r\n}\r\n\r\n\r\nmodule.exports.getLeafsort = getLeafsort;\r\nmodule.exports.getDocsort = getDocsort;\r\n","\r\n/**     @property/Function fauxmongo.update\r\n    @root\r\n    Apply a MongoDB update operation in place.\r\n@argument/Object query\r\n    @optional\r\n    If the update uses the positional operator, provide a query to define it.\r\n@argument/Object target\r\n    The document to update. This document will be modified.\r\n@argument/Object change\r\n    The update specification to apply.\r\n*/\r\n\r\nvar MOD_OPS = {\r\n    '$each':        true,\r\n    '$position':    true,\r\n    '$slice':       true,\r\n    '$sort':        true\r\n};\r\n\r\nvar STUBBORN_OPS = {\r\n    '$set':         true,\r\n    '$inc':         true,\r\n    '$min':         true,\r\n    '$max':         true,\r\n    '$mul':         true,\r\n    '$currentDate': true,\r\n    '$addToSet':    true,\r\n    '$push':        true,\r\n    '$pushAll':     true\r\n};\r\n\r\nfunction update (query, target, change) {\r\n    if (!change) {\r\n        change = target;\r\n        target = query;\r\n        query = undefined;\r\n    }\r\n\r\n    // $rename\r\n    if (Object.hasOwnProperty.call (change, '$rename'))\r\n        for (var oldPath in change.$rename) {\r\n            // acquire the value assigned to the current path, if able\r\n            // else skip this path\r\n            var pointer = target;\r\n            var notOK;\r\n            var frags = oldPath.split ('.');\r\n            for (var i in frags) {\r\n                var type = getTypeStr (pointer);\r\n                if (type != 'object' && type != 'array')\r\n                    throw new Error ('cannot traverse data to rename path '+oldPath);\r\n\r\n                var frag = frags[i];\r\n                if (frag[0] == '$')\r\n                    throw new Error ('cannot rename dynamic path '+oldPath);\r\n                if (!Object.hasOwnProperty.call (pointer, frag)) { // value not found\r\n                    notOK = true;\r\n                    break;\r\n                }\r\n                pointer = pointer[frag];\r\n            }\r\n            if (notOK) continue; // try the next path\r\n\r\n            var newPath = change.$rename[oldPath];\r\n            if (!Object.hasOwnProperty.call (change, '$set'))\r\n                change.$set = {};\r\n            // what do you think about the newPath?\r\n            if (Object.hasOwnProperty.call (change.$set, newPath))\r\n                throw new Error ('cannot rename more than one value to the same path '+newPath);\r\n            change.$set[newPath] = pointer;\r\n            if (!Object.hasOwnProperty.call (change, '$unset'))\r\n                change.$unset = {};\r\n            change.$unset[oldPath] = true;\r\n        }\r\n\r\n    var dollarTarget, dollarTargetStr; // only one key can use the $ operator at a time\r\n    for (var op in change) {\r\n        var job = change[op];\r\n\r\n        if (!operators.ops.hasOwnProperty (op))\r\n            throw new Error ('unrecognized operator '+op);\r\n        if (op == '$rename' || op == '$isolated') continue;\r\n\r\n        var stubborn = STUBBORN_OPS.hasOwnProperty (op); // whether to infill missing props\r\n        for (var path in job) {\r\n            var writing = false; // whether CURRENTLY infilling missing props\r\n            var frags = path.split ('.');\r\n            var pointer = target;\r\n            var pointerType = 'object';\r\n\r\n            // iterate all but the last frag\r\n            var ok = true;\r\n            for (var i=0,j=frags.length-1; i<j; i++) {\r\n                if (pointerType != 'object' && pointerType != 'array')\r\n                    throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n                var frag = frags[i];\r\n\r\n                // dollar operator handling\r\n                if (frag == '$') {\r\n                    if (writing) { // if the key doesn't exist, the positional operator is useless\r\n                        ok = false;\r\n                        break;\r\n                    }\r\n                    if (pointerType != 'array')\r\n                        throw new Error (\r\n                            'Found a non-Array ('\r\n                          + pointerType\r\n                          + ') at the $ operator in path '\r\n                          + path\r\n                        );\r\n                    if (!i)\r\n                        throw new Error (\r\n                            'The path '+path+' is invalid because it begins with the $ operator.'\r\n                        );\r\n                    var newDollar = frags.slice (0, i);\r\n                    var newDollarStr = newDollar.join ('.');\r\n                    if (dollarTarget !== undefined && newDollarStr != dollarTargetStr)\r\n                        throw new Error (\r\n                            'The $ operator may only be used on one field (at '+path+')'\r\n                        );\r\n                    dollarTarget = newDollar;\r\n                    dollarTargetStr = newDollarStr;\r\n                    frag = resolveDollar (target, query, dollarTarget, dollarTargetStr);\r\n                    if (frag < 0) continue;\r\n\r\n                    pointer = pointer[frag];\r\n                    pointerType = 'array';\r\n                    continue;\r\n                } else if (frag[0] == '$') // operator in middle of path\r\n                    throw new Error ('invalid path '+path);\r\n\r\n                // normal path fragment\r\n                if (writing) {\r\n                    pointer = pointer[frag] = {};\r\n                    continue;\r\n                }\r\n                if (Object.hasOwnProperty.call (pointer, frag)) {\r\n                    pointer = pointer[frag];\r\n                    pointerType = getTypeStr (pointer); // the business end of pointerType logic\r\n                    continue;\r\n                }\r\n                if (!stubborn) {\r\n                    ok = false;\r\n                    break;\r\n                }\r\n                writing = true;\r\n                pointer = pointer[frag] = {};\r\n                pointerType = 'object';\r\n            }\r\n            if (!ok) continue;\r\n\r\n            // we have navigated to the parent of the last fragment in the path\r\n            if (pointerType != 'object' && pointerType != 'array')\r\n                throw new Error ('Encountered a leaf in the middle of the path '+path);\r\n\r\n            var frag = frags[frags.length-1];\r\n            // handle the $ operator\r\n            if (frag == '$') {\r\n                if (writing) // if the key is missing, the positional operator is useless\r\n                    continue;\r\n                if (pointerType != 'array')\r\n                    throw new Error (\r\n                        'Found a non-Array ('\r\n                      + pointerType\r\n                      + ') at the $ operator in path '\r\n                      + path\r\n                    );\r\n\r\n                var newDollar = frags.slice (0, i);\r\n                var newDollarStr = newDollar.join ('.');\r\n                if (dollarTarget !== undefined && newDollarStr != dollarTargetStr)\r\n                    throw new Error (\r\n                        'The $ operator may only be used on one field (at '+path+')'\r\n                    );\r\n                dollarTarget = newDollar;\r\n                dollarTargetStr = newDollarStr;\r\n                frag = resolveDollar (target, query, dollarTarget, dollarTargetStr);\r\n                if (frag < 0) continue;\r\n            } else if (frag[0] == '$')\r\n                throw new Error ('invalid path '+path);\r\n\r\n            // array operations require pointer[frag] to be an array\r\n            if (operators.arrOps.hasOwnProperty (op))\r\n                if (pointer[frag] === undefined)\r\n                    if (stubborn)\r\n                        pointer[frag] = [];\r\n                    else continue;\r\n                else if (getTypeStr (pointer[frag]) != 'array')\r\n                    throw new Error ('cannot apply '+op+' to non-array value');\r\n\r\n            // apply the operator\r\n            operators.ops[op] (\r\n                pointer,\r\n                frag,\r\n                job[path]\r\n            );\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = update;\r\nvar operators = require ('./UpdateOperators');\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar resolveDollar = require ('./ResolveDollar');\r\nupdate.resolveDollar = resolveDollar;\r\n","\r\nvar getTypeStr = require ('./GetTypeStr');\r\nvar Sorting = require ('./Sorting');\r\nvar moreDollars = require ('./MoreDollars');\r\nvar matchLeaves = require ('./MatchLeaves');\r\nvar matchQuery = require ('./MatchQuery');\r\n\r\n\r\nvar fieldOps = {\r\n    '$set':         function $set (pointer, path, change) {\r\n        var changeType = getTypeStr (change);\r\n        if (\r\n            (changeType == 'object' && moreDollars (change))\r\n         || (changeType == 'array' && moreDollars (change, true))\r\n        )\r\n            throw new Error ('invalid property key in complex update');\r\n\r\n        pointer[path] = change;\r\n    },\r\n    '$inc':         function $inc (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $inc by a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = change;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $inc on a non-numeric value');\r\n            else\r\n                pointer[path] += change;\r\n    },\r\n    '$min':         function $min (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $min to a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = change;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $min on a non-numeric value');\r\n            else\r\n                pointer[path] = Math.min (pointer[path], change);\r\n    },\r\n    '$max':         function $max (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $max to a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = change;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $max on a non-numeric value');\r\n            else\r\n                pointer[path] = Math.max (pointer[path], change);\r\n    },\r\n    '$mul':         function $mul (pointer, path, change) {\r\n        if (getTypeStr (change) != 'number')\r\n            throw new Error ('cannot $mul by a non-numeric value');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = 0;\r\n        else\r\n            if (getTypeStr (pointer[path]) != 'number')\r\n                throw new Error ('cannot apply $mul on a non-numeric value');\r\n            else\r\n                pointer[path] *= change;\r\n    },\r\n    '$bit':         function $bit (pointer, path, change) {\r\n        if (getTypeStr (change) != 'object')\r\n            throw new Error ('invalid $bit update');\r\n        if (!Object.hasOwnProperty.call (pointer, path))\r\n            pointer[path] = 0;\r\n        else if (getTypeStr (pointer[path]) != 'number')\r\n            throw new Error ('cannot apply $bit on a non-numeric value');\r\n\r\n        for (var bitop in change) {\r\n            var delta = change[bitop];\r\n            if (typeof delta != 'number')\r\n                throw new Error ('cannot $bit by a non-numeric value');\r\n            if (bitop == 'and')\r\n                pointer[path] &= delta;\r\n            else if (bitop == 'or')\r\n                pointer[path] |= delta;\r\n            else if (bitop == 'xor')\r\n                pointer[path] ^= delta;\r\n            else\r\n                throw new Error ('unknown bit operation '+bitop);\r\n        }\r\n    },\r\n    '$unset':       function $unset (pointer, path, change) {\r\n        delete pointer[path];\r\n    },\r\n    '$currentDate': function $currentDate (pointer, path, change) {\r\n        pointer[path] = new Date();\r\n    },\r\n    '$rename':      true, // this op is translated to $set/$unset at an earlier stage\r\n    '$isolated':    true  // this op doesn't do anything\r\n};\r\n\r\n\r\nvar arrOps = {\r\n    '$addToSet':    function $addToSet (pointer, path, change) {\r\n        if (\r\n            Object.hasOwnProperty.call (change, '$position')\r\n         || Object.hasOwnProperty.call (change, '$sort')\r\n         || Object.hasOwnProperty.call (change, '$slice')\r\n        )\r\n            throw new Error ('Ordering modifiers are not allowed together with $addToSet');\r\n\r\n        if (!Object.hasOwnProperty.call (pointer, path)) {\r\n            pointer[path] = [ change ];\r\n            return;\r\n        }\r\n\r\n        var arr = pointer[path];\r\n            if (getTypeStr (change) == 'object' && Object.hasOwnProperty.call (change, '$each'))\r\n                for (var i in change.$each) {\r\n                    var candidate = change.$each[i];\r\n                    var write = true;\r\n                    for (var j in arr)\r\n                        if (matchLeaves (arr[j], candidate)) {\r\n                            write = false;\r\n                            break;\r\n                        }\r\n                    if (write)\r\n                        arr.push (change.$each[i]);\r\n                }\r\n            else {\r\n                for (var i in arr)\r\n                    if (matchLeaves (arr[i], change))\r\n                        return;\r\n                arr.push (change);\r\n            }\r\n    },\r\n    '$push':        function $push (pointer, path, change) {\r\n        var changeType = getTypeStr (change);\r\n        var arr = pointer[path];\r\n        if (changeType != 'object')\r\n            arr.push (change);\r\n        else if (Object.hasOwnProperty.call (change, '$each')) {\r\n            var each = change.$each;\r\n            // apply $each, with or without $position\r\n            var position;\r\n            if (Object.hasOwnProperty.call (change, '$position'))\r\n                if (change.$position < 0)\r\n                    throw new Error ('$position does not accept negative numbers');\r\n                else\r\n                    position = change.$position >= arr.length ? undefined : change.$position;\r\n            if (position === undefined)\r\n                for (var i in each)\r\n                    if (moreDollars (each[i]))\r\n                        throw new Error ('invalid property key in complex update');\r\n                    else arr.push (each[i]);\r\n            else\r\n                for (var i in each)\r\n                    if (moreDollars (each[i]))\r\n                        throw new Error ('invalid property key in complex update');\r\n                    else arr.splice (position, 0, each[i]);\r\n\r\n            // apply $sort\r\n            if (Object.hasOwnProperty.call (change, '$sort')) {\r\n                var sspec = change.$sort;\r\n                if (typeof sspec == 'number') {\r\n                    sspec = sspec > 0 ? 1 : -1;\r\n                    // leaf sort\r\n                    arr.sort (Sorting.getLeafsort (sspec));\r\n                } else\r\n                    // document sort\r\n                    arr.sort (Sorting.getDocsort (sspec));\r\n            }\r\n\r\n            // apply $slice\r\n            if (Object.hasOwnProperty.call (change, '$slice'))\r\n                if (change.$slice < 0)\r\n                    pointer[path] = arr.slice (change.$slice);\r\n                else\r\n                    pointer[path] = arr.slice (0, change.$slice);\r\n        } else if (!moreDollars (change))\r\n            arr.push (change);\r\n    },\r\n    '$pop':         function $pop (pointer, path, change) {\r\n        var changeType = getTypeStr (change);\r\n        if (changeType != 'number')\r\n            throw new Error ('$pop requires a number');\r\n\r\n        if (change > 0)\r\n            arr.pop();\r\n        else if (change < 0)\r\n            arr.shift();\r\n    },\r\n    '$pull':        function $pull (pointer, path, change) {\r\n        var arr = pointer[path];\r\n        var changeType = getTypeStr (change);\r\n        if (changeType == 'object') {\r\n            // match with query\r\n            for (var i=0,j=arr.length; i<j; i++)\r\n                if (matchQuery (arr[i], change)) {\r\n                    arr.splice (i, 1);\r\n                    i--; j--;\r\n                }\r\n        } else\r\n            // match with leaf\r\n            for (var i=0,j=arr.length; i<j; i++)\r\n                if (matchLeaves (arr[i], change)) {\r\n                    arr.splice (i, 1);\r\n                    i--; j--;\r\n                }\r\n    },\r\n    '$pullAll':     function $pullAll (pointer, path, change) {\r\n        var arr = pointer[path];\r\n        if (getTypeStr (change) != 'array')\r\n            throw new Error ('$pullAll requires an Array of values/documents to match');\r\n        for (var i in change)\r\n            for (var k=0, l=arr.length; k<l; k++)\r\n                if (matchLeaves (arr[k], change[i])) {\r\n                    arr.splice (k, 1);\r\n                    k--; l--;\r\n                }\r\n    }\r\n};\r\n\r\n\r\nvar ops = {};\r\nfor (var op in fieldOps) ops[op] = fieldOps[op];\r\nfor (var op in arrOps) ops[op] = arrOps[op];\r\n\r\nmodule.exports.ops = ops;\r\nmodule.exports.fieldOps = fieldOps;\r\nmodule.exports.arrOps = arrOps;\r\n","exports.read = function (buffer, offset, isLE, mLen, nBytes) {\n  var e, m\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var nBits = -7\n  var i = isLE ? (nBytes - 1) : 0\n  var d = isLE ? -1 : 1\n  var s = buffer[offset + i]\n\n  i += d\n\n  e = s & ((1 << (-nBits)) - 1)\n  s >>= (-nBits)\n  nBits += eLen\n  for (; nBits > 0; e = e * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  m = e & ((1 << (-nBits)) - 1)\n  e >>= (-nBits)\n  nBits += mLen\n  for (; nBits > 0; m = m * 256 + buffer[offset + i], i += d, nBits -= 8) {}\n\n  if (e === 0) {\n    e = 1 - eBias\n  } else if (e === eMax) {\n    return m ? NaN : ((s ? -1 : 1) * Infinity)\n  } else {\n    m = m + Math.pow(2, mLen)\n    e = e - eBias\n  }\n  return (s ? -1 : 1) * m * Math.pow(2, e - mLen)\n}\n\nexports.write = function (buffer, value, offset, isLE, mLen, nBytes) {\n  var e, m, c\n  var eLen = nBytes * 8 - mLen - 1\n  var eMax = (1 << eLen) - 1\n  var eBias = eMax >> 1\n  var rt = (mLen === 23 ? Math.pow(2, -24) - Math.pow(2, -77) : 0)\n  var i = isLE ? 0 : (nBytes - 1)\n  var d = isLE ? 1 : -1\n  var s = value < 0 || (value === 0 && 1 / value < 0) ? 1 : 0\n\n  value = Math.abs(value)\n\n  if (isNaN(value) || value === Infinity) {\n    m = isNaN(value) ? 1 : 0\n    e = eMax\n  } else {\n    e = Math.floor(Math.log(value) / Math.LN2)\n    if (value * (c = Math.pow(2, -e)) < 1) {\n      e--\n      c *= 2\n    }\n    if (e + eBias >= 1) {\n      value += rt / c\n    } else {\n      value += rt * Math.pow(2, 1 - eBias)\n    }\n    if (value * c >= 2) {\n      e++\n      c /= 2\n    }\n\n    if (e + eBias >= eMax) {\n      m = 0\n      e = eMax\n    } else if (e + eBias >= 1) {\n      m = (value * c - 1) * Math.pow(2, mLen)\n      e = e + eBias\n    } else {\n      m = value * Math.pow(2, eBias - 1) * Math.pow(2, mLen)\n      e = 0\n    }\n  }\n\n  for (; mLen >= 8; buffer[offset + i] = m & 0xff, i += d, m /= 256, mLen -= 8) {}\n\n  e = (e << mLen) | m\n  eLen += mLen\n  for (; eLen > 0; buffer[offset + i] = e & 0xff, i += d, e /= 256, eLen -= 8) {}\n\n  buffer[offset + i - d] |= s * 128\n}\n","function IndexedLinkedList() {\n\tthis.list = {};\n\tthis.length = 0;\n\tthis.head = null;\n\tthis.tail = null;\n}\n\n/**\n * Remove from head\n */\nIndexedLinkedList.prototype.dequeue = function() {\n\treturn this._removeItem(this.head);\n};\n\n/**\n * Remove item at given index\n * @param index\n */\nIndexedLinkedList.prototype.remove = function(index) {\n\tthis._removeItem(this.list[index]);\n};\n\n/**\n * Add at head\n * @param index\n * @param data\n */\nIndexedLinkedList.prototype.push = function(index, data) {\n\n\tvar item = this._resetIndex(index, data);\n\n\t// Link it to the list\n\tif(this.head != null)\n\t\tthis.head.prev = item;\n\n\titem.prev = null;\n\titem.next = this.head;\n\n\tthis.head = item;\n\n\tif(this.length == 0)\n\t\tthis.tail = item;\n\n\t// Change the list length\n\tthis.length++;\n\n\n};\n\n/**\n * Add at tail\n * @param index\n * @param data\n */\nIndexedLinkedList.prototype.enqueue = function(index, data) {\n\tvar item = this._resetIndex(index, data);\n\n\t// Link it to the list\n\tif(this.tail != null)\n\t\tthis.tail.next = item;\n\n\titem.next = null;\n\titem.prev = this.tail;\n\n\tthis.tail = item;\n\n\tif(this.length == 0)\n\t\tthis.head = item;\n\n\t// Change the list length\n\tthis.length++;\n};\n\n/**\n * Unlink the item from the list, if it exists\n * @param index\n * @param data\n * @private\n */\nIndexedLinkedList.prototype._resetIndex = function(index, data) {\n\t// Remove the item if it exists\n\ttry {\n\t\tthis.remove(index);\n\t}\n\tcatch(error) {}\n\n\t// Add the item to the list\n\treturn this._set(index, data);\n};\n\n/**\n * Set the data for an item; create the item if it doesn't exist\n * @param index\n * @param data\n * @private\n */\nIndexedLinkedList.prototype._set = function(index, data) {\n\tif(typeof this.list[index] == 'object') // item already exists\n\t\tthis.list[index].data = data;\n\telse {\n\t\tthis.list[index] = {\n\t\t\tdata: data,\n\t\t\tnext: undefined,\n\t\t\tprev: undefined\n\t\t}\n\t}\n\n\treturn this.list[index];\n};\n\n/**\n * Remove given item from the list\n * @param item\n * @returns {*|string|CanvasPixelArray|Object[]}\n * @private\n */\nIndexedLinkedList.prototype._removeItem = function(item) {\n\tif(typeof item != 'object' || item == null)\n\t\tthrow new Error('undefined_item');\n\telse {\n\t\t// Set next item's prev to current item's prev\n\t\tif(item.next == null) // item is at tail\n\t\t\tthis.tail = item.prev;\n\t\telse // item is not at tail\n\t\t\titem.next.prev = item.prev;\n\n\t\tif(item.prev == null) // item is at head\n\t\t\tthis.head = item.next;\n\t\telse // item is not at head\n\t\t\titem.prev.next = item.next;\n\n\t\tthis.length--;\n\t\treturn item.data;\n\t}\n};\n\nmodule.exports = function() {\n\treturn new IndexedLinkedList();\n};","var FauxMongo = require('fauxmongo');\nvar ObjectId = require('objectid');\nvar EventEmitter = require('wolfy87-eventemitter');\nvar Utils = require('./Utils');\nvar MongoLocalCursor = require('./MongoLocalCursor');\nvar IndexedLinkedList = require('./IndexedLinkedList');\n\nfunction MongoLocal(config) {\n\tif(typeof config == 'undefined' || config === null)\n\t\tconfig = {};\n\n\tthis.config = config;\n\tthis.collection = (typeof this.config.collection == 'object' || Array.isArray(this.config.collection)) ? this.config.collection : {};\n\tthis.docsLinkedList = IndexedLinkedList();\n}\n\nMongoLocal.prototype.__proto__ = EventEmitter.prototype;\n\nMongoLocal.prototype.find = function() {\n\t// https://docs.mongodb.com/v3.0/reference/method/db.collection.find/\n\t// [query,] [projection]\n\tvar mongolocal = this;\n\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'query', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object' || typeof(arg) == 'string'; }, default: {}},\n\t\t\t{name: 'projection', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }},\n\t\t\t{name: 'callback', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'function'; }}\n\t\t]\n\t);\n\n\tvar query = mongolocal._validateQuery(parsedArgs.query);\n\n\t// Set the starting positions\n\tvar index, currentNode, returnedOne, lastResultDoc;\n\trewindResults();\n\n\tvar cursor = MongoLocalCursor(peekResult, nextResult, rewindResults);\n\tif(typeof parsedArgs.callback == 'function')\n\t\tparsedArgs.callback(null, cursor);\n\treturn cursor;\n\n\t// Return the next result without advancing the cursor\n\tfunction peekResult() {\n\t\tif(Array.isArray(mongolocal.collection)) {\n\t\t\tif(index > 0 && lastResultDoc != mongolocal.collection[index]) // Collection was changed (probably doc was deleted); try reversing\n\t\t\t\tindex--;\n\t\t\twhile(!returnedOne && index < mongolocal.collection.length) {\n\t\t\t\tvar result = {index: index, doc: mongolocal.collection[index]};\n\t\t\t\tif(mongolocal._docFilter(result.doc, query)) { // doc matches\n\t\t\t\t\tlastResultDoc = result.doc;\n\t\t\t\t\treturn result;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tindex++; // Cursor will not advance if result is returned\n\t\t\t}\n\t\t\treturn null;\n\t\t}\n\t\telse {\n\t\t\tif(Object.keys(query).length == 1 && typeof query._id != 'undefined') // Looking for single doc, by index\n\t\t\t\treturn (typeof mongolocal.collection[query._id] != 'undefined' && !returnedOne) ? {index: query._id, doc: mongolocal.collection[query._id]} : null;\n\t\t\telse {\n\t\t\t\twhile(currentNode != null) {\n\t\t\t\t\tvar result = {index: currentNode.data, doc: mongolocal.collection[currentNode.data]};\n\t\t\t\t\tif(mongolocal._docFilter(result.doc, query)) // doc matched\n\t\t\t\t\t\treturn result;\n\t\t\t\t\telse\n\t\t\t\t\t\tcurrentNode = currentNode.next; // Will not be triggered if result is returned\n\t\t\t\t}\n\t\t\t\treturn null; // Reached end of collection\n\t\t\t}\n\t\t}\n\t}\n\n\t// Return the next result and advance the cursor\n\tfunction nextResult() {\n\t\tvar result = peekResult();\n\n\t\tif(Object.keys(query).length == 1 && typeof query._id != 'undefined') // Looking for single doc, by index\n\t\t\treturnedOne = true;\n\t\tif(Array.isArray(mongolocal.collection)) {// TODO check if\n\t\t\tindex++;\n\t\t\tlastResultDoc = mongolocal.collection[index];\n\t\t}\n\t\telse if(currentNode != null)\n\t\t\tcurrentNode = currentNode.next;\n\n\t\treturn result;\n\t}\n\n\tfunction rewindResults() {\n\t\treturnedOne = false;\n\t\tif(Array.isArray(mongolocal.collection))\n\t\t\tindex = 0;\n\t\telse\n\t\t\tcurrentNode = mongolocal.docsLinkedList.head;\n\t}\n};\n\nMongoLocal.prototype.findOne = function() {\n\t// https://docs.mongodb.com/v3.0/reference/method/db.collection.findOne/\n\t// [query,] [projection,] [callback]\n\t// collection, [query,] [projection,] [callback]\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'query', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object' || typeof(arg) == 'string'; }, default: {}},\n\t\t\t{name: 'projection', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }},\n\t\t\t{name: 'callback', level: 0, validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\tthis.find(parsedArgs.query, parsedArgs.projection).next(function(error, doc) {\n\t\tparsedArgs.callback(error, doc);\n\t});\n};\n\n/**\n *\n * @param docs\n * @param options\n * @param callback\n */\nMongoLocal.prototype.insert = function() {\n\t// https://docs.mongodb.com/v3.0/reference/method/db.collection.insert/\n\t// docs, [options], [callback]\n\tvar mongolocal = this;\n\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'docs', level: 0, validate: function(arg, allArgs) { return typeof(arg) == 'object' }},\n\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1, validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\tvar options = Utils.objectMerge({emit: true}, parsedArgs.options);\n\toptions = Utils.objectMerge({emitCascade: options.emit}, options); // add emitCascade option\n\n\tif (Array.isArray(parsedArgs.docs)) {// insert multiple docs\n\t\tvar continueInsert = true; // TODO add option to continue on error\n\t\tparsedArgs.docs.forEach(function (doc) {\n\t\t\tinsertDocSafe(doc, function (error) {\n\t\t\t\tif (error) {\n\t\t\t\t\tcontinueInsert = false;\n\t\t\t\t\tcallbackSafe(error);\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t\tif (continueInsert)\n\t\t\tcallbackSafe(null, null);\n\t}\n\telse {// insert single doc\n\t\tinsertDocSafe(parsedArgs.docs, function (error) {\n\t\t\tif (error)\n\t\t\t\tcallbackSafe(error, null);\n\t\t\telse\n\t\t\t\tcallbackSafe(null, null);\n\t\t});\n\t}\n\n\tfunction callbackSafe(error, result) {\n\t\tif(typeof parsedArgs.callback == 'function')\n\t\t\tparsedArgs.callback(error, result);\n\t}\n\n\tfunction insertDocSafe(doc, callback) {\n\t\tif(typeof doc._id == 'undefined') {\n\t\t\tdoc._id = ObjectId();\n\t\t\tinsertDoc(doc, callback);\n\t\t}\n\t\telse {\n\t\t\tmongolocal.findOne({_id: doc._id}, function(error, result) {\n\t\t\t\tif(error)\n\t\t\t\t\tcallback('find_error');\n\t\t\t\telse if(result != null)\n\t\t\t\t\tcallback('id_exists');\n\t\t\t\telse\n\t\t\t\t\tinsertDoc(doc, callback);\n\t\t\t});\n\t\t}\n\t}\n\n\tfunction insertDoc(doc, callback) {\n\t\t// TODO duplicate docs before adding _id? Check mongo spec\n\t\tif(typeof mongolocal.config.insert == 'function') // override is set (for Polymer)\n\t\t\tmongolocal.config.insert(doc);\n\t\telse if(Array.isArray(mongolocal.collection))\n\t\t\tmongolocal.collection.push(doc);\n\t\telse\n\t\t\tmongolocal.collection[doc._id] = doc;\n\n\t\tmongolocal._cappedInsert(doc._id, options.emitCascade);\n\n\t\tif(options.emit)\n\t\t\tmongolocal.emit('insert', doc, options);\n\n\t\tcallback(null);\n\t}\n};\n\nMongoLocal.prototype._cloneObject = function(object) {\n\treturn JSON.parse(JSON.stringify(object));\n};\n\nMongoLocal.prototype.update = function() {\n\t// [query,] updateOperations, [options,] [callback,]\n\t// https://docs.mongodb.com/v3.0/reference/method/db.collection.update/\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'query', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object' || typeof(arg) == 'string'; }, default: {}},\n\t\t\t{name: 'updateOperations', level: 0, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }},\n\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'function'; }}\n\t\t]\n\t);\n\n\tvar mongolocal = this;\n\n\tvar options = Utils.objectMerge({emit: true, multi: false, upsert: false}, parsedArgs.options);\n\toptions = Utils.objectMerge({emitCascade: options.emit}, options); // add emitCascade option\n\n\tvar query = mongolocal._validateQuery(parsedArgs.query);\n\tvar updateOperations = this._validateUpdate(parsedArgs.updateOperations);\n\n\tif(!options.multi)\n\t\tvar BreakException = {};\n\n\ttry {\n\t\tvar numUpdated = 0;\n\n\t\tvar findCursor = this.find(parsedArgs.query);\n\t\tfindCursor._forEachDocIndex(function(doc, index) {\n\t\t\tnumUpdated++;\n\n\t\t\tif(options.emit)\n\t\t\t\tvar unmodifiedDoc = mongolocal._cloneObject(doc);\n\n\t\t\tif(typeof mongolocal.config.update == 'function') {// override is set (for Polymer)\n\t\t\t\tvar modifiedDoc = mongolocal._updateDoc(doc, updateOperations, true);\n\t\t\t\tmongolocal.config.update(index, unmodifiedDoc, modifiedDoc);\n\t\t\t}\n\t\t\telse\n\t\t\t\tvar modifiedDoc = mongolocal._updateDoc(doc, updateOperations, false);\n\n\t\t\tif(options.emit)\n\t\t\t\tmongolocal.emit('update', unmodifiedDoc, modifiedDoc, updateOperations, options);\n\n\t\t\tif(!options.multi)\n\t\t\t\tthrow BreakException;\n\t\t});\n\n\t\tif(!numUpdated && options.upsert) { // Upsert\n\t\t\t// https://docs.mongodb.com/manual/reference/method/db.collection.update/#upsert-option\n\t\t\tvar insertDoc = {};\n\n\t\t\tif(typeof query._id != 'undefined')\n\t\t\t\tinsertDoc._id = query._id;\n\t\t\tFauxMongo.update(insertDoc, updateOperations);\n\n\t\t\tvar insertOptions = mongolocal._cloneObject(options);\n\t\t\tinsertOptions.emit = insertOptions.emitCascade;\n\t\t\tmongolocal.insert(insertDoc, insertOptions, parsedArgs.callback);\n\t\t}\n\t}\n\tcatch(exception) {\n\t\tif (exception !== BreakException)\n\t\t\tthrow exception;\n\t}\n\n\t// TODO return WriteResult: https://docs.mongodb.com/v3.0/reference/method/db.collection.update/#writeresults-update\n\tif(typeof parsedArgs.callback == 'function' && !(!numUpdated && options.upsert))\n\t\tparsedArgs.callback(null, true);\n};\n\nMongoLocal.prototype.remove = function() {\n\t// [query,] [options]\n\t// https://docs.mongodb.com/v3.0/reference/method/db.collection.remove/\n\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'query', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object' || typeof(arg) == 'string'; }, default: {}},\n\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'function'; }}\n\t\t]\n\t);\n\n\tvar options = Utils.objectMerge({emit: true, justOne: false}, parsedArgs.options);\n\toptions = Utils.objectMerge({emitCascade: options.emit}, options); // add emitCascade option\n\n\tvar mongolocal = this;\n\n\tvar query = mongolocal._validateQuery(parsedArgs.query);\n\tmongolocal.find(query)._forEachDocIndex(function(doc, index) {\n\t\tif(options.emit)\n\t\t\tvar docClone = mongolocal._cloneObject(doc);\n\n\t\tvar docId = doc._id;\n\t\tif(typeof mongolocal.config.remove == 'function')\n\t\t\tmongolocal.config.remove(index);\n\t\telse if(Array.isArray(mongolocal.collection))\n\t\t\tmongolocal.collection.splice(index, 1);\n\t\telse\n\t\t\tdelete mongolocal.collection[index];\n\n\t\tmongolocal._cappedRemove(docId);\n\n\t\tif(options.emit)\n\t\t\tmongolocal.emit('remove', docClone, options);\n\t});\n\n\tif(typeof parsedArgs.callback == 'function')\n\t\tparsedArgs.callback(null, true);\n};\n\nMongoLocal.prototype.isCapped = function() {\n\treturn typeof this.config.max == 'number';\n};\n\n/**\n * Validate and fix update operations\n * @param update\n * @returns {{}}\n * @private\n */\nMongoLocal.prototype._validateUpdate = function(update) {\n\tvar validated = {};\n\n\tUtils.objectForEach(update, function(attributeVal, attributeKey) {\n\t\tif(attributeKey == '$set') // merge set with attributes already set\n\t\t\tvalidated['$set'] = Utils.objectMerge(validated['$set'], attributeVal);\n\t\telse if(attributeKey.charAt(0) == '$') // any other operation (pass through)\n\t\t\tvalidated[attributeKey] = attributeVal;\n\t\telse { // regular attribute (non-operation)\n\t\t\tif(typeof validated['$set'] != 'object' || validated['$set'] == null)\n\t\t\t\tvalidated['$set'] = {};\n\t\t\tvalidated['$set'][attributeKey] = attributeVal;\n\t\t}\n\t});\n\n\treturn validated;\n};\n\nMongoLocal.prototype._validateQuery = function(query) {\n\tif(typeof query != 'object')\n\t\treturn {_id: query};\n\telse\n\t\treturn query;\n};\n\nMongoLocal.prototype._updateDoc = function(doc, updateOperations, clone) {\n\tif(typeof clone == 'boolean' && clone) // make a copy instead of updating in place\n\t\tdoc = this._cloneObject(doc);\n\tvar updateMongoOperators = {};\n\tUtils.objectForEach(updateOperations, function(operationValue, operationKey) {\n\t\tif(operationKey.charAt(0) == '$') // operation\n\t\t\tupdateMongoOperators[operationKey] = operationValue;\n\t\telse\n\t\t\tdoc[operationKey] = operationValue;\n\t});\n\n\t// TODO add options here\n\tFauxMongo.update(doc, updateMongoOperators);\n\n\treturn doc;\n};\n\nMongoLocal.prototype._docFilter = function(doc, query) {\n\treturn FauxMongo.matchQuery(doc, query);\n};\n\nMongoLocal.prototype._cappedInsert = function(docId, emit) {\n\tif(typeof emit != 'boolean')\n\t\temit = true;\n\n\t// Maintain list when collection is capped or cannot asynchronously iterate over docs\n\tif(this.isCapped() || !Array.isArray(this.collection))\n\t\tthis.docsLinkedList.enqueue(docId, docId); // add to cap index\n\n\tif(this.isCapped()) {\n\t\twhile(this.docsLinkedList.length > this.config.max) {\n\t\t\tvar _id = this.docsLinkedList.head.data;\n\t\t\tthis.remove(_id, {emit: emit});\n\t\t}\n\t}\n};\n\nMongoLocal.prototype._cappedRemove = function(docId) {\n\ttry {\n\t\tthis.docsLinkedList.remove(docId);\n\t}\n\tcatch(error) {\n\t\tif(error.message != 'undefined_item')\n\t\t\tthrow error;\n\t}\n};\n\nmodule.exports = function(config) {\n\treturn new MongoLocal(config);\n};","// http://mongodb.github.io/node-mongodb-native/2.2/api/Cursor.html\n\nfunction MongoLocalCursor(peekResult, nextResult, rewindResults) {\n\tthis._peekResult = peekResult;\n\tthis._nextResult = nextResult;\n\tthis._rewindResults = rewindResults;\n}\n\nMongoLocalCursor.prototype.next = function(callback) {\n\tthis._nextDocIndex(function(error, doc, index) {\n\t\tcallback(error, doc);\n\t});\n};\n\nMongoLocalCursor.prototype.rewind = function(callback) {\n\t// cursor.rewind() resets the internal pointer in the cursor to the beginning\n\tthis._rewindResults();\n};\n\nMongoLocalCursor.prototype.forEach = function(callback) {\n\tthis._forEachDocIndex(function(doc) {\n\t\tcallback(doc);\n\t});\n};\n\nMongoLocalCursor.prototype.toArray = function(callback) {\n\tvar cursor = this;\n\tvar results = [];\n\tgetNext();\n\n\tfunction getNext() {\n\t\tcursor.next(function(error, doc) {\n\t\t\tif(error)\n\t\t\t\tcallback(error, null);\n\t\t\telse if(doc == null)\n\t\t\t\tcallback(error, results);\n\t\t\telse {\n\t\t\t\tresults.push(doc);\n\t\t\t\tgetNext();\n\t\t\t}\n\t\t});\n\t}\n};\n\nMongoLocalCursor.prototype._forEachDocIndex = function(callback) {\n\tvar cursor = this;\n\tsendNext();\n\n\tfunction sendNext() {\n\t\tcursor._nextDocIndex(function(error, doc, index) {\n\t\t\tif(!error && index !== null) {\n\t\t\t\tcallback(doc, index);\n\t\t\t\tsendNext();\n\t\t\t}\n\t\t});\n\t}\n};\n\nMongoLocalCursor.prototype._nextDocIndex = function(callback) {\n\t// https://mongodb.github.io/node-mongodb-native/markdown-docs/queries.html#nextobject\n\t// cursor.nextObject(function(err, doc){}) retrieves the next record from database. If doc is null, then there weren’t any more records.\n\tvar result = this._nextResult();\n\tif(result == null)\n\t\tcallback(null, null, null);\n\telse\n\t\tcallback(null, result.doc, result.index);\n};\n\n\nmodule.exports = function(peekResult, nextResult, rewindResults) {\n\treturn new MongoLocalCursor(peekResult, nextResult, rewindResults);\n};","// Utils module 1.0.6\nvar Utils = {};\n\nUtils.objectFilterProperties = function(object, properties) {\n\t// get specified properties of an object into a new object\n\tvar filtered = {};\n\tproperties.forEach(function(property) {\n\t\tfiltered[property] = object[property];\n\t});\n\treturn filtered;\n};\n\nUtils.objectContainsObject = function(containerObject, object) {\n\t// return true if all the attributes of object are in containerObject and the values of all those attributes match (using ==)\n\tfor(var property in object) { // pull keys before looping through?\n\t\tif(object.hasOwnProperty(property) && (!containerObject.hasOwnProperty(property) || containerObject[property] != object[property]))\n\t\t\treturn false;\n\t}\n\treturn true;\n};\n\nUtils.objectFilter = function(object, filter) {\n\t// filter object properties (children) using filter function\n\t// similar to array filter function\n\tvar result = {};\n\tthis.objectForEach(object, function(child, property, parent) {\n\t\tif(filter(child, property, parent))\n\t\t\tresult[property] = child;\n\t});\n\treturn result;\n};\n\n\nUtils.objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nUtils.objectGet = function(object, keys) {\n\tvar self = this;\n\tif(keys.length == 0)\n\t\treturn object;\n\telse if(typeof object === \"object\") {\n\t\tif((typeof keys[0] === \"string\" || typeof keys[0] === \"number\") && object !== null && object.hasOwnProperty(keys[0]))\n\t\t\treturn this.objectGet(object[keys[0]], keys.slice(1));\n\t\telse if(keys[0] === null) { // get all\n\t\t\tif(Array.isArray(object)) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof RegExp) { // match keys to regexp\n\t\t\tvar results = {};\n\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\tif(key.match(keys[0]))\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t});\n\t\t\treturn results;\n\t\t}\n\t\telse if(typeof keys[0] === \"function\") { // apply a filtering function\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(value, index, parent) {\n\t\t\t\t\tif(keys[0](value, index, parent)) // filter function\n\t\t\t\t\t\tresults[index] = self.objectGet(value, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilter(object, keys[0]), function(result, key) {\n\t\t\t\t\tresults[key] = self.objectGet(result, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof Array) { // all members with keys in array\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tkeys[0].forEach(function(value, index) {\n\t\t\t\t\tresults[index] = object[index];\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilterProperties(object, keys[0]), function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t}\n\telse\n\t\treturn;\n};\n\nUtils.objectSet = function(object, keys, value) {\n\tif(keys.length == 1) {\n\t\tobject[keys[0]] = value;\n\t\treturn true;\n\t}\n\telse {\n\t\tif(typeof(object[keys[0]]) === \"undefined\")\n\t\t\tobject[keys[0]] = {}; // set empty object so we can descend into it\n\t\treturn this._objectSet(object[keys[0]], keys.slice(1), value);\n\t}\n};\n\nUtils.objectIsset = function(object, keys) {\n\tif(keys.length == 1)\n\t\treturn (typeof(object[keys[0]]) !== \"undefined\");\n\telse if(typeof(object[keys[0]]) === \"undefined\") // current level doesn't exist\n\t\treturn false;\n\telse\n\t\treturn this.objectIsset(object[keys[0]], keys.slice(1));\n};\n\nUtils.objectMerge = function() {\n\tvar merged = {};\n\tthis.objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\nUtils.uniqueId = function() {\n\tfunction s4() {\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\n\t\t\t.toString(16)\n\t\t\t.substring(1);\n\t}\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n\t\ts4() + '-' + s4() + s4() + s4();\n};\n\nUtils.parseArgs = function(argsPassed, argsConfig) {\n\tvar matched = {};\n\n\tfunction toLevels(argsConfig, level) {\n\t\tif(typeof level !== 'number')\n\t\t\tlevel = 0;\n\n\t\tvar levelsArr = [];\n\n\t\targsConfig.forEach(function(argConfig) {\n\t\t\tif(Array.isArray(argConfig))\n\t\t\t\tlevelsArr = levelsArr.concat(toLevels(argConfig, level + 1));\n\t\t\telse {\n\t\t\t\targConfig.level = level;\n\t\t\t\tlevelsArr.push(argConfig);\n\t\t\t}\n\t\t});\n\n\t\treturn levelsArr;\n\t}\n\n\tfunction validArg(argConfig, arg) {\n\t\treturn typeof argConfig.validate != 'function' || argConfig.validate(arg)\n\t}\n\n\tfunction requiredLeftEnough(argsConfig, minIndex) {\n\t\tfor(var index = minIndex; index < argsConfig.length; index++) {\n\t\t\tif(typeof(argsConfig[index]) === 'undefined' || !argsConfig[index].required)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar argConfigMin = 0;\n\n\tif(!Array.isArray(argsPassed))\n\t\targsPassed = Array.prototype.slice.call(argsPassed);\n\n\targsPassed.forEach(function(arg, index) {\n\t\tfor(var ctr = argConfigMin; ctr < argsConfig.length; ctr++) {\n\t\t\tif(argsConfig[ctr].required) {\n\t\t\t\tif(validArg(argsConfig[ctr], arg)) {\n\t\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\t\targConfigMin++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthrow \"missing_required\";\n\t\t\t}\n\t\t\telse if((!argsConfig[ctr].required && (requiredLeftEnough(argsConfig, ctr) || (argsConfig[ctr].level > argsConfig[ctr - 1].level && argsConfig[ctr - 1].matched))) && validArg(argsConfig[ctr], arg)) {\n\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\targConfigMin++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targsConfig[ctr].matched = false;\n\t\t\t\targConfigMin++;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Add default options, if set\n\targsConfig.forEach(function(argConfig) {\n\t\tif(typeof matched[argConfig.name] == 'undefined' && typeof argConfig.default != 'undefined')\n\t\t\tmatched[argConfig.name] = argConfig.default;\n\t});\n\n\treturn matched;\n};\n\n// queueFunctions [, queueFunctionArgs], queueCompleteCallback [, queueIncompleteCallback] [, options]\nUtils.callbackQueue = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'queueFunctions', level: 0, validate: function(arg, allArgs) { return Array.isArray(arg); }},\n\t\t\t{name: 'queueFunctionArgs', level: 1, validate: function(arg, allArgs) { return Array.isArray(arg); }},\n\t\t\t{name: 'queueCompleteCallback', level: 0,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }},\n\t\t\t{name: 'queueNoMatchCallback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }},\n\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) === 'object'; }, default: {}}\n\t\t]\n\t);\n\n\tparsedArgs.options = Utils.objectMerge({expand: false}, parsedArgs.options);\n\n\tvar queueCompleted = false;\n\tfunction queueCompleteCallbackSafe() {\n\t\tif(!queueCompleted) {\n\t\t\tqueueCompleted = true;\n\t\t\tparsedArgs.queueCompleteCallback.apply(this, Array.prototype.slice.call(arguments));\n\t\t}\n\t}\n\n\tvar index = -1;\n\tfunction callbackQueueNext() {\n\t\tindex++;\n\t\tif(typeof parsedArgs.queueFunctions[index] === 'function') {\n\t\t\tif(Array.isArray(parsedArgs.queueFunctionArgs) && !parsedArgs.options.expand) // pass arguments to function as array// TODO add expand option\n\t\t\t\tparsedArgs.queueFunctions[index](parsedArgs.queueFunctionArgs, callbackQueueNext, queueCompleteCallbackSafe);\n\t\t\telse if(Array.isArray(parsedArgs.queueFunctionArgs) && parsedArgs.options.expand) // pass arguments to function beforre done() and next()\n\t\t\t\tparsedArgs.queueFunctions[index].apply(this, parsedArgs.queueFunctionArgs.concat([callbackQueueNext, queueCompleteCallbackSafe]));\n\t\t\telse // no arguments to pass\n\t\t\t\tparsedArgs.queueFunctions[index](callbackQueueNext, queueCompleteCallbackSafe);\n\t\t}\n\t\telse if(typeof parsedArgs.queueNoMatchCallback == 'function' && !queueCompleted)\n\t\t\tparsedArgs.queueNoMatchCallback();\n\t}\n\n\tcallbackQueueNext();\n};\n\nmodule.exports = Utils;","var Rpc = require('agnostic-rpc');\nvar EventEmitter = require('wolfy87-eventemitter');\nvar AgnosticRouter = require('agnostic-router');\nvar NodeNetwork = require('node-network');\nvar Utils = require('./Utils.js');\n\nfunction NodeNetworkRpc(config) {\n\tvar rpc = this;\n\trpc.connected = false;\n\n\t// TODO seperate configs\n\trpc.network = NodeNetwork(config);\n\trpc.router = AgnosticRouter();\n\trpc._rpc = Rpc();\n\n\trpc.network.on('message', function(message) {\n\t\trpc._rpcMessage(message);\n\t});\n\n\trpc.network.on('address', function(address) {\n\t\trpc.address = address;\n\t\tif(typeof address == 'undefined') {\n\t\t\trpc.connected = false;\n\t\t\trpc.emit('disconnect');\n\t\t}\n\t\telse {\n\t\t\trpc.connected = true;\n\t\t\trpc.emit('connect');\n\t\t}\n\t});\n\n\t['insert', 'remove'].forEach(function(eventType) {\n\t\trpc.network.on(eventType, function() {\n\t\t\trpc.emit(eventType, Array.prototype.slice.call(arguments));\n\t\t});\n\t});\n\n\tvar configDefaults = {\n\n\t};\n\n\tthis.config = Utils.objectMerge(configDefaults, config);\n}\n\nNodeNetworkRpc.prototype.__proto__ = EventEmitter.prototype;\n\nNodeNetworkRpc.prototype.request = function() {\n\t// TODO queue if no address set?\n\n\tif(typeof this.address == 'undefined')\n\t\tthrow new Error('NO ADDRESS SET');\n\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'destAddresses', level: 1,  validate: function(arg, allArgs) { return ((typeof arg == 'string' && arg[0] != '/') || Array.isArray(arg)); }},\n\t\t\t{name: 'path', level: 0,  validate: function(arg, allArgs) { return typeof arg == 'string' && arg[0] == '/'; }},\n\t\t\t{name: 'query', level: 1,  validate: function(arg, allArgs) { return typeof arg == 'object'; }, default: {}},\n\t\t\t{name: 'options', level: 2,  validate: function(arg, allArgs) { return typeof arg == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\t// Build rpc request message object and set the return address\n\tvar rpcRequestQuery = {path: parsedArgs.path, query: parsedArgs.query, srcAddress: this.address};\n\n\tif(typeof parsedArgs.callback == 'function') { // Request expects a response\n\t\tvar rpcResponseHandler = function(rpcError, rpcResponse) {\n\t\t\tif(typeof parsedArgs.callback == 'function') {\n\t\t\t\tif(rpcError) // Error in RPC request\n\t\t\t\t\tparsedArgs.callback(rpcError);\n\t\t\t\telse if(typeof rpcResponse != 'object') // Response not of the right type\n\t\t\t\t\tparsedArgs.callback('response_not_object');\n\t\t\t\telse // Pass error and response to callback\n\t\t\t\t\tparsedArgs.callback(rpcResponse.error, rpcResponse.response);\n\t\t\t}\n\t\t}\n\t}\n\n\telse // No response expected\n\t\tvar rpcResponseHandler = undefined;\n\n\tvar rpcRequestMessage = this._rpc.request(rpcRequestQuery, parsedArgs.options, rpcResponseHandler);\n\n\t// Add destination\n\tif(typeof parsedArgs.destAddresses != 'string') {} // TODO add default destination\n\tvar destAddresses = parsedArgs.destAddresses;\n\n\tthis.network.send(destAddresses, rpcRequestMessage);\n};\n\nNodeNetworkRpc.prototype._rpcMessage = function(rpcMessage) {\n\tvar rpc = this;\n\tif(this._rpc.messageIsResponse(rpcMessage)) // incoming response\n\t\tthis._rpc.handleResponse(rpcMessage);\n\telse { // incoming request\n\t\tvar destAddress = undefined;\n\n\t\tvar requestHandler = function(requestMessage, respond) {\n\n\t\t\tdestAddress = requestMessage.srcAddress; // return responses to src\n\n\t\t\t// TODO get response address from message, use DNS addresses\n\n\t\t\tvar packResponse = function(error, response) {\n\t\t\t\trespond({\n\t\t\t\t\terror: error,\n\t\t\t\t\tresponse: response\n\t\t\t\t});\n\t\t\t};\n\n\t\t\tvar noRouteHandler = function() {\n\t\t\t\tpackResponse('not_found', null);\n\t\t\t};\n\n\t\t\t// Send request into the URL router\n\t\t\trpc.router.route('request', requestMessage.path, {query: requestMessage.query}, packResponse, noRouteHandler);\n\t\t};\n\n\t\tvar responseEmitter = function(responseMessage) {\n\t\t\t// Respond to the src address\n\t\t\t//console.log(rpcMessage);\n\t\t\trpc.network.send(destAddress, responseMessage);\n\t\t};\n\n\t\tthis._rpc.handleRequest(rpcMessage, requestHandler, responseEmitter);\n\t}\n};\n\nNodeNetworkRpc.prototype.addConnection = function(connection) {\n\tthis.network.addConnection.apply(this.network, Array.prototype.slice.call(arguments));\n};\n\nmodule.exports = function(config) {\n\treturn new NodeNetworkRpc(config);\n};\n","function AddressManager(baseAddress) {\n\tif(Array.isArray(baseAddress))\n\t\tthis._baseAddress = baseAddress;\n\telse\n\t\tthrow new Error('base_address_not_set');\n\tthis._max = '0';\n\tthis._stringBase = 36;\n}\n\n/**\n * Allocate an address to a child\n * @returns {string}\n */\nAddressManager.prototype.allocate = function() {\n\tthis._max = this._incrementString(this._max, this._stringBase, 1);\n\treturn this._baseAddress.concat(this._max);\n\t// calculate max addresses under current scheme\n\t// getNext address (assign sequentially)\n};\n\n/**\n * Test whether addresses are equal\n * Default address2 is Address Manager's base address\n * @param address1\n * @param [address2]\n */\nAddressManager.prototype.addressIsEqual = function(address1, address2) {\n\tif(!Array.isArray(address2))\n\t\taddress2 = this._baseAddress;\n\n\tif(address1.length == address2.length) {\n\t\tvar index;\n\t\tfor (index = 0; index < address2.length; index++) {\n\t\t\tif (address1[index] != address2[index])\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true; // all address1 parts match, and address1 is same length as address2\n\t}\n\telse // address2 is different length from address1\n\t\treturn false;\n};\n\n/**\n * Test whether an address is a child of another address\n * Default parent address is Address Manager's base address\n * @param childAddress\n * @param [parentAddress]\n * @returns {boolean}\n */\nAddressManager.prototype.addressIsChild = function(childAddress, parentAddress) {\n\tif(!Array.isArray(parentAddress))\n\t\tparentAddress = this._baseAddress;\n\n\tif(childAddress.length > parentAddress.length) {\n\t\tvar index;\n\t\tfor (index = 0; index < parentAddress.length; index++) {\n\t\t\tif (childAddress[index] != parentAddress[index])\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true; // all child parts match, and child is longer than parent\n\t}\n\telse // Child is shorter than parent\n\t\treturn false;\n};\n\n/**\n * Test whether an address is a parent of another address\n * Default child address is Address Manager's base address\n * @param parentAddress\n * @param [childAddress]\n * @returns {boolean}\n */\nAddressManager.prototype.addressIsParent = function(parentAddress, childAddress) {\n\tif(!Array.isArray(childAddress))\n\t\tchildAddress = this._baseAddress;\n\n\treturn this.addressIsChild(childAddress, parentAddress);\n};\n\n/**\n * Increment stringToIncrement with the given base by increment\n * @param stringToIncrement\n * @param stringBase\n * @param increment\n * @returns {string}\n * @private\n */\nAddressManager.prototype._incrementString = function(stringToIncrement, stringBase, increment) {\n\treturn (parseInt(stringToIncrement, stringBase) + increment).toString(stringBase);\n};\n\nmodule.exports = function(baseAddress) {\n\treturn new AddressManager(baseAddress);\n};","var Rpc = require('agnostic-rpc');\nvar EventEmitter = require('wolfy87-eventemitter');\nvar RouteTable = require('./RouteTable');\nvar AddressManager = require('./AddressManager');\nvar Utils = require('./Utils');\n\nfunction NodeRouter(config) {\n\tif(typeof config != 'object')\n\t\tconfig = {};\n\n\tvar router = this;\n\n\trouter.config = config;\n\n\trouter._routeTable = RouteTable();\n\n\trouter._routeTable.on('insert', function(insertOperation) {\n\t\tvar emitOperation = {address: insertOperation.address.join('-'), cost: insertOperation.cost};\n\t\trouter.emit('insert', emitOperation);\n\t});\n\n\trouter._routeTable.on('remove', function(addressParts) {\n\t\trouter.emit('remove', addressParts.join('-'));\n\t});\n\n\trouter._connections = {};\n\trouter._connectionKeyMax = -1; // increase every time a connection is added\n\n\trouter._rpc = Rpc();\n\n\t// Delay setting address to allow binding to address, addressParts events\n\tprocess.nextTick(function () {\n\t\trouter.setAddress(router.config.address); // will set even if address is undefined\n\t});\n\n\trouter._actions = {\n\t\tping: function(query, connection, callback) {\n\t\t\tcallback(null, true);\n\t\t},\n\t\troute: function(packet, connection, callback) {\n\t\t\trouter._route(packet, callback);\n\t\t},\n\t\taddressrevoke: function(address, connection, callback) {\n\t\t\tif(typeof router._addressManager != 'undefined' && router._addressManager.addressIsEqual(address)) // address to unset is our address\n\t\t\t\trouter._setAddressParts();\n\t\t},\n\t\taddressrequest: function(query, connection, callback) {\n\t\t\tif(typeof router._addressManager == 'object') {\n\t\t\t\tvar childAddress = router._addressManager.allocate();\n\t\t\t\tcallback(null, childAddress);\n\t\t\t}\n\t\t\telse\n\t\t\t\tcallback('no_address', null);\n\t\t},\n\t\troutesupdate: function(routeOperations, connection) {\n\t\t\trouter._routesApplyOperations(routeOperations, connection);\n\n\t\t\t// Check if we have address set\n\t\t\t// If not, and if routeOperations.insert contains a path with 0 cost, request an address\n\t\t\tif(typeof router.address == 'undefined') {\n\t\t\t\t// Filter for any routes whose cost is 0 (advertising themselves)\n\t\t\t\tvar insertFilter = function(insertOperation) {\n\t\t\t\t\treturn insertOperation.cost == 0;\n\t\t\t\t};\n\n\t\t\t\tvar routeOperationsFiltered = router._routeOperationsFilter(routeOperations, {\n\t\t\t\t\tinsert: insertFilter\n\t\t\t\t});\n\n\t\t\t\tif(Array.isArray(routeOperationsFiltered.insert) && routeOperationsFiltered.insert.length > 0) { // advertising a route with 0 cost (itself)\n\t\t\t\t\trouter.rpcRequest(connection, 'addressrequest', function (error, response) {\n\t\t\t\t\t\tif(error)\n\t\t\t\t\t\t\tconsole.error(\"ADDREQ-FAILED\", error);\n\t\t\t\t\t\telse\n\t\t\t\t\t\t\trouter._setAddressParts(response, connection);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n}\n\nNodeRouter.prototype.__proto__ = EventEmitter.prototype;\n\n/**\n *\n * @param destAddressJoined\n * @param message\n * @param [options]\n * @param [callback]\n */\nNodeRouter.prototype.send = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'destAddressesJoined', level: 0,  validate: function(arg, allArgs) { return typeof arg == 'string' || Array.isArray(arg); }},\n\t\t\t{name: 'message', level: 0},\n\t\t\t{name: 'options', level: 1,  validate: function(arg, allArgs) { return typeof arg == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\t// Convert to array if it is not already\n\tvar destAddressesJoined = Array.isArray(parsedArgs.destAddressesJoined) ? parsedArgs.destAddressesJoined : [parsedArgs.destAddressesJoined];\n\n\tvar destAddresses = [];\n\tdestAddressesJoined.forEach(function(destAddressJoined) {\n\t\tdestAddresses.push(destAddressJoined.split('-'));\n\t});\n\n\t// TODO add options handling\n\tthis._route({\n\t\tmessage: parsedArgs.message,\n\t\tdest: destAddresses\n\t}, parsedArgs.callback);\n};\n\n/**\n *\n * @param addressJoined\n * @returns {boolean}\n */\nNodeRouter.prototype.setAddress = function(addressJoined, addressConnectionKey) {\n\tif(typeof addressJoined == 'string') { // valid address\n\t\tvar addressParts = addressJoined.split('-');\n\t\treturn this._setAddressParts(addressParts, addressConnectionKey);\n\t}\n\telse\n\t\treturn false;\n};\n\nNodeRouter.prototype._broadcastRouteOperations = function(routeOperations) {\n\tvar router = this;\n\tUtils.objectForEach(router._connections, function(connectionConfig, connectionKey) {\n\t\t// TODO filter for each connection\n\t\trouter.rpcRequest(connectionKey, 'routesupdate', routeOperations);\n\t});\n};\n\nNodeRouter.prototype._routesApplyOperations = function(routeOperations, connectionKey) {\n\tvar router = this;\n\n\t// TODO remove clone\n\t// Clone to avoid cases where links pass objects without cloning\n\tvar routeOperationsClone = JSON.parse(JSON.stringify(routeOperations));\n\n\t// Remove own address\n\tvar insertFilter = function(insertOperation) {\n\t\tif(typeof router._addressManager == 'undefined')\n\t\t\treturn true;\n\t\telse\n\t\t\treturn !router._addressManager.addressIsEqual(insertOperation.address);\n\t};\n\n\tvar routeOperationsFiltered = router._routeOperationsFilter(routeOperationsClone, {\n\t\tinsert: insertFilter\n\t});\n\n\t// Add cost of hop from advertising router to local router\n\tif(Array.isArray(routeOperationsFiltered.insert)) {\n\t\trouteOperationsFiltered.insert.forEach(function(insertOperation) {\n\t\t\tinsertOperation.cost = insertOperation.cost + 1;\n\t\t});\n\t}\n\n\t// Apply the operations to the routing table\n\tvar localOperations = router._routeTable.modifyRoutes(routeOperationsFiltered, connectionKey);\n\n\tvar insertFilter = function(routeOperation) {\n\t\tif(typeof router._addressManager == 'undefined') // no address for local router\n\t\t\treturn false;\n\t\telse\n\t\t\treturn !router._addressManager.addressIsChild(routeOperation.address); // only include if route is not child of router\n\t};\n\n\t// Remove children\n\tlocalOperationsBroadcast = router._routeOperationsFilter(localOperations, {\n\t\tinsert: insertFilter\n\t});\n\n\tif(Object.keys(localOperationsBroadcast).length) {\n\t\trouter._broadcastRouteOperations(localOperationsBroadcast);\n\t}\n};\n\nNodeRouter.prototype._setAddressParts = function(address, addressConnectionKey) {\n\tvar router = this;\n\tvar routerOperations = {};\n\n\t// Address was previously set\n\t// Revoke addresses of children\n\tif(typeof router.address != 'undefined') {\n\t\trouterOperations.remove = [router.address];\n\n\t\tvar childRoutes = router._routeTable.childRoutes(this.address);\n\n\t\tif(typeof childRoutes == 'object') {\n\t\t\tUtils.objectForEach(childRoutes, function(routeNode, routeKey) {\n\t\t\t\t// Delete from table (no need to broadcast removal because we don't advertise children)\n\t\t\t\t// TODO cleanup so that we don't need to use concat\n\t\t\t\tvar childAddress = router.address.concat(routeKey);\n\t\t\t\trouter._routeTable.removeRoute(childAddress, routeNode.connectionKey);\n\t\t\t\trouter.rpcRequest(routeNode.connectionKey, 'addressrevoke', childAddress); // revoke addresses from children\n\t\t\t});\n\t\t}\n\t}\n\n\trouter.address = address;\n\trouter.addressConnectionKey = addressConnectionKey; // set the connection that provided the address\n\trouter._addressManager = undefined; // unset the address manager\n\n\tif(typeof router.address != 'undefined') {\n\t\trouter._addressManager = AddressManager(router.address);\n\t\trouterOperations.insert = [{address: router.address, cost: 0}];\n\t}\n\n\tif(Object.keys(routerOperations).length)\n\t\trouter._broadcastRouteOperations(routerOperations);\n\n\trouter.emit('addressParts', router.address);\n\n\tvar addressJoined = Array.isArray(this.address) ? router.address.join('-') : undefined;\n\trouter.emit('address', addressJoined);\n};\n\n/**\n * Turn the routing table into a series of operations for immediate connections\n * Adds its own address as well\n * @param filter\n */\nNodeRouter.prototype.connectionRouteTableOperations = function(connectionKey) {\n\tvar router = this;\n\tvar filter = function(nodeData, routePath) {\n\t\t// Filter function\n\t\tif(nodeData.connection == connectionKey) // Don't include routes whose first stop is through the connection\n\t\t\treturn false;\n\n\t\tif(typeof router._addressManager == 'object' && router._addressManager.addressIsChild(routePath)) // own address is set, and path is a child of path\n\t\t\treturn false;\n\n\t\treturn true;\n\t};\n\n\tvar routerTableOps = router._routeTable.toRouteOperations(filter);\n\n\tif(typeof router.address != 'undefined') { // Own address is set, add it\n\t\tif (!Array.isArray(routerTableOps.insert)) // create insert ops, if they don't exist\n\t\t\trouterTableOps.insert = [];\n\t\trouterTableOps.insert.push({address: router.address, cost: 0});\n\t}\n\n\t//console.log(\"RTOPS\", JSON.stringify(routerTableOps));\n\n\treturn routerTableOps;\n\n};\n\n/**\n * Add a connection between routers\n * @param connection\n */\nNodeRouter.prototype.addConnection = function(connection, connectionOptions) {\n\t// TODO add connection options\n\t// TODO add option of reconnect\n\n\tvar router = this;\n\n\trouter._connectionKeyMax++;\n\tvar connectionKey = router._connectionKeyMax;\n\n\tif(typeof connectionOptions != 'object' || connectionOptions == null)\n\t\tconnectionOptions = {};\n\n\trouter._connections[connectionKey] = {connection: connection, options: connectionOptions};\n\n\tconnection.on('data', function(data) {\n\t\ttry {\n\t\t\trouter._rpcMessage(connectionKey, data);\n\t\t}\n\t\tcatch(error) {\n\t\t\tconsole.error(error);\n\t\t}\n\t});\n\n\tconnection.on('disconnect', function() {\n\t\tif(router.addressConnectionKey == connectionKey) // Address was provided by this connection\n\t\t\trouter._setAddressParts();\n\n\t\tvar localOperations = router._routeTable.removeConnectionRoutes(connectionKey);\n\n\t\trouter._broadcastRouteOperations(localOperations);\n\n\t\tdelete router._connections[connectionKey];\n\t});\n\n\tconnection.on('connect', function() {\n\t\t// TODO eliminate duplicates\n\t\trouter._connections[connectionKey] = {connection: connection, options: connectionOptions};\n\t\tsendRoutingTable();\n\t});\n\n\tsendRoutingTable();\n\n\tfunction sendRoutingTable() {\n\t\tvar routingTableOperations = router.connectionRouteTableOperations(connection);\n\t\trouter.rpcRequest(connectionKey, 'routesupdate', routingTableOperations);\n\t}\n};\n\n/**\n * TODO add to route updates\n * @param routeOperations\n * @param filters\n * @returns {{}}\n * @private\n */\nNodeRouter.prototype._routeOperationsFilter = function(routeOperations, filters) {\n\tvar routeOperationsFiltered = {};\n\n\tUtils.objectForEach(routeOperations, function(routeOperationsAction, routeOperationsActionKey) {\n\t\tif(Array.isArray(routeOperationsAction)) {\n\t\t\tif(typeof filters[routeOperationsActionKey] == 'function') { // filter exists\n\t\t\t\tvar filtered = routeOperationsAction.filter(filters[routeOperationsActionKey]); // apply the filter\n\t\t\t\tif(Array.isArray(filtered) && filtered.length > 0) // check if result array has any elements\n\t\t\t\t\trouteOperationsFiltered[routeOperationsActionKey] = filtered;\n\t\t\t}\n\t\t\telse // no filter, add all\n\t\t\t\trouteOperationsFiltered[routeOperationsActionKey] = routeOperationsAction;\n\t\t}\n\t});\n\n\treturn routeOperationsFiltered;\n};\n\n/**\n * Send an RPC request to all connections\n * TODO add parameters to JSDOC\n */\nNodeRouter.prototype.rpcBroadcast = function() {\n\tvar router = this;\n\tvar argsPassed = Array.prototype.slice.call(arguments);\n\tUtils.objectForEach(router._connections, function(connectionConfig, connectionKey) {\n\t\trouter.rpcRequest.apply(router, [connectionKey].concat(argsPassed)); // add connectionKey as first arg\n\t});\n};\n\n/**\n * Send an RPC request over a single connection\n * TODO add parameters to JSDOC\n */\nNodeRouter.prototype.rpcRequest = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'connectionKey', level: 0},\n\t\t\t{name: 'action', level: 0,  validate: function(arg, allArgs) { return typeof arg == 'string'; }},\n\t\t\t{name: 'query', level: 1,  validate: function(arg, allArgs) { return typeof arg == 'object'; }, default: {}},\n\t\t\t{name: 'callback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t]\n\t);\n\n\tvar requestMessage = this._rpc.request({\n\t\taction: parsedArgs.action,\n\t\tquery: parsedArgs.query\n\t}, function(error, response) {\n\t\tif(typeof parsedArgs.callback == 'function') {\n\t\t\tif(error)\n\t\t\t\tparsedArgs.callback(error, null);\n\t\t\telse if(typeof response.status == 'string' && response.status == 'ok')\n\t\t\t\tparsedArgs.callback(null, response.response);\n\t\t\telse if(typeof response.status == 'string')\n\t\t\t\tparsedArgs.callback(response.error, response.response);\n\t\t}\n\t});\n\n\tvar connection = this._connections[parsedArgs.connectionKey].connection;\n\tconnection.emit('data', requestMessage);\n};\n\n/**\n * Route a packet. Packet\n * @param packet\n * @param callback\n * @private\n */\nNodeRouter.prototype._route = function(packet, callback) {\n\t// TODO add routing rules\n\tvar router = this;\n\tvar nextConnections = {};\n\n\t// Loop over destinations to find next Connections\n\tif(Array.isArray(packet.dest)) {\n\t\tpacket.dest.forEach(function(dest) {\n\t\t\tif(typeof router._addressManager == 'object' && router._addressManager.addressIsEqual(dest)) {\n\t\t\t\trouter.emit('data', packet);\n\t\t\t\trouter.emit('message', packet.message);\n\t\t\t\tcallbackSafe(null, router.address);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar nextConnectionKey = router._routeTable.nextConnection(dest);\n\t\t\t\tif(typeof nextConnectionKey != 'undefined') {\n\t\t\t\t\tif(!Array.isArray(nextConnections[nextConnectionKey]))\n\t\t\t\t\t\tnextConnections[nextConnectionKey] = [];\n\t\t\t\t\tnextConnections[nextConnectionKey].push(dest);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tcallbackSafe(\"no_route\", null);\n\t\t\t}\n\t\t});\n\n\t\tUtils.objectForEach(nextConnections, function(connectionDests, connectionKey) {\n\t\t\t// TODO clone before overwriting dest?\n\t\t\tpacket.dest = connectionDests;\n\t\t\trouter.rpcRequest(connectionKey, 'route', packet, callback);\n\t\t});\n\t}\n\telse\n\t\tcallbackSafe(\"improper_route_format\", null);\n\n\tfunction callbackSafe() {\n\t\tif(typeof callback == 'function')\n\t\t\tcallback.apply(this, Array.prototype.slice.call(arguments));\n\t}\n};\n\n/**\n * Handle an RPC message (request or response to a request)\n * @param connection\n * @param message\n */\nNodeRouter.prototype._rpcMessage = function(connectionKey, message) {\n\tvar router = this;\n\tif(router._rpc.messageIsResponse(message)) // response\n\t\trouter._rpc.handleResponse(message);\n\n\telse { // request\n\n\t\tvar actions = router._actions;\n\n\t\trouter._rpc.handleRequest(message,\n\t\t\tfunction(request, respond) {\n\n\t\t\t\tvar packResponse = function(error, response) {\n\t\t\t\t\tif(error) {\n\t\t\t\t\t\trespond({\n\t\t\t\t\t\t\tstatus: 'error',\n\t\t\t\t\t\t\terror: error,\n\t\t\t\t\t\t\tresponse: response\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\trespond({\n\t\t\t\t\t\t\tstatus: 'ok',\n\t\t\t\t\t\t\tresponse: response\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t};\n\n\t\t\t\tif(typeof request.action == 'string' && typeof actions[request.action] == 'function')\n\t\t\t\t\tactions[request.action](request.query, connectionKey, packResponse);\n\t\t\t\telse\n\t\t\t\t\tpackResponse('action_not_found', null);\n\n\t\t\t},\n\t\t\tfunction(responseMessage) {\n\t\t\t\t// TODO add a single connection.emit handler\n\t\t\t\tif(router._connections[connectionKey]) {\n\t\t\t\t\tvar connection = router._connections[connectionKey].connection;\n\t\t\t\t\tconnection.emit('data', responseMessage);\n\t\t\t\t}\n\t\t\t}\n\t\t);\n\t}\n};\n\nmodule.exports = function(config) {\n\treturn new NodeRouter(config)\n};","var Utils = require('./Utils');\nvar Tree = require('./Trie');\nvar EventEmitter = require('wolfy87-eventemitter');\n\nfunction RouteTable() {\n\tthis.table = Tree();\n}\n\n/**\n * Convert route table to operations to pass to another router\n * @param [filter]\n * @returns {*}\n */\nRouteTable.prototype.toRouteOperations = function(filter) {\n\tvar routeOperationsInsert = [];\n\tthis.table.traverse(function(nodeData, routeKeys) {\n\t\tif(typeof filter != 'function' || filter(nodeData, routeKeys))\n\t\t\trouteOperationsInsert.push({address: routeKeys, cost: nodeData.cost});\n\t});\n\n\treturn routeOperationsInsert.length == 0 ? {} : {insert: routeOperationsInsert};\n};\n\nRouteTable.prototype.__proto__ = EventEmitter.prototype;\n\n/**\n * Get immediate children of parent\n * @param parentAddress\n * @returns {*|XMLList}\n */\nRouteTable.prototype.childRoutes = function(parentAddress) {\n\treturn this.table.children(parentAddress);\n};\n\n/**\n * Return the connection key for the most precise route (longest prefix) to the destination\n * @param destAddress\n * @returns {*}\n */\nRouteTable.prototype.nextConnection = function(destAddress) {\n\tvar closestRoute = this.table.deepest(destAddress);\n\tif(typeof closestRoute == 'object')\n\t\treturn closestRoute.data.connectionKey;\n\telse\n\t\treturn undefined;\n};\n\n/**\n * Remove all routes that use the specified connection\n * @param connectionKey\n */\nRouteTable.prototype.removeConnectionRoutes = function(connectionKey) {\n\tvar removeRoutes = [];\n\tthis.table.traverse(function(nodeData, routeKeys) {\n\t\tif(nodeData.connectionKey == connectionKey)\n\t\t\tremoveRoutes.push(routeKeys);\n\t});\n\n\treturn this.modifyRoutes({remove: removeRoutes}, connectionKey);\n};\n\n/**\n *\n * @param routeOperations\n * @param connectionKey\n * @returns {{}}\n */\nRouteTable.prototype.modifyRoutes = function(routeOperations, connectionKey) {\n\tvar routeTable = this;\n\tvar operationsCompleted = {};\n\n\tif(Array.isArray(routeOperations.remove)) {\n\t\trouteOperations.remove.forEach(function(destAddress) {\n\t\t\tif(Array.isArray(destAddress) && routeTable.removeRoute(destAddress, connectionKey)) {\n\t\t\t\tif(!Array.isArray(operationsCompleted.remove))\n\t\t\t\t\toperationsCompleted.remove = [];\n\t\t\t\tif(operationsCompleted.remove.indexOf(destAddress) < 0)\n\t\t\t\t\toperationsCompleted.remove.push(destAddress);\n\t\t\t\trouteTable.emit('remove', destAddress);\n\t\t\t}\n\t\t});\n\t}\n\n\tif(Array.isArray(routeOperations.insert)) {\n\t\trouteOperations.insert.forEach(function(insertRoute) {\n\t\t\tif(Array.isArray(insertRoute.address) && typeof insertRoute.cost == 'number' && routeTable.insertRoute(insertRoute.address, connectionKey, insertRoute.cost)) {\n\t\t\t\tif(!Array.isArray(operationsCompleted.insert))\n\t\t\t\t\toperationsCompleted.insert = [];\n\t\t\t\tif(operationsCompleted.insert.indexOf(insertRoute) < 0)\n\t\t\t\t\toperationsCompleted.insert.push(insertRoute);\n\t\t\t\trouteTable.emit('insert', insertRoute);\n\t\t\t}\n\t\t});\n\t}\n\n\treturn operationsCompleted;\n};\n\n/**\n * Add a route, returns true on success (new route is lowest cost route and did not already exist), false on failure\n * @param destAddress\n * @param connectionKey\n * @param cost\n * @returns {boolean}\n */\nRouteTable.prototype.insertRoute = function(destAddress, connectionKey, cost) {\n\tvar route = this.table.get(destAddress);\n\n\t// Insert if no route exists, existing cost is higher or connection of existing is the same as new\n\tif(typeof route == 'undefined' || route.cost > cost || route.connectionKey == connectionKey) {\n\t\tthis.table.set(destAddress, {cost: cost, connectionKey: connectionKey});\n\t\treturn true;\n\t}\n\treturn false;\n};\n\n/**\n * Remove a route\n * @param destAddress\n * @param connectionKey\n * @returns {boolean}\n */\nRouteTable.prototype.removeRoute = function(destAddress, connectionKey) {\n\tvar route = this.table.get(destAddress);\n\n\t// Remove if node's connection matches (router no longer has route)\n\tif(typeof route == 'object' && route.connectionKey == connectionKey)\n\t\treturn this.table.remove(destAddress);\n\telse\n\t\treturn false;\n};\n\nmodule.exports = function() {\n\treturn new RouteTable();\n};","var Utils = require('./Utils');\n\nfunction Trie() {\n\tthis.trie = {};\n}\n\n/**\n * Get node data at the specified path, if it exists\n * @param pathKeys\n */\nTrie.prototype.get = function(pathKeys) {\n\tvar node = this.getNode(pathKeys);\n\treturn typeof node == 'object' && typeof node.data != 'undefined' ? node.data : undefined;\n};\n\n/**\n * Get a specified node or return undefined if it does not exist\n * @param pathKeys\n */\nTrie.prototype.getNode = function(pathKeys) {\n\tvar trieNode = this.trie; // start at root\n\tfor(var index in pathKeys) { // loop over keys\n\t\tif(typeof trieNode['children'] != 'object' || typeof trieNode['children'][pathKeys[index]] != 'object') // reached end of tree\n\t\t\treturn;\n\t\ttrieNode = trieNode['children'][pathKeys[index]]; // descend into child node\n\t}\n\treturn trieNode;\n};\n\n/**\n * Set node data, will create the node if it does not exist\n * @param pathKeys\n * @param nodeData\n */\nTrie.prototype.set = function(pathKeys, nodeData) {\n\tvar trieNode = this.trie;\n\tfor(var index in pathKeys) {\n\t\tif(typeof trieNode['children'] != 'object') // create child object in node, if it does not exist\n\t\t\ttrieNode['children'] = {};\n\n\t\tif(typeof trieNode['children'][pathKeys[index]] != 'object') // create child node\n\t\t\ttrieNode['children'][pathKeys[index]] = {};\n\n\t\ttrieNode = trieNode['children'][pathKeys[index]];\n\t}\n\n\ttrieNode.data = nodeData;\n};\n\n/**\n * Remove node's data, while leaving any children intact\n * @param pathKeys\n * @returns {boolean}\n */\nTrie.prototype.remove = function(pathKeys) {\n\tvar nodes = this.inPathNodes(pathKeys);\n\tif(nodes.length != pathKeys.length + 1) // node does not exist\n\t\treturn false;\n\n\tvar deletionNode = nodes.pop();\n\tdelete deletionNode.node.data;\n\n\tif(typeof deletionNode.node.children == 'object' && Object.keys(deletionNode.node.children).length > 0) // deletion node has children, do not prune branch\n\t\treturn true;\n\n\tif(deletionNode.path.length > 0) // deletion node is not root\n\t\tdelete nodes[nodes.length - 1].node.children[deletionNode.path.pop()]; // delete node from child list of parent\n\n\tfor(var index = nodes.length - 1; index >= 0; index--) { // travel up the tree\n\t\tif(typeof nodes[index].node.children == 'object' && Object.keys(nodes[index].node.children).length == 0) // node just deleted was the only child\n\t\t\tdelete nodes[index].node.children;\n\n\t\tif(typeof nodes[index].node.data != \"undefined\" || (typeof nodes[index].node.children == 'object' && Object.keys(nodes[index].node.children).length > 0)) // stop when we find a node with data or that leads to another branch\n\t\t\treturn true;\n\n\t\tif(index > 0)\n\t\t\tdelete nodes[index - 1].node.children[nodes[index].path.pop()]; // delete node from child list of parent\n\t}\n\n\treturn true;\n};\n\n/**\n * Remove node, and any children below it\n * @param pathKeys\n * @returns {boolean}\n */\nTrie.prototype.removeNode = function(pathKeys) {\n\tvar nodes = this.inPathNodes(pathKeys); // TODO possible to do this without using array?\n\tif(nodes.length != pathKeys.length + 1) // node does not exist\n\t\treturn false;\n\n\tvar deletionNode = nodes.pop();\n\tdelete deletionNode.node.data;\n\n\tif(deletionNode.path.length > 0) // deletion node is not root\n\t\tdelete nodes[nodes.length - 1].node.children[deletionNode.path.pop()]; // delete node from child list of parent\n\n\tfor(var index = nodes.length - 1; index >= 0; index--) { // travel up the tree\n\t\tif(typeof nodes[index].node.children == 'object' && Object.keys(nodes[index].node.children).length == 0) // node just deleted was the only child\n\t\t\tdelete nodes[index].node.children;\n\n\t\tif(typeof nodes[index].node.data != \"undefined\" || (typeof nodes[index].node.children == 'object' && Object.keys(nodes[index].node.children).length > 0)) // stop when we find a node with data or that leads to another branch\n\t\t\treturn true;\n\n\t\tif(typeof nodes[index - 1] != 'undefined')\n\t\t\tdelete nodes[index - 1].node.children[nodes[index].path.pop()]; // delete node from child list of parent\n\t}\n\n\treturn true;\n};\n\n/**\n * Return children nodes as an object, or undefined if parent doesn't exist\n * @param pathKeys\n * @returns {*}\n */\nTrie.prototype.children = function(pathKeys) {\n\n\tvar childrenNodes = this.childrenNodes(pathKeys);\n\tif(typeof childrenNodes == 'undefined')\n\t\treturn undefined;\n\telse {\n\t\tvar childrenNodesData = {};\n\t\tUtils.objectForEach(childrenNodes, function(childNode, childNodeKey) {\n\t\t\tif(typeof childNode.data != 'undefined')\n\t\t\t\tchildrenNodesData[childNodeKey] = childNode.data;\n\t\t});\n\t\treturn childrenNodesData;\n\t}\n};\n\n/**\n * Return children nodes as an object, or undefined if parent doesn't exist\n * @param pathKeys\n * @returns {*}\n */\nTrie.prototype.childrenNodes = function(pathKeys) {\n\tvar parentNode = this.getNode(pathKeys);\n\tif(typeof parentNode != 'object') // parent doesn't exist\n\t\treturn undefined;\n\telse if(typeof parentNode.children != 'object') // parent doesn't have children\n\t\treturn {};\n\telse\n\t\treturn parentNode.children;\n};\n\n// TODO make callback last argument\n/**\n * Traverse all the nodes beneath rootNode (or the root of the trie, if rootNode is undefined), which contain data\n * @param callback\n * @param [rootNode]\n * @param [rootNodePathKeys]\n */\nTrie.prototype.traverse = function(callback, rootNode, rootNodePathKeys) {\n\tthis.traverseNodes(function (node, nodePathKeys) {\n\t\tif(typeof node.data != 'undefined')\n\t\t\tcallback(node.data, nodePathKeys);\n\t}, rootNode, rootNodePathKeys);\n};\n\n// TODO make callback last argument\n/**\n * Traverse all the nodes beneath rootNode (or the root of the trie, if rootNode is undefined)\n * @param callback\n * @param [rootNode]\n * @param [rootNodePathKeys]\n */\nTrie.prototype.traverseNodes = function(callback, rootNode, rootNodePathKeys) {\n\tif(!Array.isArray(rootNodePathKeys))\n\t\tvar rootNodePathKeys = [];\n\n\tif(typeof rootNode != 'object')\n\t\tvar rootNode = this.trie;\n\n\tcallback(rootNode, rootNodePathKeys);\n\tif(typeof rootNode.children) {\n\t\tvar childKey;\n\t\tfor(childKey in rootNode.children) {\n\t\t\tif (rootNode.children.hasOwnProperty(childKey))\n\t\t\t\tthis.traverseNodes(callback, rootNode.children[childKey], rootNodePathKeys.concat(childKey));\n\t\t}\n\t}\n};\n\n/**\n * Get data from node in specified path at or closest to end of path, where node must contain data\n * @param pathKeys\n * @returns {object}\n */\nTrie.prototype.deepest = function(pathKeys) {\n\tvar deepestTrieNodeData = undefined;\n\tvar deepestTrieNodePathKeys = undefined;\n\tthis.descend(pathKeys, function(trieNodeData, trieNodePathKeys) {\n\t\tdeepestTrieNodeData = trieNodeData;\n\t\tdeepestTrieNodePathKeys = trieNodePathKeys;\n\t});\n\treturn (typeof deepestTrieNodePathKeys == 'undefined') ? undefined : {pathKeys: deepestTrieNodePathKeys, data: deepestTrieNodeData};\n};\n\n// TODO deepestNode?\n\n/**\n * Trigger callback on each node in the path that contains data\n * @param pathKeys\n * @param callback\n */\nTrie.prototype.descend = function(pathKeys, callback) {\n\tthis.descendNodes(pathKeys, function(trieNode, trieNodePathKeys) {\n\t\tif(typeof trieNode.data != 'undefined')\n\t\t\tcallback(trieNode.data, trieNodePathKeys);\n\t});\n};\n\n/**\n * Trigger callback on each node in the path\n * @param pathKeys\n * @param callback\n */\nTrie.prototype.descendNodes = function(pathKeys, callback) {\n\tvar trieNode = this.trie; // start at root\n\tcallback(trieNode, []); // return the root\n\n\tfor(var index = 0; index < pathKeys.length; index++) { // loop over keys\n\t\tif(typeof trieNode['children'] != 'object' || typeof trieNode['children'][pathKeys[index]] != 'object') // reached end of tree\n\t\t\treturn;\n\t\ttrieNode = trieNode['children'][pathKeys[index]]; // descend into child node\n\t\tcallback(trieNode, pathKeys.slice(0, index+1));\n\t}\n};\n\n/**\n * Get all nodes in path, including those that contain no data\n * @param pathKeys\n * @returns {Array}\n */\nTrie.prototype.inPathNodes = function(pathKeys) {\n\tvar matches = [];\n\tthis.descend(pathKeys, function(matchedNodeData, matchedNodePath) {\n\t\tmatches.push({path: matchedNodePath, data: matchedNodeData});\n\t});\n\treturn matches;\n};\n\n/**\n * Get all nodes in path, including those that contain no data\n * @param pathKeys\n * @returns {Array}\n */\nTrie.prototype.inPathNodes = function(pathKeys) {\n\tvar matches = [];\n\tthis.descendNodes(pathKeys, function(matchedNode, matchedNodePath) {\n\t\tmatches.push({path: matchedNodePath, node: matchedNode});\n\t});\n\treturn matches;\n};\n\nmodule.exports = function() {\n\treturn new Trie();\n};","var $3_BITS = 0xFFFFFF;\nvar $5_BITS = 0xFFFFFFFFFF;\n\nvar MACHINE_ID_AND_PID = Math.round(Math.random() * $5_BITS);\nvar index = 0;\n\nvar Index = function () {\n  index = index + 1 % $3_BITS;\n  return index;\n};\n\nvar Timestamp = function () {\n  return Math.floor((new Date()) / 1000);\n};\n\nvar pad = function (val, pad) {\n  while (val.length < pad) {\n    val = '0' + val;\n  }\n  return val;\n};\n\nvar makeObjectId = function () {\n\n  /* ObjectIds\n   * 24 character hex strings of 12 byte objects\n   * 0 | 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | A | B\n   * Timestamp     | Machine   | PID   | Index\n   * Since we're running in a browser, we just use random values\n   * for Machine and PID\n   */\n\n  var groups = [ // [value, padding in hex (bytes * 2)]\n    [Timestamp(), 8],\n    [MACHINE_ID_AND_PID, 10],\n    [Index(), 6]\n  ];\n\n  var str = groups.reduce(function (id, group) {\n    return id + pad(group[0].toString(16), group[1]);\n  }, '');\n\n  return str;\n\n};\n\nvar objIdPattern = /^[0-9a-fA-F]{24}$/;\nvar isValid = function (alleged) {\n  return (!!alleged &&\n          typeof alleged.toString === 'function' &&\n          objIdPattern.test(alleged.toString())\n        )\n};\n\nmodule.exports = makeObjectId;\nmodule.exports.isValid = isValid;","var FunctionUtils = {};\n\nFunctionUtils.objectPublicFunctions = function(object) {\n\tfunction objFunctions(object) {\n\t\tvar functionNames = [];\n\t\tfor(var attribute in object) {\n\t\t\tif(typeof object[attribute] === 'function')\n\t\t\t\tfunctionNames.push(attribute);\n\t\t}\n\t\treturn functionNames;\n\t}\n\n\treturn objFunctions(object).filter(function(attribute) {\n\t\treturn (attribute[0] !== '_' && attribute !== 'globalFunctions');\n\t});\n};\n\nFunctionUtils.objectReplicateFunctions = function(sourceObject, targetObject, excludeFunctions) {\n\tif(!Array.isArray(excludeFunctions))\n\t\texcludeFunctions = [];\n\n\tvar functions = FunctionUtils.objectPublicFunctions(sourceObject); // get collection's public functions\n\tfunctions.forEach(function(functionName) {\n\t\tif(typeof targetObject[functionName] == 'undefined' && excludeFunctions.indexOf(functionName) < 0) { // safety check, don't override own functions\n\t\t\t// set own public function to match collection's function\n\t\t\ttargetObject[functionName] = function () {\n\t\t\t\tsourceObject[functionName].apply(sourceObject, Array.prototype.slice.call(arguments));\n\t\t\t}\n\t\t}\n\t});\n};\n\nmodule.exports = FunctionUtils;","module.exports = {\n\tOmsIntercept: require('./OmsIntercept'),\n\tOmsLayers: require('./OmsLayers'),\n\tOmsMongoConnector: require('./OmsMongoConnector'),\n\tOmsOplog: require('./OmsOplog'),\n\tOmsOplogSubscriptions: require('./OmsOplogSubscriptions'),\n\tOmsSubscriptions: require('./OmsSubscriptions'),\n\tOmsUtils: require('./OmsUtils')\n};","var QueueEmitter = require('queue-emitter');\nvar FunctionUtils = require('./FunctionUtils');\n\nfunction OmsIntercept(collection) {\n\tthis.collection = collection;\n\tthis._maxOpId = 0;\n\tthis._replicateInterceptCollectionFunctions();\n}\n\nOmsIntercept.prototype.__proto__ = QueueEmitter.prototype;\n\nOmsIntercept.prototype._replicateInterceptCollectionFunctions = function() {\n\tvar omsIntercept = this;\n\tvar functions = FunctionUtils.objectPublicFunctions(this.collection); // get collection's public functions\n\tvar excludeFunctions = ['isCapped'];\n\tfunctions.forEach(function(functionName) {\n\t\tif(typeof omsIntercept[functionName] == 'undefined' && excludeFunctions.indexOf(functionName) < 0) { // safety check, don't override own functions\n\t\t\t// set own public function to match collection's function\n\t\t\tomsIntercept[functionName] = function () {\n\t\t\t\tomsIntercept._collectionFunction(functionName, Array.prototype.slice.call(arguments));\n\t\t\t}\n\t\t}\n\t});\n};\n\nOmsIntercept.prototype._collectionFunction = function(functionName, functionArguments) {\n\tvar omsIntercept = this;\n\tvar opId = omsIntercept._maxOpId;\n\tvar opCompleteArgs = undefined;\n\tomsIntercept._maxOpId++;\n\n\t// callback is last argument\n\t// remove it and only call it when queues complete\n\tif(Array.isArray(functionArguments) && functionArguments.length > 0 && typeof functionArguments[functionArguments.length - 1] == 'function')\n\t\tvar completeCallback = functionArguments.pop();\n\n\t// Called after completing pre-processing queue\n\tfunction preCallback(error) {\n\t\tif(error !== null) // exit if prep-processing functions return an error\n\t\t\topCallback(error);\n\t\telse // proceed if queue finished successfully\n\t\t\tomsIntercept.collection[functionName].apply(omsIntercept.collection, functionArguments.concat([opCallback]));\n\t}\n\n\t// Called after the operation\n\tfunction opCallback() {\n\t\topCompleteArgs = Array.prototype.slice.call(arguments); // store to pass through original callback\n\t\tomsIntercept.emit.apply(omsIntercept, [functionName].concat(opId).concat(opCompleteArgs).concat([opEmitCallback]));\n\t}\n\n\tfunction opEmitCallback(error) {\n\t\tif(typeof completeCallback == 'function') {\n\t\t\tvar completeArgs = Array.prototype.slice.call(arguments);\n\t\t\tcompleteArgs.shift(); // remove opId\n\t\t\tcompleteCallbackSafe(completeArgs);\n\t\t}\n\t}\n\n\t// Only call if completeCallback is a function\n\tfunction completeCallbackSafe() {\n\t\tif(typeof completeCallback == 'function')\n\t\t\tcompleteCallback.apply(omsIntercept, opCompleteArgs);\n\t}\n\n\t// emit(pre-OP, opId, <opArgs>)\n\tomsIntercept.emit.apply(omsIntercept, ['pre-' + functionName].concat(opId).concat(functionArguments).concat([preCallback]));\n};\n\nOmsIntercept.prototype._objectPublicFunctions = function(object) {\n\tfunction objFunctions(object) {\n\t\tvar functionNames = [];\n\t\tfor(var attribute in object) {\n\t\t\tif(typeof object[attribute] === 'function')\n\t\t\t\tfunctionNames.push(attribute);\n\t\t}\n\t\treturn functionNames;\n\t}\n\n\treturn objFunctions(object).filter(function(attribute) {\n\t\treturn (attribute[0] !== '_' && attribute !== 'globalFunctions');\n\t});\n};\n\nmodule.exports = function(collection) {\n\treturn new OmsIntercept(collection);\n};","var FunctionUtils = require('./FunctionUtils');\n\nfunction OmsLayers(cacheCollection, masterCollection) {\n\tvar self = this;\n\tself.cacheCollection = cacheCollection;\n\tself.masterCollection = masterCollection;\n\n\tFunctionUtils.objectReplicateFunctions(self.masterCollection, self);\n\n\tself.masterCollection.on('insert', function(doc, options) {\n\t\tself.cacheCollection.insert(doc, options);\n\t});\n\n\tself.masterCollection.on('update', function(unmodifiedDoc, modifiedDoc, updateOp, options) {\n\t\tself.cacheCollection.update({_id: unmodifiedDoc._id}, updateOp, options);\n\t});\n\n\tself.masterCollection.on('remove', function(doc, options) {\n\t\tself.cacheCollection.remove({_id: doc._id});\n\t});\n}\n\nmodule.exports = function(cacheCollection, masterCollection) {\n\treturn new OmsLayers(cacheCollection, masterCollection);\n};\n","var EventEmitter = require('wolfy87-eventemitter');\nvar FauxMongo = require('fauxmongo');\n//var MongoLocal = require('mongolocal');\nvar OmsIntercept = require('./OmsIntercept');\nvar OmsSubscriptions = require('./OmsSubscriptions');\n\nvar Utils = require('./Utils');\nvar FunctionUtils = require('./FunctionUtils');\n\n// Access a Mongo Collection as Oms Collection\nfunction OmsMongoConnector(mongoCollection) {\n\n\tvar self = this;\n\tthis.operationsQueue = [];\n\tthis.mongoIntercept = OmsIntercept(mongoCollection);\n\n\tFunctionUtils.objectReplicateFunctions(self.mongoIntercept, self);\n\n\t//this.localCollection = MongoLocal();\n\n\tvar completeCallback = null;\n\n\tself.mongoIntercept.on('pre-insert', function() {\n\n\t\tvar parsedArgs = Utils.parseArgs(\n\t\t\targuments,\n\t\t\t[\n\t\t\t\t{name: 'opId', level: 0, validate: function(arg, allArgs) { return typeof(arg) != 'undefined' }},\n\t\t\t\t{name: 'docs', level: 0, validate: function(arg, allArgs) { return typeof(arg) == 'object' }},\n\t\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }, default: {}},\n\t\t\t\t{name: 'next', level: 0, validate: function(arg, allArgs) { return typeof(arg) === 'function'; }}\n\t\t\t]\n\t\t);\n\n\t\tself.queue(function(queueNext) {\n\t\t\tcompleteCallback = queueNext;\n\t\t\tself._docs = parsedArgs.docs; // cache the docs\n\t\t\tparsedArgs.next();\n\t\t});\n\t});\n\n\tself.mongoIntercept.on('insert', function(opId, error, result) {\n\n\t\tvar next = arguments[arguments.length - 1];\n\n\t\t// emit saved docs\n\t\tif(!Array.isArray(self._docs)) // single doc insert\n\t\t\tself._docs = [self._docs];\n\n\t\tself._docs.forEach(function(doc) {\n\t\t\tself.emit('insert', doc);\n\t\t});\n\n\t\tdelete self.docs;\n\n\t\tcompleteCallback(); // start next operation\n\t\tnext(); // continue through insertion event queue\n\t});\n\n\tself.mongoIntercept.on('pre-update', function() {\n\n\t\tvar parsedArgs = Utils.parseArgs(\n\t\t\targuments,\n\t\t\t[\n\t\t\t\t{name: 'opId', level: 0, validate: function(arg, allArgs) { return typeof(arg) != 'undefined' }},\n\t\t\t\t{name: 'query', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object' || typeof(arg) == 'string'; }, default: {}},\n\t\t\t\t{name: 'updateOperations', level: 0, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }},\n\t\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }, default: {}},\n\t\t\t\t{name: 'next', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'function'; }}\n\t\t\t]\n\t\t);\n\n\t\tif(typeof parsedArgs.query == 'string')\n\t\t\tparsedArgs.query = {_id: parsedArgs.query};\n\n\t\tself.queue(function(queueNext) {\n\t\t\tcompleteCallback = queueNext;\n\n\t\t\tif(typeof parsedArgs.options != 'object' || !parsedArgs.options.multi) {\n\t\t\t\tself.mongoIntercept.findOne(parsedArgs.query, function(error, doc) {\n\t\t\t\t\tvar docs = [doc];\n\t\t\t\t\tpostFind(error, docs);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t\tself.mongoIntercept.find(parsedArgs.query, postFind);\n\n\t\t\tfunction postFind(error, docs) {\n\t\t\t\tif(error)\n\t\t\t\t\tparsedArgs.next(error);\n\t\t\t\telse {\n\t\t\t\t\t// Save unmodified docs\n\t\t\t\t\tself._unmodifiedDocs = {};\n\t\t\t\t\tdocs.forEach(function(doc) {\n\t\t\t\t\t\tself._unmodifiedDocs[doc._id] = self._cloneObject(doc);\n\t\t\t\t\t});\n\n\t\t\t\t\tself._updateOperations = parsedArgs.updateOperations; // TODO validate?\n\t\t\t\t\tparsedArgs.next();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t});\n\n\tself.mongoIntercept.on('update', function() {\n\t\t// TODO check for errors, don't emit on errors\n\t\tvar next = arguments[arguments.length - 1];\n\n\t\tvar validatedOperations = self._validateUpdate(self._updateOperations);\n\t\tUtils.objectForEach(self._unmodifiedDocs, function(unmodifiedDoc) {\n\t\t\tvar modifiedDoc = self._updateDoc(unmodifiedDoc, validatedOperations, true);\n\t\t\tself.emit('update', unmodifiedDoc, modifiedDoc, self._updateOperations);\n\t\t});\n\n\t\tdelete self._unmodifiedDocs;\n\t\tdelete self._updateOperations;\n\n\t\tcompleteCallback();\n\t\tnext();\n\t});\n\n\tself.mongoIntercept.on('pre-remove', function() {\n\n\t\tvar parsedArgs = Utils.parseArgs(\n\t\t\targuments,\n\t\t\t[\n\t\t\t\t{name: 'opId', level: 0, validate: function(arg, allArgs) { return typeof(arg) != 'undefined' }},\n\t\t\t\t{name: 'query', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object' || typeof(arg) == 'string'; }, default: {}},\n\t\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'object'; }, default: {}},\n\t\t\t\t{name: 'next', level: 1, validate: function(arg, allArgs) { return typeof(arg) == 'function'; }}\n\t\t\t]\n\t\t);\n\n\t\tif(typeof parsedArgs.query == 'string')\n\t\t\tparsedArgs.query = {_id: parsedArgs.query};\n\n\n\t\tself.queue(function(queueNext) {\n\t\t\tcompleteCallback = queueNext;\n\n\t\t\tself.mongoIntercept.find(parsedArgs.query, function(error, docs) {\n\t\t\t\tif(error)\n\t\t\t\t\tparsedArgs.next(error);\n\t\t\t\telse {\n\t\t\t\t\t// Save unmodified docs\n\t\t\t\t\tself._unmodifiedDocs = {};\n\t\t\t\t\tdocs.forEach(function(doc) {\n\t\t\t\t\t\tself._unmodifiedDocs[doc._id] = self._cloneObject(doc);\n\t\t\t\t\t});\n\n\t\t\t\t\tparsedArgs.next();\n\t\t\t\t}\n\t\t\t});\n\t\t});\n\t});\n\n\tself.mongoIntercept.on('remove', function() {\n\t\tvar next = arguments[arguments.length - 1];\n\n\t\t// for each saved doc, emit the doc\n\t\tUtils.objectForEach(self._unmodifiedDocs, function(unmodifiedDoc) {\n\t\t\tself.emit('remove', unmodifiedDoc);\n\t\t});\n\n\t\tdelete self._unmodifiedDocs;\n\n\t\tcompleteCallback();\n\t\tnext();\n\t});\n}\n\nOmsMongoConnector.prototype.__proto__ = EventEmitter.prototype;\n\nOmsMongoConnector.prototype.queue = function(callback) {\n\tvar self = this;\n\n\tvar queueNext = function() {\n\t\tself.operationsQueue.shift(); // remove current\n\n\t\tif(self.operationsQueue.length)\n\t\t\tself.operationsQueue[0]();\n\t};\n\n\tself.operationsQueue.push(callback);\n\n\tif(self.operationsQueue.length == 1)\n\t\tcallback(queueNext);\n};\n\n/**\n * Validate and fix update operations\n * @param update\n * @returns {{}}\n * @private\n */\nOmsMongoConnector.prototype._validateUpdate = function(update) {\n\tvar validated = {};\n\n\tUtils.objectForEach(update, function(attributeVal, attributeKey) {\n\t\tif(attributeKey == '$set') // merge set with attributes already set\n\t\t\tvalidated['$set'] = Utils.objectMerge(validated['$set'], attributeKey);\n\t\telse if(attributeKey.charAt(0) == '$') // any other operation (pass through)\n\t\t\tvalidated[attributeKey] = attributeVal;\n\t\telse { // regular attribute (non-operation)\n\t\t\tif(typeof validated['$set'] != 'object' || validated['$set'] == null)\n\t\t\t\tvalidated['$set'] = {};\n\t\t\tvalidated['$set'][attributeKey] = attributeVal;\n\t\t}\n\t});\n\n\treturn validated;\n};\n\nOmsMongoConnector.prototype._updateDoc = function(doc, updateOperations, clone) {\n\tif(typeof clone == 'boolean' && clone) // make a copy instead of updating in place\n\t\tdoc = this._cloneObject(doc);\n\tvar updateMongoOperators = {};\n\tUtils.objectForEach(updateOperations, function(operationValue, operationKey) {\n\t\tif(operationKey.charAt(0) == '$') // operation\n\t\t\tupdateMongoOperators[operationKey] = operationValue;\n\t\telse\n\t\t\tdoc[operationKey] = operationValue;\n\t});\n\n\t// TODO add options here\n\tFauxMongo.update(doc, updateMongoOperators);\n\n\treturn doc;\n};\n\nOmsMongoConnector.prototype._cloneObject = function(object) {\n\treturn JSON.parse(JSON.stringify(object));\n};\n\nmodule.exports = function(mongoCollection) {\n\treturn new OmsMongoConnector(mongoCollection);\n};","var MongoLocal = require('mongolocal');\nvar FunctionUtils = require('./FunctionUtils');\nvar OmsUtils = require('./OmsUtils');\nvar Utils = require('./Utils');\n\nfunction OmsOplog(docCollection, opLogConfig, opTags) {\n\tvar self = this;\n\tself.docCollection = docCollection;\n\tself.opLogCollection = MongoLocal(opLogConfig);\n\tself.docsLinkedList = self.opLogCollection.docsLinkedList;\n\n\tFunctionUtils.objectReplicateFunctions(self.opLogCollection, self);\n\n\tvar opTypes = ['insert', 'update', 'remove'];\n\n\topTypes.forEach(function(opType) {\n\t\tdocCollection.on(opType, function() {\n\t\t\tvar operationObject = OmsUtils.operationObject(opType, arguments); // Convert args to op object\n\t\t\tvar operationDoc = OmsUtils.operationDoc(operationObject);\n\n\t\t\tif(typeof operationObject.options == 'object' && typeof operationObject.options._operation != 'undefined') { // op was applied\n\t\t\t\tvar srcOperationDoc = operationObject.options._operation; // Get the op that was passed in; don't insert as-is because may be minified\n\t\t\t\tdelete operationObject.options._operation; // Delete _operation so it doesn't continue to be passed on\n\t\t\t\tif(typeof srcOperationDoc._id == 'undefined' && typeof srcOperationDoc._srcId != 'undefined')\n\t\t\t\t\toperationDoc._id = srcOperationDoc._srcOpId;\n\t\t\t\toperationDoc.src = 'applied';\n\t\t\t}\n\t\t\telse\n\t\t\t\toperationDoc = Utils.objectMerge(opTags, operationDoc, {src: 'local'}); // Add user-defined tags\n\t\t\tself.opLogCollection.insert(operationDoc);\n\t\t});\n\t});\n}\n\nOmsOplog.prototype.applyOp = function(operationDoc) {\n\tvar self = this;\n\tif(typeof operationDoc != 'undefined') {\n\t\tvar searchId = (typeof operationDoc._id != 'undefined') ? operationDoc._id : operationDoc._srcOpId;\n\n\t\tif(typeof searchId != 'undefined') {\n\t\t\tself.opLogCollection.findOne({_id: searchId}, function(error, existingOperationDoc) {\n\t\t\t\tif(!error && existingOperationDoc == null) // Operation is not already in log\n\t\t\t\t\tapplyCollectionOp(operationDoc);\n\t\t\t});\n\t\t}\n\t\telse // generated event (eg: an insert from findSubscribe)\n\t\t\tapplyCollectionOp(operationDoc);\n\t}\n\telse\n\t\tthrow new Error('operation_undefined');\n\n\t// Op has not previously been applied\n\tfunction applyCollectionOp(operationDoc) {\n\n\t\t// Tag the operation through mongolocal\n\t\tUtils.objectSet(operationDoc.operation, ['options', '_operation'], operationDoc);\n\n\t\tvar collectionFunctionArgs = OmsUtils.operationFunctionArguments(operationDoc.operation);\n\n\t\tif(typeof self.docCollection[operationDoc.operation.operation] == 'function')\n\t\t\tself.docCollection[operationDoc.operation.operation].apply(self.docCollection, collectionFunctionArgs);\n\t}\n};\n\nmodule.exports = function(docCollection, opLogConfig, opTags) {\n\treturn new OmsOplog(docCollection, opLogConfig, opTags);\n};\n","var OmsSubscriptions = require('./OmsSubscriptions');\nvar OmsUtils = require('./OmsUtils');\n\nfunction OmsOplogSubscriptions(opLogCollection) {\n\tvar self = this;\n\n\tself.opLogCollection = opLogCollection;\n\tself.docCollection = opLogCollection.docCollection;\n\tself._subscriptions = {};\n\tself._collectionQueries = {};\n\tself._opLogQueries = {};\n\n\tthis.opLogCollection.on('insert', function(opLogDoc) {\n\t\tself._publish(opLogDoc);\n\t});\n}\n\n/**\n *\n * @param lastOpId\n * @param collectionQuery\n * @param opLogQuery\n * @param callback\n */\nOmsOplogSubscriptions.prototype.subscribeResume = function(lastOpId, collectionQuery, opLogQuery, callback) {\n\tvar self = this;\n\tself.opLogCollection.findOne({_id: lastOpId}, function(error, lastOp) {\n\t\tif(error)\n\t\t\tcallback(error, null);\n\t\tif(lastOp == null)\n\t\t\tcallback('last_op_not_found', null);\n\t\telse { // Last op was found\n\t\t\tvar listItem = self.opLogCollection.docsLinkedList.list[lastOpId];\n\t\t\tlistItem = listItem.next; // skip the last operation\n\n\t\t\tnextOpLogItem();\n\n\t\t\tfunction nextOpLogItem() {\n\t\t\t\tif(listItem == null) // Reached end of oplog\n\t\t\t\t\tself.subscribe(collectionQuery, opLogQuery, callback);\n\t\t\t\telse {\n\t\t\t\t\tself.opLogCollection.findOne({_id: listItem.data}, function (error, opLogDoc) {\n\t\t\t\t\t\tif (error)\n\t\t\t\t\t\t\tcallback(error, null);\n\t\t\t\t\t\telse {\n\t\t\t\t\t\t\tvar opLogSubscriptionComputedDoc = self.opLogSubscriptionComputedDoc(opLogDoc, opLogQuery, collectionQuery);\n\t\t\t\t\t\t\tif (opLogSubscriptionComputedDoc != null)\n\t\t\t\t\t\t\t\tcallback(null, opLogSubscriptionComputedDoc);\n\t\t\t\t\t\t\tlistItem = listItem.next;\n\t\t\t\t\t\t\tnextOpLogItem();\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t});\n};\n\n/**\n * For a given opLogDoc, if queries match, determine how log action impacts subscription\n * Create an opLog doc that will be applied to client collection\n * Return null if no match\n * @param opLogDoc\n * @param opLogQuery\n * @param collectionQuery\n */\nOmsOplogSubscriptions.prototype.opLogSubscriptionComputedDoc = function (opLogDoc, opLogQuery, collectionQuery) {\n\tif(OmsUtils.docMatch(opLogDoc, opLogQuery))\n\t\treturn this.operationSubscriptionComputedDoc(opLogDoc, collectionQuery);\n\telse\n\t\treturn null;\n};\n\n/**\n * For a given opLogDoc, if queries match, determine how log action impacts subscription\n * Create an opLog doc that will be applied to client collection\n * Return null if no match\n * @param opLogDoc\n * @param opLogQuery\n * @param collectionQuery\n */\nOmsOplogSubscriptions.prototype.operationSubscriptionComputedDoc = function(opLogDoc, collectionQuery) {\n\tswitch(opLogDoc.operation.operation) {\n\t\tcase 'insert':\n\t\tcase 'remove':\n\t\t\tif(OmsUtils.docMatch(opLogDoc.operation.doc, collectionQuery)) // Return original opLogDoc\n\t\t\t\treturn this._objectMerge(opLogDoc, {src: 'subscription'});\n\t\t\tbreak;\n\t\tcase 'update':\n\t\t\tvar unmodifiedDocMatch = OmsUtils.docMatch(opLogDoc.operation.unmodifiedDoc, collectionQuery);\n\t\t\tvar modifiedDocMatch = OmsUtils.docMatch(opLogDoc.operation.modifiedDoc, collectionQuery);\n\n\t\t\tif(unmodifiedDocMatch && modifiedDocMatch) // send original update\n\t\t\t\treturn opLogDoc;\n\t\t\telse {\n\t\t\t\tif(unmodifiedDocMatch && !modifiedDocMatch) // send removal\n\t\t\t\t\tvar operationObject = OmsUtils.operationObject('remove', [opLogDoc.operation.unmodifiedDoc]);\n\t\t\t\telse if(!unmodifiedDocMatch && modifiedDocMatch) // send insertion\n\t\t\t\t\tvar operationObject = OmsUtils.operationObject('insert', [opLogDoc.operation.modifiedDoc]);\n\t\t\t\telse // Doesn't match at all\n\t\t\t\t\treturn null;\n\n\t\t\t\tvar operationDoc = OmsUtils.operationDoc(operationObject);\n\t\t\t\treturn this._objectMerge(operationDoc, {_srcOpId: opLogDoc._id, src: 'subscription_translated'}); // Assign ID of ID which triggered this event\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('unknown_event');\n\t\t\tbreak;\n\t}\n\treturn null;\n};\n\n/**\n *\n * @param collectionQuery\n * @param opLogQuery\n * @param callback\n */\nOmsOplogSubscriptions.prototype.findSubscribe = function(collectionQuery, opLogQuery, callback) {\n\tvar self = this;\n\tvar findComplete = false; // do not trigger subscription until find is complete\n\n\tself.docCollection.find(collectionQuery, function(error, collectionDocs) {\n\t\tif(error)\n\t\t\tcallback(error, null);\n\t\telse {\n\t\t\tself.subscribe(collectionQuery, opLogQuery, subscribeCallback);\n\t\t\tcollectionDocs.forEach(function(doc) {\n\t\t\t\t// 'Insert' each found doc\n\t\t\t\tvar operationObject = OmsUtils.operationObject('insert', [doc]);\n\t\t\t\tvar operationDoc = self._objectMerge(OmsUtils.operationDoc(operationObject), {src: 'subscription_setup'});\n\t\t\t\tcallback(null, operationDoc);\n\t\t\t});\n\t\t\tvar operationObject = OmsUtils.operationObject('subscribe', ['find-complete']);\n\t\t\tcallback(null, OmsUtils.operationDoc(operationObject));\n\t\t}\n\t});\n\n\n\tfunction subscribeCallback() {\n\n\t\tconsole.log(\"SUB-CB\", arguments);\n\n\t\tcallback.apply(self, Array.prototype.slice.call(arguments));\n\t}\n};\n\n/**\n *\n * @param collectionQuery\n * @param opLogQuery\n * @param callback\n */\nOmsOplogSubscriptions.prototype.subscribe = function(collectionQuery, opLogQuery, callback) {\n\tvar collectionQueryKey = this._queryKey(this._collectionQueries, collectionQuery);\n\tthis._collectionQueries[collectionQueryKey].usages++;\n\n\tvar opLogQueryKey = this._queryKey(this._opLogQueries, opLogQuery);\n\tthis._opLogQueries[opLogQueryKey].usages++;\n\n\tvar subscriptionId = this._uniqueId();\n\tthis._subscriptions[subscriptionId] = {collectionQueryKey: collectionQueryKey, opLogQueryKey: opLogQueryKey, callback: callback};\n\n\tvar operationObject = OmsUtils.operationObject('subscribe', ['subscribed', {subscriptionId: subscriptionId}]);\n\tcallback(null, OmsUtils.operationDoc(operationObject));\n\n\treturn subscriptionId;\n};\n\n/**\n *\n * @param opLogDoc\n * @private\n */\nOmsOplogSubscriptions.prototype._publish = function(opLogDoc) {\n\n\tconsole.log(\"PUBLISH\", opLogDoc);\n\n\tvar self = this;\n\n\tvar collectionQueryResults = {};\n\tvar opLogQueryResults = {};\n\n\tthis._objectForEach(self._subscriptions, function(subscription, subscriptionKey) {\n\t\tvar collectionQueryKey = subscription.collectionQueryKey;\n\t\tvar collectionQuery = self._collectionQueries[collectionQueryKey].query;\n\n\t\tvar opLogQueryKey = subscription.opLogQueryKey;\n\t\tvar opLogQuery = self._opLogQueries[opLogQueryKey].query;\n\n\t\t// Store the opLog query result\n\t\tif(typeof opLogQueryResults[opLogQueryKey] != 'boolean')\n\t\t\topLogQueryResults[opLogQueryKey] = OmsUtils.docMatch(opLogDoc, opLogQuery);\n\n\t\t// OpLog query matches\n\t\tif(opLogQueryResults[opLogQueryKey]) {\n\n\t\t\tconsole.log(\"MATCHES\", opLogDoc);\n\t\t\tconsole.log(\"CQ\", collectionQuery);\n\n\t\t\t// Store the collection query result\n\t\t\tif(typeof collectionQueryResults[collectionQueryKey] != 'boolean')\n\t\t\t\tcollectionQueryResults[collectionQueryKey] = self.operationSubscriptionComputedDoc(opLogDoc, collectionQuery);\n\n\t\t\tif(collectionQueryResults[collectionQueryKey] != null) { // Collection query matched\n\t\t\t\tconsole.log(\"MATCH-2\");\n\t\t\t\tsubscription.callback(null, collectionQueryResults[collectionQueryKey]);\n\n\t\t\t}\n\t\t}\n\t});\n};\n\n\n/**\n * Loop over existing queries, comparing query to needle; return key if found\n * Add the query and return its key if it does not already exist\n * @param haystackObject\n * @param needle\n * @private\n */\nOmsOplogSubscriptions.prototype._queryKey = function(queriesHaystack, queryNeedle) {\n\tvar property;\n\tfor(property in queriesHaystack) { // pull keys before looping through?\n\t\tif (queriesHaystack.hasOwnProperty(property) && this._objectDeepEqual(queriesHaystack[property].query, queryNeedle)) // Found needle\n\t\t\treturn property;\n\t}\n\n\t// Needle not found, Add it\n\tvar queryKey = this._uniqueId();\n\tqueriesHaystack[queryKey] = {usages: 0, query: queryNeedle};\n\treturn queryKey;\n};\n\n/**\n * Remove subscription\n * @param subscriptionId\n */\nOmsOplogSubscriptions.prototype.unsubscribe = function(subscriptionId) {\n\n\tvar subscription = this._subscriptions[subscriptionId];\n\n\tif(!subscription)\n\t\tthrow new Error('subscription_not_found');\n\telse {\n\t\tvar collectionQueryKey = subscription.collectionQueryKey;\n\t\tvar collectionQueryConfig = this._collectionQueries[collectionQueryKey];\n\t\tcollectionQueryConfig.usages--;\n\t\tif(collectionQueryConfig.usages <= 0)\n\t\t\tdelete this._collectionQueries[collectionQueryKey];\n\n\t\tvar opLogQueryKey = subscription.opLogQueryKey;\n\t\tvar opLogQueryConfig = this._opLogQueries[opLogQueryKey];\n\t\topLogQueryConfig.usages--;\n\t\tif(opLogQueryConfig.usages <= 0)\n\t\t\tdelete this._opLogQueries[opLogQueryKey];\n\t}\n};\n\nOmsOplogSubscriptions.prototype._uniqueId = function() {\n\tfunction s4() {\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\n\t\t\t.toString(16)\n\t\t\t.substring(1);\n\t}\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n\t\ts4() + '-' + s4() + s4() + s4();\n};\n\nOmsOplogSubscriptions.prototype._objectDeepEqual = function (x, y) {\n\tif ((typeof x == \"object\" && x != null) && (typeof y == \"object\" && y != null)) {\n\t\tif (Object.keys(x).length != Object.keys(y).length)\n\t\t\treturn false;\n\n\t\tfor(var prop in x) {\n\t\t\tif(y.hasOwnProperty(prop)) {\n\t\t\t\tif (! this._objectDeepEqual(x[prop], y[prop]))\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\telse if(x !== y)\n\t\treturn false;\n\telse\n\t\treturn true;\n};\n\nOmsOplogSubscriptions.prototype._objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nOmsOplogSubscriptions.prototype._objectMerge = function() {\n\tvar merged = {};\n\tthis._objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\nmodule.exports = function(opLogCollection) {\n\treturn new OmsOplogSubscriptions(opLogCollection);\n};","var OmsUtils = require('./OmsUtils');\n/**\n *\n * @param config\n * @constructor\n */\nfunction OmsSubscriptions(opLogSubscriptions) {\n\tthis.opLogSubscriptions = opLogSubscriptions;\n}\n\n/**\n *\n * @param [query]\n * @param callback\n */\nOmsSubscriptions.prototype.findSubscribeObject = function() {\n\tvar query = (typeof arguments[1] == 'function') ? arguments[0] : {};\n\tvar callback = (typeof arguments[0] == 'function') ? arguments[0] : arguments[1];\n\treturn this.opLogSubscriptions.findSubscribe(query, {}, function(error, opLogDoc) {\n\t\tif(error)\n\t\t\tcallback(error);\n\t\telse\n\t\t\tcallback(error, opLogDoc.operation);\n\t});\n};\n\n/**\n *\n * @param [query]\n * @param subscribeCallback\n */\nOmsSubscriptions.prototype.subscribeObject = function() {\n\tvar query = (typeof arguments[1] == 'function') ? arguments[0] : {};\n\tvar callback = (typeof arguments[0] == 'function') ? arguments[0] : arguments[1];\n\treturn this.opLogSubscriptions.subscribe(query, {}, function(error, opLogDoc) {\n\t\tif(error)\n\t\t\tcallback(error);\n\t\telse\n\t\t\tcallback(error, opLogDoc.operation);\n\t});\n};\n\n/**\n *\n * @param [query]\n * @param callback\n */\nOmsSubscriptions.prototype.findSubscribe = function() {\n\tvar query = (typeof arguments[0] == 'function') ? {} : arguments[0];\n\tvar callback = (typeof arguments[0] == 'function') ? arguments[0] : arguments[1];\n\tthis.findSubscribeObject(query, function(error, operationObject) {\n\t\tif(error)\n\t\t\tcallback(error);\n\t\telse\n\t\t\tcallback.apply(this, [error, operationObject.operation].concat(OmsUtils.operationFunctionArguments(operationObject)));\n\t});\n};\n\n/**\n *\n * @param [query]\n * @param subscribeCallback\n */\nOmsSubscriptions.prototype.subscribe = function() {\n\tvar query = (typeof arguments[0] == 'function') ? {} : arguments[0];\n\tvar callback = (typeof arguments[0] == 'function') ? arguments[0] : arguments[1];\n\tthis.subscribeObject(query, function(error, operationObject) {\n\t\tif(error)\n\t\t\tcallback(error);\n\t\telse\n\t\t\tcallback.apply(this, [error, operationObject.operation].concat(OmsUtils.operationFunctionArguments(operationObject)));\n\t});\n};\n\n/**\n * Remove subscription\n * @param subscriptionId\n */\nOmsSubscriptions.prototype.unsubscribe = function(subscriptionId) {\n\treturn this.opLogSubscriptions.unsubscribe(subscriptionId);\n};\n\nmodule.exports = function(opLogSubscriptions) {\n\treturn new OmsSubscriptions(opLogSubscriptions);\n};","var FauxMongo = require('fauxmongo');\nvar OmsUtils = {};\n\n/**\n * Returns true if query matches document\n * @param doc\n * @param query\n * @returns {*}\n * @private\n */\nOmsUtils.docMatch = function(doc, query) {\n\treturn FauxMongo.matchQuery(doc, query);\n};\n\nOmsUtils.operationFunctionArguments = function(operationObject) {\n\tswitch(operationObject.operation) {\n\t\tcase 'insert':\n\t\t\treturn [operationObject.doc, operationObject.options];\n\t\t\tbreak;\n\t\tcase 'update':\n\t\t\treturn [{_id: operationObject.unmodifiedDoc._id}, operationObject.updateOperation, operationObject.options];\n\t\t\tbreak;\n\t\tcase 'remove':\n\t\t\treturn [{_id: operationObject.doc._id}, operationObject.options];\n\t\t\tbreak;\n\t\tcase 'subscribe':\n\t\t\treturn [operationObject.status, (typeof operationObject.options == 'object' && operationObject.options != null) ? operationObject.options : {}];\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('undefined_operation_type');\n\t\t\tbreak;\n\t}\n};\n\n// Return a minimum operationDoc from operation type and operation\nOmsUtils.operationDoc = function(operationObject) {\n\treturn {\n\t\tdate: new Date(),\n\t\toperation: operationObject\n\t};\n};\n\n/**\n *\n * @param operationDoc\n */\nOmsUtils.operationDocMin = function (operationDoc) {\n\treturn {\n\t\t_id: operationDoc._id,\n\t\toperation: OmsUtils.operationObjectMin(operationDoc.operation)\n\t};\n};\n\n/**\n *\n * @param operationObject\n */\nOmsUtils.operationObjectMin = function (operationObject) {\n\tswitch(operationObject.operation) {\n\t\tcase 'remove':\n\t\t\treturn {\n\t\t\t\toperation: operationObject.operation,\n\t\t\t\tdoc: {_id: operationObject.doc._id},\n\t\t\t\toptions: operationObject.options\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'update':\n\t\t\treturn {\n\t\t\t\toperation: operationObject.operation,\n\t\t\t\tunmodifiedDoc: {_id: operationObject.unmodifiedDoc._id},\n\t\t\t\tupdateOperation: operationObject.updateOperation,\n\t\t\t\toptions: operationObject.options\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'insert':\n\t\tcase 'subscribe':\n\t\tdefault:\n\t\t\treturn operationObject;\n\t\t\tbreak;\n\t}\n};\n\n// Convert emitted event args array into object\nOmsUtils.operationObject = function(operationType, operationArgs) {\n\tswitch(operationType) {\n\t\tcase 'insert':\n\t\tcase 'remove':\n\t\t\treturn {\n\t\t\t\toperation: operationType,\n\t\t\t\tdoc: operationArgs[0],\n\t\t\t\toptions: (typeof operationArgs[1] != 'object' && operationArgs[1] == null) ? {} : operationArgs[1]\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'update':\n\t\t\treturn {\n\t\t\t\toperation: operationType,\n\t\t\t\tunmodifiedDoc: operationArgs[0],\n\t\t\t\tmodifiedDoc: operationArgs[1],\n\t\t\t\tupdateOperation: operationArgs[2],\n\t\t\t\toptions: (typeof operationArgs[3] != 'object' || operationArgs[3] == null) ? {} : operationArgs[3]\n\t\t\t};\n\t\t\tbreak;\n\t\tcase 'subscribe':\n\t\t\treturn {\n\t\t\t\toperation: operationType,\n\t\t\t\tstatus: operationArgs[0],\n\t\t\t\toptions: (typeof operationArgs[1] != 'object' || operationArgs[1] == null) ? {} : operationArgs[1]\n\t\t\t};\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow new Error('undefined_operation_type');\n\t\t\tbreak;\n\t}\n};\n\nmodule.exports = OmsUtils;","// Utils module 1.0.9\nvar Utils = {};\n\nUtils.objectFilterProperties = function(object, properties) {\n\t// get specified properties of an object into a new object\n\tvar filtered = {};\n\tproperties.forEach(function(property) {\n\t\tfiltered[property] = object[property];\n\t});\n\treturn filtered;\n};\n\nUtils.objectDeepEqual = function (x, y) {\n\tif ((typeof x == \"object\" && x != null) && (typeof y == \"object\" && y != null)) {\n\t\tif (Object.keys(x).length != Object.keys(y).length)\n\t\t\treturn false;\n\n\t\tfor(var prop in x) {\n\t\t\tif(y.hasOwnProperty(prop)) {\n\t\t\t\tif (! Utils.objectDeepEqual(x[prop], y[prop]))\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\telse if(x !== y)\n\t\treturn false;\n\telse\n\t\treturn true;\n};\n\nUtils.objectContainsObject = function(containerObject, object) {\n\t// return true if all the attributes of object are in containerObject and the values of all those attributes match (using ==)\n\tfor(var property in object) { // pull keys before looping through?\n\t\tif(object.hasOwnProperty(property) && (!containerObject.hasOwnProperty(property) || containerObject[property] != object[property]))\n\t\t\treturn false;\n\t}\n\treturn true;\n};\n\nUtils.objectFilter = function(object, filter) {\n\t// filter object properties (children) using filter function\n\t// similar to array filter function\n\tvar result = {};\n\tthis.objectForEach(object, function(child, property, parent) {\n\t\tif(filter(child, property, parent))\n\t\t\tresult[property] = child;\n\t});\n\treturn result;\n};\n\n\nUtils.objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nUtils.objectGet = function(object, keys) {\n\tvar self = this;\n\tif(keys.length == 0)\n\t\treturn object;\n\telse if(typeof object === \"object\") {\n\t\tif((typeof keys[0] === \"string\" || typeof keys[0] === \"number\") && object !== null && object.hasOwnProperty(keys[0]))\n\t\t\treturn this.objectGet(object[keys[0]], keys.slice(1));\n\t\telse if(keys[0] === null) { // get all\n\t\t\tif(Array.isArray(object)) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof RegExp) { // match keys to regexp\n\t\t\tvar results = {};\n\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\tif(key.match(keys[0]))\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t});\n\t\t\treturn results;\n\t\t}\n\t\telse if(typeof keys[0] === \"function\") { // apply a filtering function\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(value, index, parent) {\n\t\t\t\t\tif(keys[0](value, index, parent)) // filter function\n\t\t\t\t\t\tresults[index] = self.objectGet(value, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilter(object, keys[0]), function(result, key) {\n\t\t\t\t\tresults[key] = self.objectGet(result, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof Array) { // all members with keys in array\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tkeys[0].forEach(function(value, index) {\n\t\t\t\t\tresults[index] = object[index];\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilterProperties(object, keys[0]), function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t}\n\telse\n\t\treturn;\n};\n\nUtils.objectSet = function(object, keys, value) {\n\tif(keys.length == 1) {\n\t\tobject[keys[0]] = value;\n\t\treturn true;\n\t}\n\telse {\n\t\tif(typeof(object[keys[0]]) === \"undefined\")\n\t\t\tobject[keys[0]] = {}; // set empty object so we can descend into it\n\t\treturn this.objectSet(object[keys[0]], keys.slice(1), value);\n\t}\n};\n\nUtils.objectIsset = function(object, keys) {\n\tif(keys.length == 1)\n\t\treturn (typeof(object[keys[0]]) !== \"undefined\");\n\telse if(typeof(object[keys[0]]) === \"undefined\") // current level doesn't exist\n\t\treturn false;\n\telse\n\t\treturn this.objectIsset(object[keys[0]], keys.slice(1));\n};\n\nUtils.objectMerge = function() {\n\tvar merged = {};\n\tthis.objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\nUtils.uniqueId = function() {\n\tfunction s4() {\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\n\t\t\t.toString(16)\n\t\t\t.substring(1);\n\t}\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n\t\ts4() + '-' + s4() + s4() + s4();\n};\n\nUtils.parseArgs = function(argsPassed, argsConfig) {\n\tvar matched = {};\n\n\tfunction toLevels(argsConfig, level) {\n\t\tif(typeof level !== 'number')\n\t\t\tlevel = 0;\n\n\t\tvar levelsArr = [];\n\n\t\targsConfig.forEach(function(argConfig) {\n\t\t\tif(Array.isArray(argConfig))\n\t\t\t\tlevelsArr = levelsArr.concat(toLevels(argConfig, level + 1));\n\t\t\telse {\n\t\t\t\targConfig.level = level;\n\t\t\t\tlevelsArr.push(argConfig);\n\t\t\t}\n\t\t});\n\n\t\treturn levelsArr;\n\t}\n\n\tfunction validArg(argConfig, arg) {\n\t\treturn typeof argConfig.validate != 'function' || argConfig.validate(arg)\n\t}\n\n\tfunction requiredLeftEnough(argsConfig, minIndex) {\n\t\tfor(var index = minIndex; index < argsConfig.length; index++) {\n\t\t\tif(typeof(argsConfig[index]) === 'undefined' || !argsConfig[index].required)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar argConfigMin = 0;\n\n\tif(!Array.isArray(argsPassed))\n\t\targsPassed = Array.prototype.slice.call(argsPassed);\n\n\targsPassed.forEach(function(arg, index) {\n\t\tfor(var ctr = argConfigMin; ctr < argsConfig.length; ctr++) {\n\t\t\tif(argsConfig[ctr].required) {\n\t\t\t\tif(validArg(argsConfig[ctr], arg)) {\n\t\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\t\targConfigMin++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthrow \"missing_required\";\n\t\t\t}\n\t\t\telse if((!argsConfig[ctr].required && (requiredLeftEnough(argsConfig, ctr) || (argsConfig[ctr].level > argsConfig[ctr - 1].level && argsConfig[ctr - 1].matched))) && validArg(argsConfig[ctr], arg)) {\n\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\targConfigMin++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targsConfig[ctr].matched = false;\n\t\t\t\targConfigMin++;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Add default options, if set\n\targsConfig.forEach(function(argConfig) {\n\t\tif(typeof matched[argConfig.name] == 'undefined' && typeof argConfig.default != 'undefined')\n\t\t\tmatched[argConfig.name] = argConfig.default;\n\t});\n\n\treturn matched;\n};\n\n// queueFunctions [, queueFunctionArgs], queueCompleteCallback [, queueIncompleteCallback] [, options]\nUtils.callbackQueue = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'queueFunctions', level: 0, validate: function(arg, allArgs) { return Array.isArray(arg); }},\n\t\t\t{name: 'queueFunctionArgs', level: 1, validate: function(arg, allArgs) { return Array.isArray(arg); }},\n\t\t\t{name: 'queueCompleteCallback', level: 0,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }},\n\t\t\t{name: 'queueNoMatchCallback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }},\n\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) === 'object'; }, default: {}}\n\t\t]\n\t);\n\n\tparsedArgs.options = Utils.objectMerge({expand: false}, parsedArgs.options);\n\n\tvar queueCompleted = false;\n\tfunction queueCompleteCallbackSafe() {\n\t\tif(!queueCompleted) {\n\t\t\tqueueCompleted = true;\n\t\t\tparsedArgs.queueCompleteCallback.apply(this, Array.prototype.slice.call(arguments));\n\t\t}\n\t}\n\n\tvar index = -1;\n\tfunction callbackQueueNext() {\n\t\tindex++;\n\t\tif(typeof parsedArgs.queueFunctions[index] === 'function') {\n\t\t\tif(Array.isArray(parsedArgs.queueFunctionArgs) && !parsedArgs.options.expand) // pass arguments to function as array// TODO add expand option\n\t\t\t\tparsedArgs.queueFunctions[index](parsedArgs.queueFunctionArgs, callbackQueueNext, queueCompleteCallbackSafe);\n\t\t\telse if(Array.isArray(parsedArgs.queueFunctionArgs) && parsedArgs.options.expand) // pass arguments to function beforre done() and next()\n\t\t\t\tparsedArgs.queueFunctions[index].apply(this, parsedArgs.queueFunctionArgs.concat([callbackQueueNext, queueCompleteCallbackSafe]));\n\t\t\telse // no arguments to pass\n\t\t\t\tparsedArgs.queueFunctions[index](callbackQueueNext, queueCompleteCallbackSafe);\n\t\t}\n\t\telse if(typeof parsedArgs.queueNoMatchCallback == 'function' && !queueCompleted)\n\t\t\tparsedArgs.queueNoMatchCallback();\n\t}\n\n\tcallbackQueueNext();\n};\n\nmodule.exports = Utils;","// shim for using process in browser\nvar process = module.exports = {};\n\n// cached from whatever global is present so that test runners that stub it\n// don't break things.  But we need to wrap it in a try catch in case it is\n// wrapped in strict mode code which doesn't define any globals.  It's inside a\n// function because try/catches deoptimize in certain engines.\n\nvar cachedSetTimeout;\nvar cachedClearTimeout;\n\nfunction defaultSetTimout() {\n    throw new Error('setTimeout has not been defined');\n}\nfunction defaultClearTimeout () {\n    throw new Error('clearTimeout has not been defined');\n}\n(function () {\n    try {\n        if (typeof setTimeout === 'function') {\n            cachedSetTimeout = setTimeout;\n        } else {\n            cachedSetTimeout = defaultSetTimout;\n        }\n    } catch (e) {\n        cachedSetTimeout = defaultSetTimout;\n    }\n    try {\n        if (typeof clearTimeout === 'function') {\n            cachedClearTimeout = clearTimeout;\n        } else {\n            cachedClearTimeout = defaultClearTimeout;\n        }\n    } catch (e) {\n        cachedClearTimeout = defaultClearTimeout;\n    }\n} ())\nfunction runTimeout(fun) {\n    if (cachedSetTimeout === setTimeout) {\n        //normal enviroments in sane situations\n        return setTimeout(fun, 0);\n    }\n    // if setTimeout wasn't available but was latter defined\n    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {\n        cachedSetTimeout = setTimeout;\n        return setTimeout(fun, 0);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedSetTimeout(fun, 0);\n    } catch(e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally\n            return cachedSetTimeout.call(null, fun, 0);\n        } catch(e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error\n            return cachedSetTimeout.call(this, fun, 0);\n        }\n    }\n\n\n}\nfunction runClearTimeout(marker) {\n    if (cachedClearTimeout === clearTimeout) {\n        //normal enviroments in sane situations\n        return clearTimeout(marker);\n    }\n    // if clearTimeout wasn't available but was latter defined\n    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {\n        cachedClearTimeout = clearTimeout;\n        return clearTimeout(marker);\n    }\n    try {\n        // when when somebody has screwed with setTimeout but no I.E. maddness\n        return cachedClearTimeout(marker);\n    } catch (e){\n        try {\n            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally\n            return cachedClearTimeout.call(null, marker);\n        } catch (e){\n            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.\n            // Some versions of I.E. have different rules for clearTimeout vs setTimeout\n            return cachedClearTimeout.call(this, marker);\n        }\n    }\n\n\n\n}\nvar queue = [];\nvar draining = false;\nvar currentQueue;\nvar queueIndex = -1;\n\nfunction cleanUpNextTick() {\n    if (!draining || !currentQueue) {\n        return;\n    }\n    draining = false;\n    if (currentQueue.length) {\n        queue = currentQueue.concat(queue);\n    } else {\n        queueIndex = -1;\n    }\n    if (queue.length) {\n        drainQueue();\n    }\n}\n\nfunction drainQueue() {\n    if (draining) {\n        return;\n    }\n    var timeout = runTimeout(cleanUpNextTick);\n    draining = true;\n\n    var len = queue.length;\n    while(len) {\n        currentQueue = queue;\n        queue = [];\n        while (++queueIndex < len) {\n            if (currentQueue) {\n                currentQueue[queueIndex].run();\n            }\n        }\n        queueIndex = -1;\n        len = queue.length;\n    }\n    currentQueue = null;\n    draining = false;\n    runClearTimeout(timeout);\n}\n\nprocess.nextTick = function (fun) {\n    var args = new Array(arguments.length - 1);\n    if (arguments.length > 1) {\n        for (var i = 1; i < arguments.length; i++) {\n            args[i - 1] = arguments[i];\n        }\n    }\n    queue.push(new Item(fun, args));\n    if (queue.length === 1 && !draining) {\n        runTimeout(drainQueue);\n    }\n};\n\n// v8 likes predictible objects\nfunction Item(fun, array) {\n    this.fun = fun;\n    this.array = array;\n}\nItem.prototype.run = function () {\n    this.fun.apply(null, this.array);\n};\nprocess.title = 'browser';\nprocess.browser = true;\nprocess.env = {};\nprocess.argv = [];\nprocess.version = ''; // empty string to avoid regexp issues\nprocess.versions = {};\n\nfunction noop() {}\n\nprocess.on = noop;\nprocess.addListener = noop;\nprocess.once = noop;\nprocess.off = noop;\nprocess.removeListener = noop;\nprocess.removeAllListeners = noop;\nprocess.emit = noop;\nprocess.prependListener = noop;\nprocess.prependOnceListener = noop;\n\nprocess.listeners = function (name) { return [] }\n\nprocess.binding = function (name) {\n    throw new Error('process.binding is not supported');\n};\n\nprocess.cwd = function () { return '/' };\nprocess.chdir = function (dir) {\n    throw new Error('process.chdir is not supported');\n};\nprocess.umask = function() { return 0; };\n","var EventEmitter = require('wolfy87-eventemitter');\n\nfunction QueueEmitter() { }\n\nQueueEmitter.prototype.__proto__ = EventEmitter.prototype;\n\n/**\n * @param event\n * @param arguments\n * @param callback\n */\nQueueEmitter.prototype.emit = function() {\n\tvar emitter = this;\n\n\tvar eventArgs = Array.prototype.slice.call(arguments);\n\tvar eventName = eventArgs.shift(); // first argument\n\tvar completeCallback = eventArgs.pop(); // last argument\n\n\t// Get all subscribed functions\n\tvar listenersConfig = emitter.getListeners(eventName);\n\tvar listenersFns = [];\n\tlistenersConfig.forEach(function(listenerConfig) {\n\t\tlistenersFns.push(listenerConfig.listener);\n\t});\n\n\tthis._callbackQueue(\n\t\tlistenersFns,\n\t\teventArgs,\n\t\tfunction(error) {\n\t\t\t// callback queue completed\n\t\t\t// remove 'once' callbacks\n\t\t\tlistenersConfig.filter(function(listenerConfig) {\n\t\t\t\treturn listenerConfig.once; // remove functions whose 'once' attribute is true\n\t\t\t}).forEach(function (listenerConfig) {\n\t\t\t\temitter.off(eventName, listenerConfig.listener);\n\t\t\t});\n\n\t\t\tif(typeof completeCallback == 'function')\n\t\t\t\tcompleteCallback(typeof error == 'undefined' ? null : error); // callback with an error, if any\n\t\t}\n\t);\n};\n\n/**\n *\n * @param queueFunctions\n * @param queueFunctionArgs\n * @param queueComplete\n * @private\n */\nQueueEmitter.prototype._callbackQueue = function(queueFunctions, queueFunctionArgs, queueComplete) {\n\tvar index = -1;\n\tfunction queueFunctionComplete(error) {\n\t\tindex++;\n\t\tif(typeof error != 'undefined' || typeof queueFunctions[index] != 'function') // reached end of queue or function in queue returned an error\n\t\t\tqueueComplete(error);\n\t\telse\n\t\t\tqueueFunctions[index].apply(this, queueFunctionArgs.concat([queueFunctionComplete]));\n\t}\n\tqueueFunctionComplete();\n};\n\nmodule.exports = QueueEmitter;","if (typeof Object.create === 'function') {\n  // implementation from standard node.js 'util' module\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    ctor.prototype = Object.create(superCtor.prototype, {\n      constructor: {\n        value: ctor,\n        enumerable: false,\n        writable: true,\n        configurable: true\n      }\n    });\n  };\n} else {\n  // old school shim for old browsers\n  module.exports = function inherits(ctor, superCtor) {\n    ctor.super_ = superCtor\n    var TempCtor = function () {}\n    TempCtor.prototype = superCtor.prototype\n    ctor.prototype = new TempCtor()\n    ctor.prototype.constructor = ctor\n  }\n}\n","module.exports = function isBuffer(arg) {\n  return arg && typeof arg === 'object'\n    && typeof arg.copy === 'function'\n    && typeof arg.fill === 'function'\n    && typeof arg.readUInt8 === 'function';\n}","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nvar formatRegExp = /%[sdj%]/g;\nexports.format = function(f) {\n  if (!isString(f)) {\n    var objects = [];\n    for (var i = 0; i < arguments.length; i++) {\n      objects.push(inspect(arguments[i]));\n    }\n    return objects.join(' ');\n  }\n\n  var i = 1;\n  var args = arguments;\n  var len = args.length;\n  var str = String(f).replace(formatRegExp, function(x) {\n    if (x === '%%') return '%';\n    if (i >= len) return x;\n    switch (x) {\n      case '%s': return String(args[i++]);\n      case '%d': return Number(args[i++]);\n      case '%j':\n        try {\n          return JSON.stringify(args[i++]);\n        } catch (_) {\n          return '[Circular]';\n        }\n      default:\n        return x;\n    }\n  });\n  for (var x = args[i]; i < len; x = args[++i]) {\n    if (isNull(x) || !isObject(x)) {\n      str += ' ' + x;\n    } else {\n      str += ' ' + inspect(x);\n    }\n  }\n  return str;\n};\n\n\n// Mark that a method should not be used.\n// Returns a modified function which warns once by default.\n// If --no-deprecation is set, then it is a no-op.\nexports.deprecate = function(fn, msg) {\n  // Allow for deprecating things in the process of starting up.\n  if (isUndefined(global.process)) {\n    return function() {\n      return exports.deprecate(fn, msg).apply(this, arguments);\n    };\n  }\n\n  if (process.noDeprecation === true) {\n    return fn;\n  }\n\n  var warned = false;\n  function deprecated() {\n    if (!warned) {\n      if (process.throwDeprecation) {\n        throw new Error(msg);\n      } else if (process.traceDeprecation) {\n        console.trace(msg);\n      } else {\n        console.error(msg);\n      }\n      warned = true;\n    }\n    return fn.apply(this, arguments);\n  }\n\n  return deprecated;\n};\n\n\nvar debugs = {};\nvar debugEnviron;\nexports.debuglog = function(set) {\n  if (isUndefined(debugEnviron))\n    debugEnviron = process.env.NODE_DEBUG || '';\n  set = set.toUpperCase();\n  if (!debugs[set]) {\n    if (new RegExp('\\\\b' + set + '\\\\b', 'i').test(debugEnviron)) {\n      var pid = process.pid;\n      debugs[set] = function() {\n        var msg = exports.format.apply(exports, arguments);\n        console.error('%s %d: %s', set, pid, msg);\n      };\n    } else {\n      debugs[set] = function() {};\n    }\n  }\n  return debugs[set];\n};\n\n\n/**\n * Echos the value of a value. Trys to print the value out\n * in the best way possible given the different types.\n *\n * @param {Object} obj The object to print out.\n * @param {Object} opts Optional options object that alters the output.\n */\n/* legacy: obj, showHidden, depth, colors*/\nfunction inspect(obj, opts) {\n  // default options\n  var ctx = {\n    seen: [],\n    stylize: stylizeNoColor\n  };\n  // legacy...\n  if (arguments.length >= 3) ctx.depth = arguments[2];\n  if (arguments.length >= 4) ctx.colors = arguments[3];\n  if (isBoolean(opts)) {\n    // legacy...\n    ctx.showHidden = opts;\n  } else if (opts) {\n    // got an \"options\" object\n    exports._extend(ctx, opts);\n  }\n  // set default options\n  if (isUndefined(ctx.showHidden)) ctx.showHidden = false;\n  if (isUndefined(ctx.depth)) ctx.depth = 2;\n  if (isUndefined(ctx.colors)) ctx.colors = false;\n  if (isUndefined(ctx.customInspect)) ctx.customInspect = true;\n  if (ctx.colors) ctx.stylize = stylizeWithColor;\n  return formatValue(ctx, obj, ctx.depth);\n}\nexports.inspect = inspect;\n\n\n// http://en.wikipedia.org/wiki/ANSI_escape_code#graphics\ninspect.colors = {\n  'bold' : [1, 22],\n  'italic' : [3, 23],\n  'underline' : [4, 24],\n  'inverse' : [7, 27],\n  'white' : [37, 39],\n  'grey' : [90, 39],\n  'black' : [30, 39],\n  'blue' : [34, 39],\n  'cyan' : [36, 39],\n  'green' : [32, 39],\n  'magenta' : [35, 39],\n  'red' : [31, 39],\n  'yellow' : [33, 39]\n};\n\n// Don't use 'blue' not visible on cmd.exe\ninspect.styles = {\n  'special': 'cyan',\n  'number': 'yellow',\n  'boolean': 'yellow',\n  'undefined': 'grey',\n  'null': 'bold',\n  'string': 'green',\n  'date': 'magenta',\n  // \"name\": intentionally not styling\n  'regexp': 'red'\n};\n\n\nfunction stylizeWithColor(str, styleType) {\n  var style = inspect.styles[styleType];\n\n  if (style) {\n    return '\\u001b[' + inspect.colors[style][0] + 'm' + str +\n           '\\u001b[' + inspect.colors[style][1] + 'm';\n  } else {\n    return str;\n  }\n}\n\n\nfunction stylizeNoColor(str, styleType) {\n  return str;\n}\n\n\nfunction arrayToHash(array) {\n  var hash = {};\n\n  array.forEach(function(val, idx) {\n    hash[val] = true;\n  });\n\n  return hash;\n}\n\n\nfunction formatValue(ctx, value, recurseTimes) {\n  // Provide a hook for user-specified inspect functions.\n  // Check that value is an object with an inspect function on it\n  if (ctx.customInspect &&\n      value &&\n      isFunction(value.inspect) &&\n      // Filter out the util module, it's inspect function is special\n      value.inspect !== exports.inspect &&\n      // Also filter out any prototype objects using the circular check.\n      !(value.constructor && value.constructor.prototype === value)) {\n    var ret = value.inspect(recurseTimes, ctx);\n    if (!isString(ret)) {\n      ret = formatValue(ctx, ret, recurseTimes);\n    }\n    return ret;\n  }\n\n  // Primitive types cannot have properties\n  var primitive = formatPrimitive(ctx, value);\n  if (primitive) {\n    return primitive;\n  }\n\n  // Look up the keys of the object.\n  var keys = Object.keys(value);\n  var visibleKeys = arrayToHash(keys);\n\n  if (ctx.showHidden) {\n    keys = Object.getOwnPropertyNames(value);\n  }\n\n  // IE doesn't make error fields non-enumerable\n  // http://msdn.microsoft.com/en-us/library/ie/dww52sbt(v=vs.94).aspx\n  if (isError(value)\n      && (keys.indexOf('message') >= 0 || keys.indexOf('description') >= 0)) {\n    return formatError(value);\n  }\n\n  // Some type of object without properties can be shortcutted.\n  if (keys.length === 0) {\n    if (isFunction(value)) {\n      var name = value.name ? ': ' + value.name : '';\n      return ctx.stylize('[Function' + name + ']', 'special');\n    }\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    }\n    if (isDate(value)) {\n      return ctx.stylize(Date.prototype.toString.call(value), 'date');\n    }\n    if (isError(value)) {\n      return formatError(value);\n    }\n  }\n\n  var base = '', array = false, braces = ['{', '}'];\n\n  // Make Array say that they are Array\n  if (isArray(value)) {\n    array = true;\n    braces = ['[', ']'];\n  }\n\n  // Make functions say that they are functions\n  if (isFunction(value)) {\n    var n = value.name ? ': ' + value.name : '';\n    base = ' [Function' + n + ']';\n  }\n\n  // Make RegExps say that they are RegExps\n  if (isRegExp(value)) {\n    base = ' ' + RegExp.prototype.toString.call(value);\n  }\n\n  // Make dates with properties first say the date\n  if (isDate(value)) {\n    base = ' ' + Date.prototype.toUTCString.call(value);\n  }\n\n  // Make error with message first say the error\n  if (isError(value)) {\n    base = ' ' + formatError(value);\n  }\n\n  if (keys.length === 0 && (!array || value.length == 0)) {\n    return braces[0] + base + braces[1];\n  }\n\n  if (recurseTimes < 0) {\n    if (isRegExp(value)) {\n      return ctx.stylize(RegExp.prototype.toString.call(value), 'regexp');\n    } else {\n      return ctx.stylize('[Object]', 'special');\n    }\n  }\n\n  ctx.seen.push(value);\n\n  var output;\n  if (array) {\n    output = formatArray(ctx, value, recurseTimes, visibleKeys, keys);\n  } else {\n    output = keys.map(function(key) {\n      return formatProperty(ctx, value, recurseTimes, visibleKeys, key, array);\n    });\n  }\n\n  ctx.seen.pop();\n\n  return reduceToSingleString(output, base, braces);\n}\n\n\nfunction formatPrimitive(ctx, value) {\n  if (isUndefined(value))\n    return ctx.stylize('undefined', 'undefined');\n  if (isString(value)) {\n    var simple = '\\'' + JSON.stringify(value).replace(/^\"|\"$/g, '')\n                                             .replace(/'/g, \"\\\\'\")\n                                             .replace(/\\\\\"/g, '\"') + '\\'';\n    return ctx.stylize(simple, 'string');\n  }\n  if (isNumber(value))\n    return ctx.stylize('' + value, 'number');\n  if (isBoolean(value))\n    return ctx.stylize('' + value, 'boolean');\n  // For some reason typeof null is \"object\", so special case here.\n  if (isNull(value))\n    return ctx.stylize('null', 'null');\n}\n\n\nfunction formatError(value) {\n  return '[' + Error.prototype.toString.call(value) + ']';\n}\n\n\nfunction formatArray(ctx, value, recurseTimes, visibleKeys, keys) {\n  var output = [];\n  for (var i = 0, l = value.length; i < l; ++i) {\n    if (hasOwnProperty(value, String(i))) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          String(i), true));\n    } else {\n      output.push('');\n    }\n  }\n  keys.forEach(function(key) {\n    if (!key.match(/^\\d+$/)) {\n      output.push(formatProperty(ctx, value, recurseTimes, visibleKeys,\n          key, true));\n    }\n  });\n  return output;\n}\n\n\nfunction formatProperty(ctx, value, recurseTimes, visibleKeys, key, array) {\n  var name, str, desc;\n  desc = Object.getOwnPropertyDescriptor(value, key) || { value: value[key] };\n  if (desc.get) {\n    if (desc.set) {\n      str = ctx.stylize('[Getter/Setter]', 'special');\n    } else {\n      str = ctx.stylize('[Getter]', 'special');\n    }\n  } else {\n    if (desc.set) {\n      str = ctx.stylize('[Setter]', 'special');\n    }\n  }\n  if (!hasOwnProperty(visibleKeys, key)) {\n    name = '[' + key + ']';\n  }\n  if (!str) {\n    if (ctx.seen.indexOf(desc.value) < 0) {\n      if (isNull(recurseTimes)) {\n        str = formatValue(ctx, desc.value, null);\n      } else {\n        str = formatValue(ctx, desc.value, recurseTimes - 1);\n      }\n      if (str.indexOf('\\n') > -1) {\n        if (array) {\n          str = str.split('\\n').map(function(line) {\n            return '  ' + line;\n          }).join('\\n').substr(2);\n        } else {\n          str = '\\n' + str.split('\\n').map(function(line) {\n            return '   ' + line;\n          }).join('\\n');\n        }\n      }\n    } else {\n      str = ctx.stylize('[Circular]', 'special');\n    }\n  }\n  if (isUndefined(name)) {\n    if (array && key.match(/^\\d+$/)) {\n      return str;\n    }\n    name = JSON.stringify('' + key);\n    if (name.match(/^\"([a-zA-Z_][a-zA-Z_0-9]*)\"$/)) {\n      name = name.substr(1, name.length - 2);\n      name = ctx.stylize(name, 'name');\n    } else {\n      name = name.replace(/'/g, \"\\\\'\")\n                 .replace(/\\\\\"/g, '\"')\n                 .replace(/(^\"|\"$)/g, \"'\");\n      name = ctx.stylize(name, 'string');\n    }\n  }\n\n  return name + ': ' + str;\n}\n\n\nfunction reduceToSingleString(output, base, braces) {\n  var numLinesEst = 0;\n  var length = output.reduce(function(prev, cur) {\n    numLinesEst++;\n    if (cur.indexOf('\\n') >= 0) numLinesEst++;\n    return prev + cur.replace(/\\u001b\\[\\d\\d?m/g, '').length + 1;\n  }, 0);\n\n  if (length > 60) {\n    return braces[0] +\n           (base === '' ? '' : base + '\\n ') +\n           ' ' +\n           output.join(',\\n  ') +\n           ' ' +\n           braces[1];\n  }\n\n  return braces[0] + base + ' ' + output.join(', ') + ' ' + braces[1];\n}\n\n\n// NOTE: These type checking functions intentionally don't use `instanceof`\n// because it is fragile and can be easily faked with `Object.create()`.\nfunction isArray(ar) {\n  return Array.isArray(ar);\n}\nexports.isArray = isArray;\n\nfunction isBoolean(arg) {\n  return typeof arg === 'boolean';\n}\nexports.isBoolean = isBoolean;\n\nfunction isNull(arg) {\n  return arg === null;\n}\nexports.isNull = isNull;\n\nfunction isNullOrUndefined(arg) {\n  return arg == null;\n}\nexports.isNullOrUndefined = isNullOrUndefined;\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\nexports.isNumber = isNumber;\n\nfunction isString(arg) {\n  return typeof arg === 'string';\n}\nexports.isString = isString;\n\nfunction isSymbol(arg) {\n  return typeof arg === 'symbol';\n}\nexports.isSymbol = isSymbol;\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\nexports.isUndefined = isUndefined;\n\nfunction isRegExp(re) {\n  return isObject(re) && objectToString(re) === '[object RegExp]';\n}\nexports.isRegExp = isRegExp;\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\nexports.isObject = isObject;\n\nfunction isDate(d) {\n  return isObject(d) && objectToString(d) === '[object Date]';\n}\nexports.isDate = isDate;\n\nfunction isError(e) {\n  return isObject(e) &&\n      (objectToString(e) === '[object Error]' || e instanceof Error);\n}\nexports.isError = isError;\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\nexports.isFunction = isFunction;\n\nfunction isPrimitive(arg) {\n  return arg === null ||\n         typeof arg === 'boolean' ||\n         typeof arg === 'number' ||\n         typeof arg === 'string' ||\n         typeof arg === 'symbol' ||  // ES6 symbol\n         typeof arg === 'undefined';\n}\nexports.isPrimitive = isPrimitive;\n\nexports.isBuffer = require('./support/isBuffer');\n\nfunction objectToString(o) {\n  return Object.prototype.toString.call(o);\n}\n\n\nfunction pad(n) {\n  return n < 10 ? '0' + n.toString(10) : n.toString(10);\n}\n\n\nvar months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep',\n              'Oct', 'Nov', 'Dec'];\n\n// 26 Feb 16:19:34\nfunction timestamp() {\n  var d = new Date();\n  var time = [pad(d.getHours()),\n              pad(d.getMinutes()),\n              pad(d.getSeconds())].join(':');\n  return [d.getDate(), months[d.getMonth()], time].join(' ');\n}\n\n\n// log is just a thin wrapper to console.log that prepends a timestamp\nexports.log = function() {\n  console.log('%s - %s', timestamp(), exports.format.apply(exports, arguments));\n};\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * The Function.prototype.inherits from lang.js rewritten as a standalone\n * function (not on Function.prototype). NOTE: If this file is to be loaded\n * during bootstrapping this function needs to be rewritten using some native\n * functions as prototype setup using normal JavaScript does not work as\n * expected during bootstrapping (see mirror.js in r114903).\n *\n * @param {function} ctor Constructor function which needs to inherit the\n *     prototype.\n * @param {function} superCtor Constructor function to inherit prototype from.\n */\nexports.inherits = require('inherits');\n\nexports._extend = function(origin, add) {\n  // Don't do anything if add isn't an object\n  if (!add || !isObject(add)) return origin;\n\n  var keys = Object.keys(add);\n  var i = keys.length;\n  while (i--) {\n    origin[keys[i]] = add[keys[i]];\n  }\n  return origin;\n};\n\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n","/*!\n * EventEmitter v5.1.0 - git.io/ee\n * Unlicense - http://unlicense.org/\n * Oliver Caldwell - http://oli.me.uk/\n * @preserve\n */\n\n;(function (exports) {\n    'use strict';\n\n    /**\n     * Class for managing events.\n     * Can be extended to provide event functionality in other classes.\n     *\n     * @class EventEmitter Manages event registering and emitting.\n     */\n    function EventEmitter() {}\n\n    // Shortcuts to improve speed and size\n    var proto = EventEmitter.prototype;\n    var originalGlobalValue = exports.EventEmitter;\n\n    /**\n     * Finds the index of the listener for the event in its storage array.\n     *\n     * @param {Function[]} listeners Array of listeners to search through.\n     * @param {Function} listener Method to look for.\n     * @return {Number} Index of the specified listener, -1 if not found\n     * @api private\n     */\n    function indexOfListener(listeners, listener) {\n        var i = listeners.length;\n        while (i--) {\n            if (listeners[i].listener === listener) {\n                return i;\n            }\n        }\n\n        return -1;\n    }\n\n    /**\n     * Alias a method while keeping the context correct, to allow for overwriting of target method.\n     *\n     * @param {String} name The name of the target method.\n     * @return {Function} The aliased method\n     * @api private\n     */\n    function alias(name) {\n        return function aliasClosure() {\n            return this[name].apply(this, arguments);\n        };\n    }\n\n    /**\n     * Returns the listener array for the specified event.\n     * Will initialise the event object and listener arrays if required.\n     * Will return an object if you use a regex search. The object contains keys for each matched event. So /ba[rz]/ might return an object containing bar and baz. But only if you have either defined them with defineEvent or added some listeners to them.\n     * Each property in the object response is an array of listener functions.\n     *\n     * @param {String|RegExp} evt Name of the event to return the listeners from.\n     * @return {Function[]|Object} All listener functions for the event.\n     */\n    proto.getListeners = function getListeners(evt) {\n        var events = this._getEvents();\n        var response;\n        var key;\n\n        // Return a concatenated array of all matching events if\n        // the selector is a regular expression.\n        if (evt instanceof RegExp) {\n            response = {};\n            for (key in events) {\n                if (events.hasOwnProperty(key) && evt.test(key)) {\n                    response[key] = events[key];\n                }\n            }\n        }\n        else {\n            response = events[evt] || (events[evt] = []);\n        }\n\n        return response;\n    };\n\n    /**\n     * Takes a list of listener objects and flattens it into a list of listener functions.\n     *\n     * @param {Object[]} listeners Raw listener objects.\n     * @return {Function[]} Just the listener functions.\n     */\n    proto.flattenListeners = function flattenListeners(listeners) {\n        var flatListeners = [];\n        var i;\n\n        for (i = 0; i < listeners.length; i += 1) {\n            flatListeners.push(listeners[i].listener);\n        }\n\n        return flatListeners;\n    };\n\n    /**\n     * Fetches the requested listeners via getListeners but will always return the results inside an object. This is mainly for internal use but others may find it useful.\n     *\n     * @param {String|RegExp} evt Name of the event to return the listeners from.\n     * @return {Object} All listener functions for an event in an object.\n     */\n    proto.getListenersAsObject = function getListenersAsObject(evt) {\n        var listeners = this.getListeners(evt);\n        var response;\n\n        if (listeners instanceof Array) {\n            response = {};\n            response[evt] = listeners;\n        }\n\n        return response || listeners;\n    };\n\n    function isValidListener (listener) {\n        if (typeof listener === 'function' || listener instanceof RegExp) {\n            return true\n        } else if (listener && typeof listener === 'object') {\n            return isValidListener(listener.listener)\n        } else {\n            return false\n        }\n    }\n\n    /**\n     * Adds a listener function to the specified event.\n     * The listener will not be added if it is a duplicate.\n     * If the listener returns true then it will be removed after it is called.\n     * If you pass a regular expression as the event name then the listener will be added to all events that match it.\n     *\n     * @param {String|RegExp} evt Name of the event to attach the listener to.\n     * @param {Function} listener Method to be called when the event is emitted. If the function returns true then it will be removed after calling.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.addListener = function addListener(evt, listener) {\n        if (!isValidListener(listener)) {\n            throw new TypeError('listener must be a function');\n        }\n\n        var listeners = this.getListenersAsObject(evt);\n        var listenerIsWrapped = typeof listener === 'object';\n        var key;\n\n        for (key in listeners) {\n            if (listeners.hasOwnProperty(key) && indexOfListener(listeners[key], listener) === -1) {\n                listeners[key].push(listenerIsWrapped ? listener : {\n                    listener: listener,\n                    once: false\n                });\n            }\n        }\n\n        return this;\n    };\n\n    /**\n     * Alias of addListener\n     */\n    proto.on = alias('addListener');\n\n    /**\n     * Semi-alias of addListener. It will add a listener that will be\n     * automatically removed after its first execution.\n     *\n     * @param {String|RegExp} evt Name of the event to attach the listener to.\n     * @param {Function} listener Method to be called when the event is emitted. If the function returns true then it will be removed after calling.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.addOnceListener = function addOnceListener(evt, listener) {\n        return this.addListener(evt, {\n            listener: listener,\n            once: true\n        });\n    };\n\n    /**\n     * Alias of addOnceListener.\n     */\n    proto.once = alias('addOnceListener');\n\n    /**\n     * Defines an event name. This is required if you want to use a regex to add a listener to multiple events at once. If you don't do this then how do you expect it to know what event to add to? Should it just add to every possible match for a regex? No. That is scary and bad.\n     * You need to tell it what event names should be matched by a regex.\n     *\n     * @param {String} evt Name of the event to create.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.defineEvent = function defineEvent(evt) {\n        this.getListeners(evt);\n        return this;\n    };\n\n    /**\n     * Uses defineEvent to define multiple events.\n     *\n     * @param {String[]} evts An array of event names to define.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.defineEvents = function defineEvents(evts) {\n        for (var i = 0; i < evts.length; i += 1) {\n            this.defineEvent(evts[i]);\n        }\n        return this;\n    };\n\n    /**\n     * Removes a listener function from the specified event.\n     * When passed a regular expression as the event name, it will remove the listener from all events that match it.\n     *\n     * @param {String|RegExp} evt Name of the event to remove the listener from.\n     * @param {Function} listener Method to remove from the event.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.removeListener = function removeListener(evt, listener) {\n        var listeners = this.getListenersAsObject(evt);\n        var index;\n        var key;\n\n        for (key in listeners) {\n            if (listeners.hasOwnProperty(key)) {\n                index = indexOfListener(listeners[key], listener);\n\n                if (index !== -1) {\n                    listeners[key].splice(index, 1);\n                }\n            }\n        }\n\n        return this;\n    };\n\n    /**\n     * Alias of removeListener\n     */\n    proto.off = alias('removeListener');\n\n    /**\n     * Adds listeners in bulk using the manipulateListeners method.\n     * If you pass an object as the second argument you can add to multiple events at once. The object should contain key value pairs of events and listeners or listener arrays. You can also pass it an event name and an array of listeners to be added.\n     * You can also pass it a regular expression to add the array of listeners to all events that match it.\n     * Yeah, this function does quite a bit. That's probably a bad thing.\n     *\n     * @param {String|Object|RegExp} evt An event name if you will pass an array of listeners next. An object if you wish to add to multiple events at once.\n     * @param {Function[]} [listeners] An optional array of listener functions to add.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.addListeners = function addListeners(evt, listeners) {\n        // Pass through to manipulateListeners\n        return this.manipulateListeners(false, evt, listeners);\n    };\n\n    /**\n     * Removes listeners in bulk using the manipulateListeners method.\n     * If you pass an object as the second argument you can remove from multiple events at once. The object should contain key value pairs of events and listeners or listener arrays.\n     * You can also pass it an event name and an array of listeners to be removed.\n     * You can also pass it a regular expression to remove the listeners from all events that match it.\n     *\n     * @param {String|Object|RegExp} evt An event name if you will pass an array of listeners next. An object if you wish to remove from multiple events at once.\n     * @param {Function[]} [listeners] An optional array of listener functions to remove.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.removeListeners = function removeListeners(evt, listeners) {\n        // Pass through to manipulateListeners\n        return this.manipulateListeners(true, evt, listeners);\n    };\n\n    /**\n     * Edits listeners in bulk. The addListeners and removeListeners methods both use this to do their job. You should really use those instead, this is a little lower level.\n     * The first argument will determine if the listeners are removed (true) or added (false).\n     * If you pass an object as the second argument you can add/remove from multiple events at once. The object should contain key value pairs of events and listeners or listener arrays.\n     * You can also pass it an event name and an array of listeners to be added/removed.\n     * You can also pass it a regular expression to manipulate the listeners of all events that match it.\n     *\n     * @param {Boolean} remove True if you want to remove listeners, false if you want to add.\n     * @param {String|Object|RegExp} evt An event name if you will pass an array of listeners next. An object if you wish to add/remove from multiple events at once.\n     * @param {Function[]} [listeners] An optional array of listener functions to add/remove.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.manipulateListeners = function manipulateListeners(remove, evt, listeners) {\n        var i;\n        var value;\n        var single = remove ? this.removeListener : this.addListener;\n        var multiple = remove ? this.removeListeners : this.addListeners;\n\n        // If evt is an object then pass each of its properties to this method\n        if (typeof evt === 'object' && !(evt instanceof RegExp)) {\n            for (i in evt) {\n                if (evt.hasOwnProperty(i) && (value = evt[i])) {\n                    // Pass the single listener straight through to the singular method\n                    if (typeof value === 'function') {\n                        single.call(this, i, value);\n                    }\n                    else {\n                        // Otherwise pass back to the multiple function\n                        multiple.call(this, i, value);\n                    }\n                }\n            }\n        }\n        else {\n            // So evt must be a string\n            // And listeners must be an array of listeners\n            // Loop over it and pass each one to the multiple method\n            i = listeners.length;\n            while (i--) {\n                single.call(this, evt, listeners[i]);\n            }\n        }\n\n        return this;\n    };\n\n    /**\n     * Removes all listeners from a specified event.\n     * If you do not specify an event then all listeners will be removed.\n     * That means every event will be emptied.\n     * You can also pass a regex to remove all events that match it.\n     *\n     * @param {String|RegExp} [evt] Optional name of the event to remove all listeners for. Will remove from every event if not passed.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.removeEvent = function removeEvent(evt) {\n        var type = typeof evt;\n        var events = this._getEvents();\n        var key;\n\n        // Remove different things depending on the state of evt\n        if (type === 'string') {\n            // Remove all listeners for the specified event\n            delete events[evt];\n        }\n        else if (evt instanceof RegExp) {\n            // Remove all events matching the regex.\n            for (key in events) {\n                if (events.hasOwnProperty(key) && evt.test(key)) {\n                    delete events[key];\n                }\n            }\n        }\n        else {\n            // Remove all listeners in all events\n            delete this._events;\n        }\n\n        return this;\n    };\n\n    /**\n     * Alias of removeEvent.\n     *\n     * Added to mirror the node API.\n     */\n    proto.removeAllListeners = alias('removeEvent');\n\n    /**\n     * Emits an event of your choice.\n     * When emitted, every listener attached to that event will be executed.\n     * If you pass the optional argument array then those arguments will be passed to every listener upon execution.\n     * Because it uses `apply`, your array of arguments will be passed as if you wrote them out separately.\n     * So they will not arrive within the array on the other side, they will be separate.\n     * You can also pass a regular expression to emit to all events that match it.\n     *\n     * @param {String|RegExp} evt Name of the event to emit and execute listeners for.\n     * @param {Array} [args] Optional array of arguments to be passed to each listener.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.emitEvent = function emitEvent(evt, args) {\n        var listenersMap = this.getListenersAsObject(evt);\n        var listeners;\n        var listener;\n        var i;\n        var key;\n        var response;\n\n        for (key in listenersMap) {\n            if (listenersMap.hasOwnProperty(key)) {\n                listeners = listenersMap[key].slice(0);\n\n                for (i = 0; i < listeners.length; i++) {\n                    // If the listener returns true then it shall be removed from the event\n                    // The function is executed either with a basic call or an apply if there is an args array\n                    listener = listeners[i];\n\n                    if (listener.once === true) {\n                        this.removeListener(evt, listener.listener);\n                    }\n\n                    response = listener.listener.apply(this, args || []);\n\n                    if (response === this._getOnceReturnValue()) {\n                        this.removeListener(evt, listener.listener);\n                    }\n                }\n            }\n        }\n\n        return this;\n    };\n\n    /**\n     * Alias of emitEvent\n     */\n    proto.trigger = alias('emitEvent');\n\n    /**\n     * Subtly different from emitEvent in that it will pass its arguments on to the listeners, as opposed to taking a single array of arguments to pass on.\n     * As with emitEvent, you can pass a regex in place of the event name to emit to all events that match it.\n     *\n     * @param {String|RegExp} evt Name of the event to emit and execute listeners for.\n     * @param {...*} Optional additional arguments to be passed to each listener.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.emit = function emit(evt) {\n        var args = Array.prototype.slice.call(arguments, 1);\n        return this.emitEvent(evt, args);\n    };\n\n    /**\n     * Sets the current value to check against when executing listeners. If a\n     * listeners return value matches the one set here then it will be removed\n     * after execution. This value defaults to true.\n     *\n     * @param {*} value The new value to check for when executing listeners.\n     * @return {Object} Current instance of EventEmitter for chaining.\n     */\n    proto.setOnceReturnValue = function setOnceReturnValue(value) {\n        this._onceReturnValue = value;\n        return this;\n    };\n\n    /**\n     * Fetches the current value to check against when executing listeners. If\n     * the listeners return value matches this one then it should be removed\n     * automatically. It will return true by default.\n     *\n     * @return {*|Boolean} The current value to check for or the default, true.\n     * @api private\n     */\n    proto._getOnceReturnValue = function _getOnceReturnValue() {\n        if (this.hasOwnProperty('_onceReturnValue')) {\n            return this._onceReturnValue;\n        }\n        else {\n            return true;\n        }\n    };\n\n    /**\n     * Fetches the events object and creates one if required.\n     *\n     * @return {Object} The events storage object.\n     * @api private\n     */\n    proto._getEvents = function _getEvents() {\n        return this._events || (this._events = {});\n    };\n\n    /**\n     * Reverts the global {@link EventEmitter} to its previous value and returns a reference to this version.\n     *\n     * @return {Function} Non conflicting EventEmitter class.\n     */\n    EventEmitter.noConflict = function noConflict() {\n        exports.EventEmitter = originalGlobalValue;\n        return EventEmitter;\n    };\n\n    // Expose the class either via AMD, CommonJS or the global object\n    if (typeof define === 'function' && define.amd) {\n        define(function () {\n            return EventEmitter;\n        });\n    }\n    else if (typeof module === 'object' && module.exports){\n        module.exports = EventEmitter;\n    }\n    else {\n        exports.EventEmitter = EventEmitter;\n    }\n}(this || {}));\n","var Utils = require('./Utils');\nvar ApiBuilder = require('agnostic-router-api-builder');\nvar apiConfig = require('./apiConfig');\n\nfunction DnsClient(dnsDb, rpc, config) {\n\tvar self = this;\n\n\tself._dnsDb = dnsDb;\n\tself._rpc = rpc;\n\tself._dnsServerAddress = config.dnsServer;\n\tself._apiBasePath = config.apiPath;\n\n\tself._remoteApiObject = ApiBuilder.toObject(apiConfig, function(functionName, apiPath, request, completeCallback) {\n\t\tself._rpc.request(self._dnsServerAddress, self._apiBasePath + apiPath, request.query, typeof apiConfig[functionName].requestOptions == 'object' ? apiConfig[functionName].requestOptions : {}, completeCallback);\n\t});\n\n\tUtils.objectForEach(self._remoteApiObject, function(functionConfig, functionName) {\n\t\tif(typeof self[functionName] != 'function') {\n\t\t\tself[functionName] = function() {\n\t\t\t\tif(typeof self._dnsServerAddress == 'string')\n\t\t\t\t\tself._remoteApiObject[functionName].apply(self._remoteApiObject, Array.prototype.slice.call(arguments));\n\t\t\t\telse\n\t\t\t\t\tself._dnsDb[functionName].apply(self._dnsDb, Array.prototype.slice.call(arguments));\n\t\t\t};\n\t\t}\n\t});\n}\n\nDnsClient.prototype.subscribeToGroup = function() {\n\tvar self = this;\n\tif(typeof self._dnsServerAddress == 'string') { // Only intercept if remote server\n\t\tvar argsArrayPass = Array.prototype.slice.call(arguments);\n\n\t\tvar completeCallback = argsArrayPass.pop();\n\t\tvar interceptCallback = function(error, operationDoc) {\n\t\t\tif(error == null)\n\t\t\t\tself._dnsDb.groupsOplog.applyOp(operationDoc);\n\t\t\tcompleteCallback(error, operationDoc);\n\t\t};\n\n\t\tself._remoteApiObject.subscribeToGroup.apply(self._remoteApiObject, argsArrayPass.concat([interceptCallback]));\n\t}\n\telse {\n\t\tself._dnsDb.subscribeToGroup.apply(self._dnsDb, Array.prototype.slice.call(arguments));\n\t}\n};\n\n// Override groupAddresses to add subscribe option\nDnsClient.prototype.groupAddresses = function() {\n\tvar self = this;\n\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'groupName', required: true, level: 0, type: 'string'},\n\t\t\t{name: 'options', level: 1, type: 'object', default: {}},\n\t\t\t{name: 'callback', required: true, level: 0,  type: 'function'}\n\t\t]\n\t);\n\n\tvar defaultOptions = {\n\t\tgroupLookup: true,\n\t\tgroupSubscribe: false\n\t};\n\n\tparsedArgs.options = Utils.objectMerge(defaultOptions, parsedArgs.options);\n\n\tself._dnsDb.groupAddresses(parsedArgs.groupName, function(error, result) {\n\t\tif(!error || !parsedArgs.options.groupLookup || typeof self._dnsServerAddress != 'string') // Result returned or don't lookup\n\t\t\tparsedArgs.callback(error, result);\n\t\telse if(parsedArgs.options.groupSubscribe) { // Subscribe to remote group\n\t\t\tself.subscribeToGroup(parsedArgs.groupName, function(error, opLogDoc) {\n\t\t\t\tif(error)\n\t\t\t\t\tparsedArgs.callback(error, null);\n\t\t\t\telse if(Utils.objectGet(opLogDoc, ['operation', 'operation']) == 'subscribe' && Utils.objectGet(opLogDoc, ['operation', 'status']) == 'find-complete') // Group is up to date in local db\n\t\t\t\t\tself.groupAddresses(parsedArgs.groupName, {groupLookup: false, groupSubscribe: false}, parsedArgs.callback); // Get the group from the local db\n\t\t\t});\n\t\t}\n\t\telse // Call groupAddresses remote, do not subscribe\n\t\t\tself._remoteApiObject.groupAddresses(parsedArgs.groupName, parsedArgs.callback);\n\t});\n};\n\nmodule.exports = function(dnsDb, rpc, config) {\n\treturn new DnsClient(dnsDb, rpc, config);\n};","var Mongolocal = require('mongolocal');\nvar Oms = require('oms');\nvar Utils = require('./Utils');\n\nfunction DnsDb(options) {\n\tvar defaultOptions = {\n\t\tremoveEmptyGroups: true,\n\t\tremoveEmptyAddresses: true,\n\t\tgroupsOplogMax: 1000,\n\t\taddressesOplogMax: 1000\n\t};\n\n\tthis._options = Utils.objectMerge(defaultOptions, options);\n\n\tthis.groups = Mongolocal({});\n\tthis.groupsOplog = Oms.OmsOplog(this.groups, {max: this._options.groupsOplogMax}, {});\n\tthis.groupsOplogSubscriptions = Oms.OmsOplogSubscriptions(this.groupsOplog);\n\n\tthis.addresses = Mongolocal({});\n\tthis.addressesOplog = Oms.OmsOplog(this.addresses, {max: this._options.addressesOplogMax}, {});\n\tthis.addressesOplogSubscriptions = Oms.OmsOplogSubscriptions(this.addressesOplog);\n}\n\nDnsDb.prototype.addToGroup = function(address, groupName, callback) {\n\tvar self = this;\n\tif(typeof address != 'string')\n\t\tcallbackSafe('address_format_incorrect');\n\telse if(typeof groupName != 'string')\n\t\tcallbackSafe('group_format_incorrect');\n\telse {\n\t\tupdateGroup(function(error) {\n\t\t\tif(error)\n\t\t\t\tcallbackSafe(error, null);\n\t\t\telse {\n\t\t\t\tupdateAddress(function (error) {\n\t\t\t\t\tif (error)\n\t\t\t\t\t\tcallbackSafe(error, null);\n\t\t\t\t\telse\n\t\t\t\t\t\tcallbackSafe(null, true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction updateAddress(callback) {\n\t\tvar addressQuery = {_id: address};\n\t\tvar addressDoc = Utils.objectMerge(addressQuery, {$addToSet: {groups: groupName}});\n\t\tself.addresses.update(addressQuery, addressDoc, {upsert: true}, callback);\n\t}\n\n\tfunction updateGroup(callback) {\n\t\tvar groupQuery = {_id: groupName};\n\t\tvar groupDoc = Utils.objectMerge(groupQuery, {$addToSet: {addresses: address}});\n\n\t\tself.groups.update(groupQuery, groupDoc, {upsert: true}, callback);\n\t}\n\n\tfunction callbackSafe(error, response) {\n\t\tif(typeof callback == 'function')\n\t\t\tcallback(error, response);\n\t}\n};\n\nDnsDb.prototype.removeFromGroup = function(address, groupName, callback) {\n\tvar self = this;\n\tif(typeof address != 'string')\n\t\tcallbackSafe('address_format_incorrect');\n\telse if(typeof groupName != 'string')\n\t\tcallbackSafe('group_format_incorrect');\n\telse {\n\t\tupdateGroup(function(error) {\n\t\t\tif(error)\n\t\t\t\tcallbackSafe(error, null);\n\t\t\telse {\n\t\t\t\tupdateAddress(function (error) {\n\t\t\t\t\tif (error)\n\t\t\t\t\t\tcallbackSafe(error, null);\n\t\t\t\t\telse\n\t\t\t\t\t\tcallbackSafe(null, true);\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction updateGroup(callback) {\n\t\tvar groupQuery = {_id: groupName};\n\t\tvar groupUpdateOperation = Utils.objectMerge(groupQuery, {$pull: {addresses: address}});\n\n\t\t// Remove the address from the group\n\t\tself.groups.update(groupQuery, groupUpdateOperation, function(error, writeResult) {\n\t\t\tif(error)\n\t\t\t\tcallback(error);\n\t\t\telse {\n\t\t\t\t// Remove group if no addresses remain\n\t\t\t\tif(self._options.removeEmptyGroups) {\n\t\t\t\t\tvar groupQueryEmpty = Utils.objectMerge(groupQuery, {addresses: {$size: 0}});\n\t\t\t\t\tself.groups.remove(groupQueryEmpty);\n\t\t\t\t}\n\t\t\t\tcallback(null);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction updateAddress(callback) {\n\t\tvar addressQuery = {_id: address};\n\t\tvar addressUpdateOperation = Utils.objectMerge(addressQuery, {$pull: {groups: groupName}});\n\n\t\t// Remove the address from the group\n\t\tself.addresses.update(addressQuery, addressUpdateOperation, function(error, writeResult) {\n\t\t\tif(error)\n\t\t\t\tcallback(error);\n\t\t\telse {\n\t\t\t\t// Remove address if no groups remain\n\n\t\t\t\tif(self._options.removeEmptyAddresses) {\n\t\t\t\t\tvar groupQueryEmpty = Utils.objectMerge(addressQuery, {groups: {$size: 0}});\n\t\t\t\t\tself.addresses.remove(groupQueryEmpty);\n\t\t\t\t}\n\t\t\t\tcallback(null);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction callbackSafe(error, response) {\n\t\tif(typeof callback == 'function')\n\t\t\tcallback(error, response);\n\t}\n};\n\nDnsDb.prototype.removeFromAllGroups = function(address, callback) {\n\tvar self = this;\n\tif(typeof address != 'string')\n\t\tcallbackSafe('address_format_incorrect');\n\telse {\n\t\tself.addresses.findOne({_id: address}, function(error, addressDoc) {\n\t\t\tif(error)\n\t\t\t\tcallbackSafe(error, null);\n\t\t\telse if(addressDoc == null)\n\t\t\t\tcallbackSafe(null, true);\n\t\t\telse {\n\t\t\t\tif(Array.isArray(addressDoc.groups)) {\n\t\t\t\t\taddressDoc.groups.forEach(function(groupName) {\n\t\t\t\t\t\tself.removeFromGroup(address, groupName);\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\tcallbackSafe(null, true);\n\t\t\t}\n\t\t});\n\t}\n\n\tfunction callbackSafe(error, response) {\n\t\tif(typeof callback == 'function')\n\t\t\tcallback(error, response);\n\t}\n};\n\nDnsDb.prototype.groupAddresses = function(groupName, callback) {\n\tthis.groups.findOne({_id: groupName}, function(error, group) {\n\t\tif(error)\n\t\t\tcallback(error, null);\n\t\telse if(group == null)\n\t\t\tcallback('group_undefined', null);\n\t\telse\n\t\t\tcallback(null, group.addresses);\n\t});\n};\n\nDnsDb.prototype.subscribeToGroup = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'groupQuery', level: 1, types: ['object', 'string'], default: {}},\n\t\t\t{name: 'oplogQuery', level: 1, type: 'object', default: {}},\n\t\t\t{name: 'callback', level: 0,  type: 'function'}\n\t\t]\n\t);\n\n\tif(typeof parsedArgs.groupQuery == 'string')\n\t\tparsedArgs.groupQuery = {_id: parsedArgs.groupQuery};\n\n\tthis.groupsOplogSubscriptions.findSubscribe(parsedArgs.groupQuery, parsedArgs.oplogQuery, function(error, operationDoc) {\n\t\tif(error)\n\t\t\tparsedArgs.callback(error, null);\n\t\telse\n\t\t\tparsedArgs.callback(null, operationDoc);\n\t});\n\n};\n\nDnsDb.prototype.unsubscribe = function(subscriptionId, callback) {\n\tif(typeof subscriptionId != 'string')\n\t\tcallback('subscription_undefined', null);\n\telse\n\t\tthis.groupsOplogSubscriptions.unsubscribe(subscriptionId, callback);\n};\n\nmodule.exports = function(options) {\n\treturn new DnsDb(options);\n};","module.exports = function(dnsDb) {\n\tvar apiConfig = require('./apiConfig');\n\tvar ApiBuilder = require('agnostic-router-api-builder');\n\tvar Oms = require('oms');\n\tvar OmsUtils = Oms.OmsUtils;\n\tvar router = require('agnostic-router')();\n\n\t// intercept groupSubscribe to minify results\n\trouter.use('/group/subscribe', function(request, respond, next) {\n\t\tdnsDb.subscribeToGroup(typeof request.query.group == 'string' ? request.query.group : request.query.groupQuery, request.query.oplogQuery, function(error, operationDoc) {\n\t\t\tif(error)\n\t\t\t\trespond(error, null);\n\t\t\telse\n\t\t\t\trespond(null, OmsUtils.operationDocMin(operationDoc));\n\t\t});\n\t});\n\n\tApiBuilder.toRouter(apiConfig, dnsDb, router); // Add functions specified in apiConfig.json\n\n\treturn router;\n};","var EventEmitter = require('wolfy87-eventemitter');\nvar NodeNetworkRpc = require('node-network-rpc');\nvar DnsClient = require('./DnsClient');\nvar DnsDb = require('./DnsDb');\nvar DnsDbRouter = require('./DnsDbRouter');\nvar Utils = require('./Utils');\n\nfunction DnsRpc(config) {\n\tvar self = this;\n\n\tvar defaultConfig = {\n\t\tdnsDb: {\n\t\t\tapiPath: '/api/dns', // Default path on router\n\t\t\tpublic: false // Default is hidden\n\t\t},\n\t\tdnsClient: {\n\t\t\tapiPath: '/api/dns' // Default path on router\n\t\t},\n\t\tnetwork: {}\n\t};\n\n\tself._config = Utils.objectMerge(defaultConfig, config);\n\tself._config.dnsDb = Utils.objectMerge(defaultConfig.dnsDb, self._config.dnsDb);\n\tself._config.dnsClient = Utils.objectMerge(defaultConfig.dnsClient, self._config.dnsClient);\n\n\t// Set up RPC\n\tself.connected = false;\n\tself.rpc = NodeNetworkRpc(self._config.network);\n\tself.network = self.rpc.network;\n\tself.router = self.rpc.router;\n\n\tself.network.on('address', function(address) {\n\t\tself.address = address;\n\n\t\tself.emit('address', address);\n\n\t\tif(typeof address == 'undefined') { // Disconnected\n\t\t\tif(typeof self._prevAddress != 'undefined' && self.connected)\n\t\t\t\tself.dnsClient.removeFromAllGroups(self._prevAddress);\n\n\t\t\tself.emit('disconnect');\n\t\t}\n\t\telse { // Connected\n\t\t\tif(Array.isArray(self._config.groups)) {\n\t\t\t\tself._config.groups.forEach(function(groupName) {\n\t\t\t\t\tself.dnsClient.addToGroup(address, groupName)\n\t\t\t\t});\n\t\t\t}\n\t\t\tself.emit('connect');\n\t\t}\n\n\t\tself._prevAddress = address;\n\t});\n\n\t// Set up DNS\n\tself.dnsDb = DnsDb(self._config.dnsDb);\n\tself.dnsClient = DnsClient(self.dnsDb, self.rpc, self._config.dnsClient);\n\n\t// Add dnsDb to Router (make dnsDb public on the network)\n\tif(typeof self._config.dnsDb.public == 'boolean' && self._config.dnsDb.public) {\n\t\tself.router.use(self._config.dnsDb.apiPath, DnsDbRouter(self.dnsDb));\n\t}\n}\n\nDnsRpc.prototype.__proto__ = EventEmitter.prototype;\n\nDnsRpc.prototype.request = function() {\n\tvar self = this;\n\n\t// TODO make destGroup optional\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'destGroup', level: 1, type: 'string', default: self._config.defaultGroup},\n\t\t\t{name: 'path', level: 0, validate: function(arg, allArgs) { return typeof arg == 'string' && arg[0] == '/'; }},\n\t\t\t{name: 'query', level: 1, type: 'object', default: {}},\n\t\t\t{name: 'options', level: 2,  type: 'object', default: {}},\n\t\t\t{name: 'callback', level: 1,  type: 'function'}\n\t\t]\n\t);\n\n\tif(typeof parsedArgs.destGroup != 'string')\n\t\tcallbackSafe('destGroup_undefined', null);\n\telse {\n\t\tself.dnsClient.groupAddresses(parsedArgs.destGroup, parsedArgs.options, function(error, addresses) {\n\t\t\tif(error) {\n\t\t\t\tif(error == 'group_undefined') {}\n\t\t\t\telse\n\t\t\t\t\tcallbackSafe(error, null);\n\t\t\t}\n\t\t\telse\n\t\t\t\tself.rpc.request(addresses, parsedArgs.path, parsedArgs.query, parsedArgs.options, callbackSafe);\n\t\t});\n\t}\n\n\tfunction callbackSafe(error, result) {\n\t\tif(typeof parsedArgs.callback == 'function')\n\t\t\tparsedArgs.callback(error, result);\n\t}\n};\n\nDnsRpc.prototype.addConnection = function() {\n\tthis.rpc.addConnection.apply(this.rpc, Array.prototype.slice.call(arguments));\n};\n\nmodule.exports = function(config) {\n\treturn new DnsRpc(config)\n};","// Utils module 1.0.12\nvar Utils = {};\n\n/**\n * Map an array to an object using one of each element's attributes\n * Optionally, map the array index to an attribute\n * @param array\n * @param keyAttribute\n * @returns {{}}\n */\nUtils.arrayToObject = function(array, keyAttribute, indexAttribute) {\n\tvar object = {};\n\tif(typeof array.forEach == 'function') {\n\t\tarray.forEach(function(arrayElement, arrayElementIndex) {\n\t\t\tif(typeof arrayElement[keyAttribute] != 'undefined')\n\t\t\t\tobject[arrayElement[keyAttribute]] = arrayElement;\n\n\t\t\tif(typeof indexAttribute != 'undefined')\n\t\t\t\tobject[arrayElement[keyAttribute]][indexAttribute] = arrayElementIndex;\n\n\t\t});\n\t}\n\treturn object;\n};\n\nUtils.objectFilterProperties = function(object, properties) {\n\t// get specified properties of an object into a new object\n\tvar filtered = {};\n\tproperties.forEach(function(property) {\n\t\tfiltered[property] = object[property];\n\t});\n\treturn filtered;\n};\n\nUtils.objectDeepEqual = function (x, y) {\n\tif ((typeof x == \"object\" && x != null) && (typeof y == \"object\" && y != null)) {\n\t\tif (Object.keys(x).length != Object.keys(y).length)\n\t\t\treturn false;\n\n\t\tfor(var prop in x) {\n\t\t\tif(y.hasOwnProperty(prop)) {\n\t\t\t\tif (! Utils.objectDeepEqual(x[prop], y[prop]))\n\t\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse\n\t\t\t\treturn false;\n\t\t}\n\t\treturn true;\n\t}\n\telse if(x !== y)\n\t\treturn false;\n\telse\n\t\treturn true;\n};\n\nUtils.objectContainsObject = function(parentObject, childObject, searchDeep) {\n\tif(typeof searchDeep != 'boolean')\n\t\tsearchDeep = false;\n\n\tif(parentObject === null)\n\t\tparentObject = {};\n\n\tif(childObject === null)\n\t\tchildObject = {};\n\n\tfor(var property in childObject) {\n\t\tif(childObject.hasOwnProperty(property)) {\n\t\t\tif (!parentObject.hasOwnProperty(property)) // parent object doesn't have one of the properties\n\t\t\t\treturn false;\n\t\t\telse if (typeof parentObject[property] != typeof childObject[property]) // types don't match\n\t\t\t\treturn false;\n\t\t\telse if (typeof parentObject[property] == 'object' && searchDeep && !Utils.objectContainsObject(parentObject[property], childObject[property], searchDeep)) // sub-properties don't match\n\t\t\t\treturn false;\n\t\t\telse if (typeof parentObject[property] == 'object' && !searchDeep && parentObject[property] !== childObject[property]) // no deep search and properties don't match\n\t\t\t\treturn false;\n\t\t\telse if (typeof parentObject[property] != 'object' && parentObject[property] !== childObject[property]) // not objects, use simple equality\n\t\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n};\n\nUtils.objectFilter = function(object, filter) {\n\t// filter object properties (children) using filter function\n\t// similar to array filter function\n\tvar result = {};\n\tthis.objectForEach(object, function(child, property, parent) {\n\t\tif(filter(child, property, parent))\n\t\t\tresult[property] = child;\n\t});\n\treturn result;\n};\n\n\nUtils.objectForEach = function(object, callback) {\n\t// run function on each property (child) of object\n\tvar property;\n\tfor(property in object) { // pull keys before looping through?\n\t\tif (object.hasOwnProperty(property))\n\t\t\tcallback(object[property], property, object);\n\t}\n};\n\nUtils.objectGet = function(object, keys) {\n\tvar self = this;\n\tif(keys.length == 0)\n\t\treturn object;\n\telse if(typeof object === \"object\") {\n\t\tif((typeof keys[0] === \"string\" || typeof keys[0] === \"number\") && object !== null && object.hasOwnProperty(keys[0]))\n\t\t\treturn this.objectGet(object[keys[0]], keys.slice(1));\n\t\telse if(keys[0] === null) { // get all\n\t\t\tif(Array.isArray(object)) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof RegExp) { // match keys to regexp\n\t\t\tvar results = {};\n\t\t\tthis.objectForEach(object, function(child, key) {\n\t\t\t\tif(key.match(keys[0]))\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t});\n\t\t\treturn results;\n\t\t}\n\t\telse if(typeof keys[0] === \"function\") { // apply a filtering function\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tobject.forEach(function(value, index, parent) {\n\t\t\t\t\tif(keys[0](value, index, parent)) // filter function\n\t\t\t\t\t\tresults[index] = self.objectGet(value, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilter(object, keys[0]), function(result, key) {\n\t\t\t\t\tresults[key] = self.objectGet(result, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t\telse if(keys[0] instanceof Array) { // all members with keys in array\n\t\t\tif(object instanceof Array) {\n\t\t\t\tvar results = [];\n\t\t\t\tkeys[0].forEach(function(value, index) {\n\t\t\t\t\tresults[index] = object[index];\n\t\t\t\t});\n\t\t\t}\n\t\t\telse {\n\t\t\t\tvar results = {};\n\t\t\t\tthis.objectForEach(self.objectFilterProperties(object, keys[0]), function(child, key) {\n\t\t\t\t\tresults[key] = self.objectGet(child, keys.slice(1));\n\t\t\t\t});\n\t\t\t}\n\t\t\treturn results;\n\t\t}\n\t}\n\telse\n\t\treturn;\n};\n\nUtils.objectSet = function(object, keys, value) {\n\tif(keys.length == 1) {\n\t\tobject[keys[0]] = value;\n\t\treturn true;\n\t}\n\telse {\n\t\tif(typeof(object[keys[0]]) === \"undefined\")\n\t\t\tobject[keys[0]] = {}; // set empty object so we can descend into it\n\t\treturn this.objectSet(object[keys[0]], keys.slice(1), value);\n\t}\n};\n\nUtils.objectIsset = function(object, keys) {\n\tif(keys.length == 1)\n\t\treturn (typeof(object[keys[0]]) !== \"undefined\");\n\telse if(typeof(object[keys[0]]) === \"undefined\") // current level doesn't exist\n\t\treturn false;\n\telse\n\t\treturn this.objectIsset(object[keys[0]], keys.slice(1));\n};\n\nUtils.objectMerge = function() {\n\tvar merged = {};\n\tthis.objectForEach(arguments, function(argument) {\n\t\tfor (var attrname in argument) {\n\t\t\tif(argument.hasOwnProperty(attrname))\n\t\t\t\tmerged[attrname] = argument[attrname];\n\t\t}\n\t});\n\treturn merged;\n};\n\nUtils.uniqueId = function() {\n\tfunction s4() {\n\t\treturn Math.floor((1 + Math.random()) * 0x10000)\n\t\t\t.toString(16)\n\t\t\t.substring(1);\n\t}\n\treturn s4() + s4() + '-' + s4() + '-' + s4() + '-' +\n\t\ts4() + '-' + s4() + s4() + s4();\n};\n\nUtils.parseArgs = function(argsPassed, argsConfig) {\n\tvar matched = {};\n\n\tfunction toLevels(argsConfig, level) {\n\t\tif(typeof level !== 'number')\n\t\t\tlevel = 0;\n\n\t\tvar levelsArr = [];\n\n\t\targsConfig.forEach(function(argConfig) {\n\t\t\tif(Array.isArray(argConfig))\n\t\t\t\tlevelsArr = levelsArr.concat(toLevels(argConfig, level + 1));\n\t\t\telse {\n\t\t\t\targConfig.level = level;\n\t\t\t\tlevelsArr.push(argConfig);\n\t\t\t}\n\t\t});\n\n\t\treturn levelsArr;\n\t}\n\n\tfunction validArg(argConfig, arg) {\n\t\tif(typeof argConfig.validate == 'function')\n\t\t\treturn argConfig.validate(arg);\n\t\telse if(typeof argConfig.type == 'string')\n\t\t\treturn typeof arg == argConfig.type;\n\t\telse if(Array.isArray(argConfig.types))\n\t\t\treturn argConfig.types.indexOf(typeof arg) >= 0;\n\t\telse\n\t\t\treturn true;\n\t}\n\n\tfunction requiredLeftEnough(argsConfig, minIndex) {\n\t\tfor(var index = minIndex; index < argsConfig.length; index++) {\n\t\t\tif(typeof(argsConfig[index]) === 'undefined' || !argsConfig[index].required)\n\t\t\t\treturn true;\n\t\t}\n\t\treturn false;\n\t}\n\n\tvar argConfigMin = 0;\n\n\tif(!Array.isArray(argsPassed))\n\t\targsPassed = Array.prototype.slice.call(argsPassed);\n\n\targsPassed.forEach(function(arg, index) {\n\t\tfor(var ctr = argConfigMin; ctr < argsConfig.length; ctr++) {\n\t\t\tif(argsConfig[ctr].required) {\n\t\t\t\tif(validArg(argsConfig[ctr], arg)) {\n\t\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\t\targConfigMin++;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t\tthrow \"missing_required\";\n\t\t\t}\n\t\t\telse if((!argsConfig[ctr].required && (requiredLeftEnough(argsConfig, ctr) || (argsConfig[ctr].level > argsConfig[ctr - 1].level && argsConfig[ctr - 1].matched))) && validArg(argsConfig[ctr], arg)) {\n\t\t\t\targsConfig[ctr].matched = true;\n\t\t\t\tmatched[argsConfig[ctr].name] = arg;\n\t\t\t\targConfigMin++;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\telse {\n\t\t\t\targsConfig[ctr].matched = false;\n\t\t\t\targConfigMin++;\n\t\t\t}\n\t\t}\n\t});\n\n\t// Add default options, if set\n\targsConfig.forEach(function(argConfig) {\n\t\tif(typeof matched[argConfig.name] == 'undefined' && typeof argConfig.default != 'undefined')\n\t\t\tmatched[argConfig.name] = argConfig.default;\n\t});\n\n\treturn matched;\n};\n\n// queueFunctions [, queueFunctionArgs], queueCompleteCallback [, queueIncompleteCallback] [, options]\nUtils.callbackQueue = function() {\n\tvar parsedArgs = Utils.parseArgs(\n\t\targuments,\n\t\t[\n\t\t\t{name: 'queueFunctions', level: 0, validate: function(arg, allArgs) { return Array.isArray(arg); }},\n\t\t\t{name: 'queueFunctionArgs', level: 1, validate: function(arg, allArgs) { return Array.isArray(arg); }},\n\t\t\t{name: 'queueCompleteCallback', level: 0,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }},\n\t\t\t{name: 'queueNoMatchCallback', level: 1,  validate: function(arg, allArgs) { return typeof(arg) === 'function'; }},\n\t\t\t{name: 'options', level: 1, validate: function(arg, allArgs) { return typeof(arg) === 'object'; }, default: {}}\n\t\t]\n\t);\n\n\tparsedArgs.options = Utils.objectMerge({expand: false}, parsedArgs.options);\n\n\tvar queueCompleted = false;\n\tfunction queueCompleteCallbackSafe() {\n\t\tif(!queueCompleted) {\n\t\t\tqueueCompleted = true;\n\t\t\tparsedArgs.queueCompleteCallback.apply(this, Array.prototype.slice.call(arguments));\n\t\t}\n\t}\n\n\tvar index = -1;\n\tfunction callbackQueueNext() {\n\t\tindex++;\n\t\tif(typeof parsedArgs.queueFunctions[index] === 'function') {\n\t\t\tif(Array.isArray(parsedArgs.queueFunctionArgs) && !parsedArgs.options.expand) // pass arguments to function as array// TODO add expand option\n\t\t\t\tparsedArgs.queueFunctions[index](parsedArgs.queueFunctionArgs, callbackQueueNext, queueCompleteCallbackSafe);\n\t\t\telse if(Array.isArray(parsedArgs.queueFunctionArgs) && parsedArgs.options.expand) // pass arguments to function beforre done() and next()\n\t\t\t\tparsedArgs.queueFunctions[index].apply(this, parsedArgs.queueFunctionArgs.concat([callbackQueueNext, queueCompleteCallbackSafe]));\n\t\t\telse // no arguments to pass\n\t\t\t\tparsedArgs.queueFunctions[index](callbackQueueNext, queueCompleteCallbackSafe);\n\t\t}\n\t\telse if(typeof parsedArgs.queueNoMatchCallback == 'function' && !queueCompleted)\n\t\t\tparsedArgs.queueNoMatchCallback();\n\t}\n\n\tcallbackQueueNext();\n};\n\nmodule.exports = Utils;"]}